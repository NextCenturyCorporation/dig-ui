<!--
Copyright 2018 Next Century Corporation

Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at

    http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.
-->

<!doctype html>

<html>
<head>
  <meta name="viewport" content="width=device-width, minimum-scale=1.0, initial-scale=1.0, user-scalable=yes">
  <title>transform-functions-entity</title>
  <script src="../bower_components/webcomponentsjs/webcomponents-lite.js"></script>
  <script src="../bower_components/web-component-tester/browser.js"></script>
  <link rel="import" href="../elements/transform-functions/transform-functions.html">
</head>

<body>
<test-fixture id="transform-functions-fixture">
  <template>
    <transform-functions></transform-functions>
  </template>
</test-fixture>

<script>
  'use strict';
  /* globals fixture, suite, setup, test, expect */
  /* jshint -W030 */
  suite('transform-functions entity transforms tests', function() {
    var transformFunctions;

    var SEARCH_FIELDS = [{
      key: 'city',
      extractionField: '_source.extractions.cityField',
      icon: 'cityIcon',
      isDate: false,
      isHidden: false,
      isLocation: true,
      isUrl: false,
      link: 'entity',
      result: 'header',
      styleClass: 'cityStyle',
      title: 'City',
      titlePlural: 'Cities',
      type: 'location'
    }, {
      key: 'comment',
      extractionField: '_source.extractions.commentField',
      icon: 'commentIcon',
      isDate: false,
      isHidden: false,
      isLocation: false,
      isUrl: false,
      link: 'result',
      result: 'nested',
      styleClass: 'commentStyle',
      title: 'Comment',
      titlePlural: 'Comments',
      type: 'kg_id'
    }, {
      key: 'date',
      extractionField: '_source.extractions.dateField',
      icon: 'dateIcon',
      isDate: true,
      isHidden: false,
      isLocation: false,
      isUrl: false,
      link: undefined,
      result: 'header',
      styleClass: 'dateStyle',
      title: 'Date',
      titlePlural: 'Dates',
      type: 'date'
    }, {
      key: 'description',
      extractionField: '_source.extractions.descriptionField',
      icon: 'descriptionIcon',
      isDate: false,
      isHidden: false,
      isLocation: false,
      isUrl: false,
      link: undefined,
      result: 'description',
      styleClass: 'descriptionStyle',
      title: 'Description',
      titlePlural: 'Descriptions',
      type: 'string'
    }, {
      key: 'email',
      extractionField: '_source.extractions.emailField',
      icon: 'emailIcon',
      isDate: false,
      isHidden: false,
      isLocation: false,
      isUrl: false,
      link: 'entity',
      result: 'detail',
      styleClass: 'emailStyle',
      title: 'Email',
      titlePlural: 'Emails',
      type: 'email'
    }, {
      key: 'label',
      extractionField: '_source.extractions.labelField',
      icon: 'labelIcon',
      isDate: false,
      isHidden: false,
      isLocation: false,
      isUrl: false,
      link: undefined,
      result: 'header',
      styleClass: 'labelStyle',
      title: 'Label',
      titlePlural: 'Labels',
      type: 'string'
    }, {
      key: 'number',
      extractionField: '_source.extractions.numberField',
      icon: 'numberIcon',
      isDate: false,
      isHidden: false,
      isLocation: false,
      isUrl: false,
      link: undefined,
      result: 'detail',
      styleClass: 'numberStyle',
      title: 'Number',
      titlePlural: 'Numbers',
      type: 'number'
    }, {
      key: 'phone',
      extractionField: '_source.extractions.phoneField',
      icon: 'phoneIcon',
      isDate: false,
      isHidden: false,
      isLocation: false,
      isUrl: false,
      link: 'entity',
      result: 'detail',
      styleClass: 'phoneStyle',
      title: 'Phone',
      titlePlural: 'Phones',
      type: 'phone'
    }, {
      key: 'price',
      extractionField: '_source.extractions.priceField',
      icon: 'priceIcon',
      isDate: false,
      isHidden: false,
      isLocation: false,
      isUrl: false,
      link: undefined,
      result: 'detail',
      styleClass: 'priceStyle',
      title: 'Price',
      titlePlural: 'Prices',
      type: 'hyphenated'
    }, {
      key: 'title',
      extractionField: '_source.extractions.titleField',
      icon: 'titleIcon',
      isDate: false,
      isHidden: false,
      isLocation: false,
      isUrl: false,
      link: 'result',
      result: 'title',
      styleClass: 'titleStyle',
      title: 'Title',
      titlePlural: 'Titles',
      type: 'string'
    }, {
      key: 'unnested',
      extractionField: '_source.extractions.unnestedField',
      icon: 'unnestedIcon',
      isDate: false,
      isHidden: false,
      isLocation: false,
      isUrl: false,
      link: undefined,
      result: 'detail',
      styleClass: 'unnestedStyle',
      title: 'Unnested Item',
      titlePlural: 'Unnested Items',
      type: 'string'
    }, {
      key: 'user',
      extractionField: '_source.extractions.userField',
      icon: 'userIcon',
      isDate: false,
      isHidden: false,
      isLocation: false,
      isUrl: false,
      link: 'entity',
      result: 'detail',
      styleClass: 'userStyle',
      title: 'User',
      titlePlural: 'Users',
      type: 'username'
    }, {
      key: 'website',
      extractionField: '_source.extractions.websiteField',
      icon: 'websiteIcon',
      isDate: false,
      isHidden: false,
      isLocation: false,
      isUrl: true,
      link: 'text',
      result: 'header',
      styleClass: 'websiteStyle',
      title: 'Website',
      titlePlural: 'Websites',
      type: 'url'
    }, {
      key: 'x',
      extractionField: '_source.extractions.xField',
      icon: 'xIcon',
      isDate: false,
      isHidden: false,
      isLocation: false,
      isUrl: false,
      link: undefined,
      result: undefined,
      styleClass: 'xStyle',
      title: 'X',
      titlePlural: 'Xs',
      type: 'string'
    }];

    /* jscs:disable requireCamelCaseOrUpperCaseIdentifiers */
    var RESULT_1 = {
      _source: {
        doc_id: 'ABC123',
        extractions: {
          cityField: [{
            key: 'city1:state1:country1:1:11',
            value: 'City 1'
          }, {
            key: 'city2:state2:country2:2:22',
            value: 'City 2'
          }],
          commentField: [{
            key: 'comment1'
          }, {
            key: 'comment2'
          }],
          dateField: [{
            key: 'date1',
            value: '2018-01-01T00:00:00'
          }, {
            key: 'date2',
            value: '2018-02-02T00:00:00'
          }],
          descriptionField: [{
            value: 'This is description 1'
          }, {
            value: 'This is description 2'
          }],
          emailField: [{
            key: 'email1@address1.com',
            value: 'email1@address1.com'
          }, {
            key: 'email2@address2.com',
            value: 'email2@address2.com'
          }],
          labelField: [{
            key: 'label1',
            value: 'Label1'
          }, {
            key: 'label2',
            value: 'Label2'
          }],
          numberField: [{
            key: 321,
            value: 321
          }, {
            key: 654,
            value: 654
          }],
          phoneField: [{
            key: '1112223333',
            value: '1112223333'
          }, {
            key: '4445556666',
            value: '+1-4445556666'
          }],
          priceField: [{
            key: 'price1-currency:currency1-time_unit:time1',
            value: 'Price1'
          }, {
            key: 'price2-currency:currency2-time_unit:time2',
            value: 'Price2'
          }],
          titleField: [{
            value: 'Title 1'
          }, {
            value: 'Title 2'
          }],
          unnestedField: ['unnested1', 'unnested2'],
          userField: [{
            key: 'type1 user1',
            value: 'User1'
          }, {
            key: 'type2 user2',
            value: 'User2'
          }],
          websiteField: [{
            key: 'website1.com',
            value: 'website1.com'
          }, {
            key: 'website2.com',
            value: 'website2.com'
          }],
          xField: [{
            key: 'x1',
            value: 'X1'
          }, {
            key: 'x2',
            value: 'X2'
          }]
        },
        url: 'testUrl1'
      }
    };
    /* jscs:enable requireCamelCaseOrUpperCaseIdentifiers */

    /* jscs:disable requireCamelCaseOrUpperCaseIdentifiers */
    var RESULT_2 = {
      _source: {
        doc_id: 'DEF456',
        extractions: {
          cityField: [{
            key: 'city3:state3:country3:3:33',
            value: 'City 3'
          }],
          commentField: [{
            key: 'comment3'
          }],
          dateField: [{
            key: 'date3',
            value: '2018-03-03T00:00:00'
          }],
          descriptionField: [{
            value: 'This is description 3'
          }],
          emailField: [{
            key: 'email3@address3.com',
            value: 'email3@address3.com'
          }],
          labelField: [{
            key: 'label3',
            value: 'Label3'
          }],
          numberField: [{
            key: 987,
            value: 987
          }],
          phoneField: [{
            key: '7778889999',
            value: '+x-7778889999'
          }],
          priceField: [{
            key: 'price3-currency:currency3-time_unit:time3',
            value: 'Price 3'
          }],
          titleField: [{
            value: 'Title 3'
          }],
          unnestedField: ['unnested3'],
          userField: [{
            key: 'type3 user3',
            value: 'User3'
          }],
          websiteField: [{
            key: 'website3.com',
            value: 'website3.com'
          }],
          xField: [{
            key: 'x3',
            value: 'X 3'
          }]
        },
        url: 'testUrl2'
      }
    };
    /* jscs:enable requireCamelCaseOrUpperCaseIdentifiers */

    setup(function() {
      transformFunctions = fixture('transform-functions-fixture');
      transformFunctions.domain = 'TestDomain';
      transformFunctions.clientConfig = {};
      transformFunctions.serverConfig = {
        resultIcon: 'TestIcon',
        resultNamePlural: 'TestResults',
        resultNameSingular: 'TestResult',
        resultQueryField: 'TestQueryField',
        timestampField: 'timestamp_crawl',
        uidField: 'doc_id'
      };
    });

    test('does define transforms object', function() {
      expect(transformFunctions.transforms).to.be.an('Object');
    });

    test('does define entity object', function() {
      expect(transformFunctions.transforms.entity).to.be.an('Object');
    });

    test('entityPageLinkForImageId does return expected string', function() {
      expect(transformFunctions.transforms.entity.entityPageLinkForImageId('foo')).to.equal('/entity.html?domain=TestDomain&id=foo&type=image');
      expect(transformFunctions.transforms.entity.entityPageLinkForImageId('bar')).to.equal('/entity.html?domain=TestDomain&id=bar&type=image');
    });

    test('extractions given empty aggregations does return empty array', function() {
      expect(transformFunctions.transforms.entity.extractions(null, {
        entity: SEARCH_FIELDS[5]
      })).to.deep.equal([]);

      expect(transformFunctions.transforms.entity.extractions({}, {
        entity: SEARCH_FIELDS[5]
      })).to.deep.equal([]);

      expect(transformFunctions.transforms.entity.extractions({
        aggregations: {}
      }, {
        entity: SEARCH_FIELDS[5]
      })).to.deep.equal([]);

      expect(transformFunctions.transforms.entity.extractions({
        aggregations: {
          city: {}
        }
      }, {
        entity: SEARCH_FIELDS[5]
      })).to.deep.equal([]);

      expect(transformFunctions.transforms.entity.extractions({
        aggregations: {
          city: {
            buckets: []
          }
        }
      }, {
        entity: SEARCH_FIELDS[5]
      })).to.deep.equal([]);

      expect(transformFunctions.transforms.entity.extractions({
        aggregations: {
          city: {
            city: {
              buckets: []
            }
          }
        }
      }, {
        entity: SEARCH_FIELDS[5]
      })).to.deep.equal([]);
    });

    test('extractions given linked location aggregations does return expected array', function() {
      /* jscs:disable requireCamelCaseOrUpperCaseIdentifiers */
      var output = transformFunctions.transforms.entity.extractions({
        aggregations: {
          city: {
            buckets: [{
              doc_count: 1111,
              key: 'city1:state1:country1:1:11'
            }, {
              doc_count: 222,
              key: 'city2:state2:country2:2:22'
            }, {
              doc_count: 33,
              key: 'city3:state3:country3:3:33'
            }]
          }
        }
      }, {
        entity: SEARCH_FIELDS[0]
      });
      /* jscs:enable requireCamelCaseOrUpperCaseIdentifiers */

      expect(output.length).to.equal(3);

      expect(output[0].confidence).to.not.exist;
      expect(output[0].count).to.equal(1111);
      expect(output[0].id).to.equal('city1:state1:country1:1:11');
      expect(output[0].icon).to.not.exist;
      expect(output[0].link).to.equal('/entity.html?domain=TestDomain&id=city1%3Astate1%3Acountry1%3A1%3A11&type=city');
      expect(output[0].provenances).to.deep.equal([]);
      expect(output[0].styleClass).to.equal('cityStyle');
      expect(output[0].text).to.equal('city1, state1');
      expect(output[0].type).to.equal('city');
      expect(output[0].width).to.not.exist;

      expect(output[1].confidence).to.not.exist;
      expect(output[1].count).to.equal(222);
      expect(output[1].id).to.equal('city2:state2:country2:2:22');
      expect(output[1].icon).to.not.exist;
      expect(output[1].link).to.equal('/entity.html?domain=TestDomain&id=city2%3Astate2%3Acountry2%3A2%3A22&type=city');
      expect(output[1].provenances).to.deep.equal([]);
      expect(output[1].styleClass).to.equal('cityStyle');
      expect(output[1].text).to.equal('city2, state2');
      expect(output[1].type).to.equal('city');
      expect(output[1].width).to.not.exist;

      expect(output[2].confidence).to.not.exist;
      expect(output[2].count).to.equal(33);
      expect(output[2].id).to.equal('city3:state3:country3:3:33');
      expect(output[2].icon).to.not.exist;
      expect(output[2].link).to.equal('/entity.html?domain=TestDomain&id=city3%3Astate3%3Acountry3%3A3%3A33&type=city');
      expect(output[2].provenances).to.deep.equal([]);
      expect(output[2].styleClass).to.equal('cityStyle');
      expect(output[2].text).to.equal('city3, state3');
      expect(output[2].type).to.equal('city');
      expect(output[2].width).to.not.exist;
    });

    test('extractions given aggregations with nested format does return expected array', function() {
      /* jscs:disable requireCamelCaseOrUpperCaseIdentifiers */
      var output = transformFunctions.transforms.entity.extractions({
        aggregations: {
          label: {
            label: {
              buckets: [{
                doc_count: 1111,
                key: 'label1'
              }, {
                doc_count: 222,
                key: 'label2'
              }, {
                doc_count: 33,
                key: 'label3'
              }]
            }
          }
        }
      }, {
        entity: SEARCH_FIELDS[5]
      });
      /* jscs:enable requireCamelCaseOrUpperCaseIdentifiers */

      expect(output.length).to.equal(3);

      expect(output[0].confidence).to.not.exist;
      expect(output[0].count).to.equal(1111);
      expect(output[0].id).to.equal('label1');
      expect(output[0].icon).to.not.exist;
      expect(output[0].link).to.not.exist;
      expect(output[0].provenances).to.deep.equal([]);
      expect(output[0].styleClass).to.equal('labelStyle');
      expect(output[0].text).to.equal('label1');
      expect(output[0].type).to.equal('label');
      expect(output[0].width).to.not.exist;

      expect(output[1].confidence).to.not.exist;
      expect(output[1].count).to.equal(222);
      expect(output[1].id).to.equal('label2');
      expect(output[1].icon).to.not.exist;
      expect(output[1].link).to.not.exist;
      expect(output[1].provenances).to.deep.equal([]);
      expect(output[1].styleClass).to.equal('labelStyle');
      expect(output[1].text).to.equal('label2');
      expect(output[1].type).to.equal('label');
      expect(output[1].width).to.not.exist;

      expect(output[2].confidence).to.not.exist;
      expect(output[2].count).to.equal(33);
      expect(output[2].id).to.equal('label3');
      expect(output[2].icon).to.not.exist;
      expect(output[2].link).to.not.exist;
      expect(output[2].provenances).to.deep.equal([]);
      expect(output[2].styleClass).to.equal('labelStyle');
      expect(output[2].text).to.equal('label3');
      expect(output[2].type).to.equal('label');
      expect(output[2].width).to.not.exist;
    });

    test('extractions given aggregations and config ID/page does return expected array', function() {
      /* jscs:disable requireCamelCaseOrUpperCaseIdentifiers */
      var output = transformFunctions.transforms.entity.extractions({
        aggregations: {
          label: {
            buckets: [{
              doc_count: 1111,
              key: 'label1'
            }, {
              doc_count: 222,
              key: 'label2'
            }, {
              doc_count: 33,
              key: 'label3'
            }]
          }
        }
      }, {
        entity: SEARCH_FIELDS[5],
        id: 'label2',
        page: {
          type: 'label'
        }
      });
      /* jscs:enable requireCamelCaseOrUpperCaseIdentifiers */

      expect(output.length).to.equal(2);

      expect(output[0].confidence).to.not.exist;
      expect(output[0].count).to.equal(1111);
      expect(output[0].id).to.equal('label1');
      expect(output[0].icon).to.not.exist;
      expect(output[0].link).to.not.exist;
      expect(output[0].provenances).to.deep.equal([]);
      expect(output[0].styleClass).to.equal('labelStyle');
      expect(output[0].text).to.equal('label1');
      expect(output[0].type).to.equal('label');
      expect(output[0].width).to.not.exist;

      expect(output[1].confidence).to.not.exist;
      expect(output[1].count).to.equal(33);
      expect(output[1].id).to.equal('label3');
      expect(output[1].icon).to.not.exist;
      expect(output[1].link).to.not.exist;
      expect(output[1].provenances).to.deep.equal([]);
      expect(output[1].styleClass).to.equal('labelStyle');
      expect(output[1].text).to.equal('label3');
      expect(output[1].type).to.equal('label');
      expect(output[1].width).to.not.exist;
    });

    test('maps given incomplete data does return undefined', function() {
      expect(transformFunctions.transforms.entity.maps(null, SEARCH_FIELDS)).to.not.exist;
      expect(transformFunctions.transforms.entity.maps({}, SEARCH_FIELDS)).to.not.exist;
      expect(transformFunctions.transforms.entity.maps({
        headerExtractions: []
      }, SEARCH_FIELDS)).to.not.exist;
      expect(transformFunctions.transforms.entity.maps({
        detailExtractions: []
      }, SEARCH_FIELDS)).to.not.exist;
    });

    test('maps given header and detail extractions does return expected array', function() {
      expect(transformFunctions.transforms.entity.maps({
        headerExtractions: [{
          key: 'city',
          data: [1, 2]
        }, {
          key: 'date',
          data: [3, 4]
        }],
        detailExtractions: [{
          key: 'city',
          data: [5, 6]
        }, {
          key: 'user',
          data: [7, 8]
        }]
      }, SEARCH_FIELDS)).to.deep.equal([{
        config: {
          key: 'city',
          extractionField: '_source.extractions.cityField',
          icon: 'cityIcon',
          isDate: false,
          isHidden: false,
          isLocation: true,
          isUrl: false,
          link: 'entity',
          result: 'header',
          styleClass: 'cityStyle',
          title: 'City',
          titlePlural: 'Cities',
          type: 'location'
        },
        data: [1, 2]
      }, {
        config: {
          key: 'city',
          extractionField: '_source.extractions.cityField',
          icon: 'cityIcon',
          isDate: false,
          isHidden: false,
          isLocation: true,
          isUrl: false,
          link: 'entity',
          result: 'header',
          styleClass: 'cityStyle',
          title: 'City',
          titlePlural: 'Cities',
          type: 'location'
        },
        data: [5, 6]
      }]);
    });

    test('nestedResults given incomplete data does return empty object', function() {
      expect(transformFunctions.transforms.entity.nestedResults({}, {
        searchFields: SEARCH_FIELDS
      })).to.deep.equal({});
      expect(transformFunctions.transforms.entity.nestedResults({
        hits: {}
      }, {
        extractionId: 'comment',
        searchFields: SEARCH_FIELDS
      })).to.deep.equal({});
      expect(transformFunctions.transforms.entity.nestedResults({
        hits: {
          hits: []
        }
      }, {
        extractionId: 'comment',
        searchFields: SEARCH_FIELDS
      })).to.deep.equal({});
      expect(transformFunctions.transforms.entity.nestedResults({
        hits: {
          hits: [{}]
        }
      }, {
        extractionId: 'comment',
        searchFields: SEARCH_FIELDS
      })).to.deep.equal({});
      expect(transformFunctions.transforms.entity.nestedResults({
        hits: {
          hits: [{}]
        }
      }, {
        extractionId: 'comment',
        searchFields: SEARCH_FIELDS
      })).to.deep.equal({});
      expect(transformFunctions.transforms.entity.nestedResults({
        hits: {
          hits: [{
            _source: {}
          }]
        }
      }, {
        extractionId: 'comment',
        searchFields: SEARCH_FIELDS
      })).to.deep.equal({});
    });

    test('nestedResults given no extractions does return expected object', function() {
      /* jscs:disable requireCamelCaseOrUpperCaseIdentifiers */
      var output = transformFunctions.transforms.entity.nestedResults({
        hits: {
          hits: [{
            _source: {
              doc_id: 'ABC123',
              url: 'testUrl1'
            }
          }, {
            _source: {
              doc_id: 'DEF456',
              url: 'testUrl2'
            }
          }]
        }
      }, {
        extractionId: 'comment',
        searchFields: SEARCH_FIELDS
      });
      /* jscs:enable requireCamelCaseOrUpperCaseIdentifiers */

      expect(output.ABC123.id).to.equal('ABC123');
      expect(output.ABC123.description).to.equal('');
      expect(output.ABC123.highlightedText).to.equal('');
      expect(output.ABC123.icon).to.equal('commentIcon');
      expect(output.ABC123.link).to.equal('/result.html?domain=TestDomain&id=ABC123');
      expect(output.ABC123.name).to.equal('Comment');
      expect(output.ABC123.styleClass).to.equal('commentStyle');
      expect(output.ABC123.tags).to.deep.equal({});
      expect(output.ABC123.title).to.equal('');
      expect(output.ABC123.type).to.equal('comment');
      expect(output.ABC123.url).to.equal('testUrl1');

      expect(output.ABC123.timestamp).to.not.exist;
      expect(output.ABC123.esData).to.not.exist;
      expect(output.ABC123.images).to.not.exist;

      expect(output.ABC123.headerExtractions).to.deep.equal([{
        data: [],
        icon: 'websiteIcon',
        isDate: false,
        isUrl: true,
        key: 'website',
        name: 'Websites',
        styleClass: 'websiteStyle',
        type: 'url',
        width: undefined,
        index: 3
      }, {
        data: [],
        icon: 'dateIcon',
        isDate: true,
        isUrl: false,
        key: 'date',
        name: 'Dates',
        styleClass: 'dateStyle',
        type: 'date',
        width: undefined,
        index: 1
      }, {
        data: [],
        icon: 'cityIcon',
        isDate: false,
        isUrl: false,
        key: 'city',
        name: 'Cities',
        styleClass: 'cityStyle',
        type: 'location',
        width: undefined,
        index: 0
      }, {
        data: [],
        icon: 'labelIcon',
        isDate: false,
        isUrl: false,
        key: 'label',
        name: 'Labels',
        styleClass: 'labelStyle',
        type: 'string',
        width: undefined,
        index: 2
      }]);

      expect(output.ABC123.detailExtractions).to.deep.equal([{
        data: [],
        icon: 'emailIcon',
        isDate: false,
        isUrl: false,
        key: 'email',
        name: 'Emails',
        styleClass: 'emailStyle',
        type: 'email',
        width: undefined
      }, {
        data: [],
        icon: 'numberIcon',
        isDate: false,
        isUrl: false,
        key: 'number',
        name: 'Numbers',
        styleClass: 'numberStyle',
        type: 'number',
        width: undefined
      }, {
        data: [],
        icon: 'phoneIcon',
        isDate: false,
        isUrl: false,
        key: 'phone',
        name: 'Phones',
        styleClass: 'phoneStyle',
        type: 'phone',
        width: undefined
      }, {
        data: [],
        icon: 'priceIcon',
        isDate: false,
        isUrl: false,
        key: 'price',
        name: 'Prices',
        styleClass: 'priceStyle',
        type: 'hyphenated',
        width: undefined
      }, {
        data: [],
        icon: 'unnestedIcon',
        isDate: false,
        isUrl: false,
        key: 'unnested',
        name: 'Unnested Items',
        styleClass: 'unnestedStyle',
        type: 'string',
        width: undefined
      }, {
        data: [],
        icon: 'userIcon',
        isDate: false,
        isUrl: false,
        key: 'user',
        name: 'Users',
        styleClass: 'userStyle',
        type: 'username',
        width: undefined
      }]);

      expect(output.ABC123.nestedExtractions).to.deep.equal([{
        data: [],
        icon: 'commentIcon',
        isDate: false,
        isUrl: false,
        key: 'comment',
        name: 'Comments',
        styleClass: 'commentStyle',
        type: 'kg_id',
        width: undefined
      }]);

      expect(output.ABC123.details).to.deep.equal([{
        name: 'Url',
        link: 'testUrl1',
        text: 'testUrl1'
      }, {
        name: 'Description',
        highlightedText: '',
        text: ''
      }, {
        name: 'Cached Page',
        link: '/cached.html?domain=TestDomain&id=ABC123',
        text: 'Open in New Tab (Runs External Code)'
      }]);

      expect(output.DEF456.id).to.equal('DEF456');
      expect(output.DEF456.description).to.equal('');
      expect(output.DEF456.highlightedText).to.equal('');
      expect(output.DEF456.icon).to.equal('commentIcon');
      expect(output.DEF456.link).to.equal('/result.html?domain=TestDomain&id=DEF456');
      expect(output.DEF456.name).to.equal('Comment');
      expect(output.DEF456.styleClass).to.equal('commentStyle');
      expect(output.DEF456.tags).to.deep.equal({});
      expect(output.DEF456.title).to.equal('');
      expect(output.DEF456.type).to.equal('comment');
      expect(output.DEF456.url).to.equal('testUrl2');

      expect(output.DEF456.timestamp).to.not.exist;
      expect(output.DEF456.esData).to.not.exist;
      expect(output.DEF456.images).to.not.exist;

      expect(output.DEF456.headerExtractions).to.deep.equal([{
        data: [],
        icon: 'websiteIcon',
        isDate: false,
        isUrl: true,
        key: 'website',
        name: 'Websites',
        styleClass: 'websiteStyle',
        type: 'url',
        width: undefined,
        index: 3
      }, {
        data: [],
        icon: 'dateIcon',
        isDate: true,
        isUrl: false,
        key: 'date',
        name: 'Dates',
        styleClass: 'dateStyle',
        type: 'date',
        width: undefined,
        index: 1
      }, {
        data: [],
        icon: 'cityIcon',
        isDate: false,
        isUrl: false,
        key: 'city',
        name: 'Cities',
        styleClass: 'cityStyle',
        type: 'location',
        width: undefined,
        index: 0
      }, {
        data: [],
        icon: 'labelIcon',
        isDate: false,
        isUrl: false,
        key: 'label',
        name: 'Labels',
        styleClass: 'labelStyle',
        type: 'string',
        width: undefined,
        index: 2
      }]);

      expect(output.DEF456.detailExtractions).to.deep.equal([{
        data: [],
        icon: 'emailIcon',
        isDate: false,
        isUrl: false,
        key: 'email',
        name: 'Emails',
        styleClass: 'emailStyle',
        type: 'email',
        width: undefined
      }, {
        data: [],
        icon: 'numberIcon',
        isDate: false,
        isUrl: false,
        key: 'number',
        name: 'Numbers',
        styleClass: 'numberStyle',
        type: 'number',
        width: undefined
      }, {
        data: [],
        icon: 'phoneIcon',
        isDate: false,
        isUrl: false,
        key: 'phone',
        name: 'Phones',
        styleClass: 'phoneStyle',
        type: 'phone',
        width: undefined
      }, {
        data: [],
        icon: 'priceIcon',
        isDate: false,
        isUrl: false,
        key: 'price',
        name: 'Prices',
        styleClass: 'priceStyle',
        type: 'hyphenated',
        width: undefined
      }, {
        data: [],
        icon: 'unnestedIcon',
        isDate: false,
        isUrl: false,
        key: 'unnested',
        name: 'Unnested Items',
        styleClass: 'unnestedStyle',
        type: 'string',
        width: undefined
      }, {
        data: [],
        icon: 'userIcon',
        isDate: false,
        isUrl: false,
        key: 'user',
        name: 'Users',
        styleClass: 'userStyle',
        type: 'username',
        width: undefined
      }]);

      expect(output.DEF456.nestedExtractions).to.deep.equal([{
        data: [],
        icon: 'commentIcon',
        isDate: false,
        isUrl: false,
        key: 'comment',
        name: 'Comments',
        styleClass: 'commentStyle',
        type: 'kg_id',
        width: undefined
      }]);

      expect(output.DEF456.details).to.deep.equal([{
        name: 'Url',
        link: 'testUrl2',
        text: 'testUrl2'
      }, {
        name: 'Description',
        highlightedText: '',
        text: ''
      }, {
        name: 'Cached Page',
        link: '/cached.html?domain=TestDomain&id=DEF456',
        text: 'Open in New Tab (Runs External Code)'
      }]);
    });

    test('nestedResults given multiple results with many extractions does return expected object', function() {
      /* jscs:disable requireCamelCaseOrUpperCaseIdentifiers */
      var output = transformFunctions.transforms.entity.nestedResults({
        hits: {
          hits: [RESULT_1, RESULT_2]
        }
      }, {
        extractionId: 'comment',
        searchFields: SEARCH_FIELDS
      });
      /* jscs:enable requireCamelCaseOrUpperCaseIdentifiers */

      expect(output.ABC123.id).to.equal('ABC123');
      expect(output.ABC123.description).to.equal('This is description 1');
      expect(output.ABC123.highlightedText).to.equal('Title 1');
      expect(output.ABC123.icon).to.equal('commentIcon');
      expect(output.ABC123.link).to.equal('/result.html?domain=TestDomain&id=ABC123');
      expect(output.ABC123.name).to.equal('Comment');
      expect(output.ABC123.styleClass).to.equal('commentStyle');
      expect(output.ABC123.tags).to.deep.equal({});
      expect(output.ABC123.title).to.equal('Title 1');
      expect(output.ABC123.type).to.equal('comment');
      expect(output.ABC123.url).to.equal('testUrl1');

      expect(output.ABC123.timestamp).to.not.exist;
      expect(output.ABC123.esData).to.not.exist;
      expect(output.ABC123.images).to.not.exist;
      expect(output.ABC123.headerExtractions.length).to.equal(4);
      expect(output.ABC123.detailExtractions.length).to.equal(6);
      expect(output.ABC123.nestedExtractions.length).to.equal(1);
      expect(output.ABC123.details.length).to.equal(3);

      expect(output.ABC123.headerExtractions[0].isDate).to.be.false;
      expect(output.ABC123.headerExtractions[0].isUrl).to.be.true;
      expect(output.ABC123.headerExtractions[0].key).to.equal('website');
      expect(output.ABC123.headerExtractions[0].name).to.equal('Websites');
      expect(output.ABC123.headerExtractions[0].type).to.equal('url');
      expect(output.ABC123.headerExtractions[0].data.length).to.equal(2);

      expect(output.ABC123.headerExtractions[0].data[0].confidence).to.not.exist;
      expect(output.ABC123.headerExtractions[0].data[0].count).to.not.exist;
      expect(output.ABC123.headerExtractions[0].data[0].highlight).to.not.exist;
      expect(output.ABC123.headerExtractions[0].data[0].id).to.equal('website1.com');
      expect(output.ABC123.headerExtractions[0].data[0].icon).to.equal('websiteIcon');
      expect(output.ABC123.headerExtractions[0].data[0].link).to.not.exist;
      expect(output.ABC123.headerExtractions[0].data[0].provenances.length).to.equal(0);
      expect(output.ABC123.headerExtractions[0].data[0].styleClass).to.equal('websiteStyle');
      expect(output.ABC123.headerExtractions[0].data[0].text).to.equal('website1.com');
      expect(output.ABC123.headerExtractions[0].data[0].type).to.equal('website');
      expect(output.ABC123.headerExtractions[0].data[0].width).to.not.exist;

      expect(output.ABC123.headerExtractions[0].data[1].confidence).to.not.exist;
      expect(output.ABC123.headerExtractions[0].data[1].count).to.not.exist;
      expect(output.ABC123.headerExtractions[0].data[1].highlight).to.not.exist;
      expect(output.ABC123.headerExtractions[0].data[1].id).to.equal('website2.com');
      expect(output.ABC123.headerExtractions[0].data[1].icon).to.equal('websiteIcon');
      expect(output.ABC123.headerExtractions[0].data[1].link).to.not.exist;
      expect(output.ABC123.headerExtractions[0].data[1].provenances.length).to.equal(0);
      expect(output.ABC123.headerExtractions[0].data[1].styleClass).to.equal('websiteStyle');
      expect(output.ABC123.headerExtractions[0].data[1].text).to.equal('website2.com');
      expect(output.ABC123.headerExtractions[0].data[1].type).to.equal('website');
      expect(output.ABC123.headerExtractions[0].data[1].width).to.not.exist;

      expect(output.ABC123.headerExtractions[1].isDate).to.be.true;
      expect(output.ABC123.headerExtractions[1].isUrl).to.be.false;
      expect(output.ABC123.headerExtractions[1].key).to.equal('date');
      expect(output.ABC123.headerExtractions[1].name).to.equal('Dates');
      expect(output.ABC123.headerExtractions[1].type).to.equal('date');
      expect(output.ABC123.headerExtractions[1].data.length).to.equal(1);

      expect(output.ABC123.headerExtractions[1].data[0].confidence).to.not.exist;
      expect(output.ABC123.headerExtractions[1].data[0].count).to.not.exist;
      expect(output.ABC123.headerExtractions[1].data[0].highlight).to.not.exist;
      expect(output.ABC123.headerExtractions[1].data[0].id).to.equal('date1');
      expect(output.ABC123.headerExtractions[1].data[0].icon).to.equal('dateIcon');
      expect(output.ABC123.headerExtractions[1].data[0].link).to.not.exist;
      expect(output.ABC123.headerExtractions[1].data[0].provenances.length).to.equal(0);
      expect(output.ABC123.headerExtractions[1].data[0].styleClass).to.equal('dateStyle');
      expect(output.ABC123.headerExtractions[1].data[0].text).to.equal('From Jan 1, 2018 to Feb 2, 2018');
      expect(output.ABC123.headerExtractions[1].data[0].type).to.equal('date');
      expect(output.ABC123.headerExtractions[1].data[0].width).to.not.exist;

      expect(output.ABC123.headerExtractions[2].isDate).to.be.false;
      expect(output.ABC123.headerExtractions[2].isUrl).to.be.false;
      expect(output.ABC123.headerExtractions[2].key).to.equal('city');
      expect(output.ABC123.headerExtractions[2].name).to.equal('Cities');
      expect(output.ABC123.headerExtractions[2].type).to.equal('location');
      expect(output.ABC123.headerExtractions[2].data.length).to.equal(2);

      expect(output.ABC123.headerExtractions[2].data[0].confidence).to.not.exist;
      expect(output.ABC123.headerExtractions[2].data[0].count).to.not.exist;
      expect(output.ABC123.headerExtractions[2].data[0].highlight).to.not.exist;
      expect(output.ABC123.headerExtractions[2].data[0].id).to.equal('city1:state1:country1:1:11');
      expect(output.ABC123.headerExtractions[2].data[0].icon).to.equal('cityIcon');
      expect(output.ABC123.headerExtractions[2].data[0].link).to.equal('/entity.html?domain=TestDomain&id=city1%3Astate1%3Acountry1%3A1%3A11&type=city');
      expect(output.ABC123.headerExtractions[2].data[0].provenances.length).to.equal(0);
      expect(output.ABC123.headerExtractions[2].data[0].styleClass).to.equal('cityStyle');
      expect(output.ABC123.headerExtractions[2].data[0].text).to.equal('city1, state1');
      expect(output.ABC123.headerExtractions[2].data[0].type).to.equal('city');
      expect(output.ABC123.headerExtractions[2].data[0].width).to.not.exist;

      expect(output.ABC123.headerExtractions[2].data[1].confidence).to.not.exist;
      expect(output.ABC123.headerExtractions[2].data[1].count).to.not.exist;
      expect(output.ABC123.headerExtractions[2].data[1].highlight).to.not.exist;
      expect(output.ABC123.headerExtractions[2].data[1].id).to.equal('city2:state2:country2:2:22');
      expect(output.ABC123.headerExtractions[2].data[1].icon).to.equal('cityIcon');
      expect(output.ABC123.headerExtractions[2].data[1].link).to.equal('/entity.html?domain=TestDomain&id=city2%3Astate2%3Acountry2%3A2%3A22&type=city');
      expect(output.ABC123.headerExtractions[2].data[1].provenances.length).to.equal(0);
      expect(output.ABC123.headerExtractions[2].data[1].styleClass).to.equal('cityStyle');
      expect(output.ABC123.headerExtractions[2].data[1].text).to.equal('city2, state2');
      expect(output.ABC123.headerExtractions[2].data[1].type).to.equal('city');
      expect(output.ABC123.headerExtractions[2].data[1].width).to.not.exist;

      expect(output.ABC123.headerExtractions[3].isDate).to.be.false;
      expect(output.ABC123.headerExtractions[3].isUrl).to.be.false;
      expect(output.ABC123.headerExtractions[3].key).to.equal('label');
      expect(output.ABC123.headerExtractions[3].name).to.equal('Labels');
      expect(output.ABC123.headerExtractions[3].type).to.equal('string');
      expect(output.ABC123.headerExtractions[3].data.length).to.equal(2);

      expect(output.ABC123.headerExtractions[3].data[0].confidence).to.not.exist;
      expect(output.ABC123.headerExtractions[3].data[0].count).to.not.exist;
      expect(output.ABC123.headerExtractions[3].data[0].highlight).to.not.exist;
      expect(output.ABC123.headerExtractions[3].data[0].id).to.equal('label1');
      expect(output.ABC123.headerExtractions[3].data[0].icon).to.equal('labelIcon');
      expect(output.ABC123.headerExtractions[3].data[0].link).to.not.exist;
      expect(output.ABC123.headerExtractions[3].data[0].provenances.length).to.equal(0);
      expect(output.ABC123.headerExtractions[3].data[0].styleClass).to.equal('labelStyle');
      expect(output.ABC123.headerExtractions[3].data[0].text).to.equal('Label1');
      expect(output.ABC123.headerExtractions[3].data[0].type).to.equal('label');
      expect(output.ABC123.headerExtractions[3].data[0].width).to.not.exist;

      expect(output.ABC123.headerExtractions[3].data[1].confidence).to.not.exist;
      expect(output.ABC123.headerExtractions[3].data[1].count).to.not.exist;
      expect(output.ABC123.headerExtractions[3].data[1].highlight).to.not.exist;
      expect(output.ABC123.headerExtractions[3].data[1].id).to.equal('label2');
      expect(output.ABC123.headerExtractions[3].data[1].icon).to.equal('labelIcon');
      expect(output.ABC123.headerExtractions[3].data[1].link).to.not.exist;
      expect(output.ABC123.headerExtractions[3].data[1].provenances.length).to.equal(0);
      expect(output.ABC123.headerExtractions[3].data[1].styleClass).to.equal('labelStyle');
      expect(output.ABC123.headerExtractions[3].data[1].text).to.equal('Label2');
      expect(output.ABC123.headerExtractions[3].data[1].type).to.equal('label');
      expect(output.ABC123.headerExtractions[3].data[1].width).to.not.exist;

      expect(output.ABC123.detailExtractions[0].isDate).to.be.false;
      expect(output.ABC123.detailExtractions[0].isUrl).to.be.false;
      expect(output.ABC123.detailExtractions[0].key).to.equal('email');
      expect(output.ABC123.detailExtractions[0].name).to.equal('Emails');
      expect(output.ABC123.detailExtractions[0].type).to.equal('email');
      expect(output.ABC123.detailExtractions[0].data.length).to.equal(2);

      expect(output.ABC123.detailExtractions[0].data[0].confidence).to.not.exist;
      expect(output.ABC123.detailExtractions[0].data[0].count).to.not.exist;
      expect(output.ABC123.detailExtractions[0].data[0].highlight).to.not.exist;
      expect(output.ABC123.detailExtractions[0].data[0].id).to.equal('email1@address1.com');
      expect(output.ABC123.detailExtractions[0].data[0].icon).to.equal('emailIcon');
      expect(output.ABC123.detailExtractions[0].data[0].link).to.equal('/entity.html?domain=TestDomain&id=email1%40address1.com&type=email');
      expect(output.ABC123.detailExtractions[0].data[0].provenances.length).to.equal(0);
      expect(output.ABC123.detailExtractions[0].data[0].styleClass).to.equal('emailStyle');
      expect(output.ABC123.detailExtractions[0].data[0].text).to.equal('email1@address1.com');
      expect(output.ABC123.detailExtractions[0].data[0].type).to.equal('email');
      expect(output.ABC123.detailExtractions[0].data[0].width).to.not.exist;

      expect(output.ABC123.detailExtractions[0].data[1].confidence).to.not.exist;
      expect(output.ABC123.detailExtractions[0].data[1].count).to.not.exist;
      expect(output.ABC123.detailExtractions[0].data[1].highlight).to.not.exist;
      expect(output.ABC123.detailExtractions[0].data[1].id).to.equal('email2@address2.com');
      expect(output.ABC123.detailExtractions[0].data[1].icon).to.equal('emailIcon');
      expect(output.ABC123.detailExtractions[0].data[1].link).to.equal('/entity.html?domain=TestDomain&id=email2%40address2.com&type=email');
      expect(output.ABC123.detailExtractions[0].data[1].provenances.length).to.equal(0);
      expect(output.ABC123.detailExtractions[0].data[1].styleClass).to.equal('emailStyle');
      expect(output.ABC123.detailExtractions[0].data[1].text).to.equal('email2@address2.com');
      expect(output.ABC123.detailExtractions[0].data[1].type).to.equal('email');
      expect(output.ABC123.detailExtractions[0].data[1].width).to.not.exist;

      expect(output.ABC123.detailExtractions[1].isDate).to.be.false;
      expect(output.ABC123.detailExtractions[1].isUrl).to.be.false;
      expect(output.ABC123.detailExtractions[1].key).to.equal('number');
      expect(output.ABC123.detailExtractions[1].name).to.equal('Numbers');
      expect(output.ABC123.detailExtractions[1].type).to.equal('number');
      expect(output.ABC123.detailExtractions[1].data.length).to.equal(2);

      expect(output.ABC123.detailExtractions[1].data[0].confidence).to.not.exist;
      expect(output.ABC123.detailExtractions[1].data[0].count).to.not.exist;
      expect(output.ABC123.detailExtractions[1].data[0].highlight).to.not.exist;
      expect(output.ABC123.detailExtractions[1].data[0].id).to.equal(321);
      expect(output.ABC123.detailExtractions[1].data[0].icon).to.equal('numberIcon');
      expect(output.ABC123.detailExtractions[1].data[0].link).to.not.exist;
      expect(output.ABC123.detailExtractions[1].data[0].provenances.length).to.equal(0);
      expect(output.ABC123.detailExtractions[1].data[0].styleClass).to.equal('numberStyle');
      expect(output.ABC123.detailExtractions[1].data[0].text).to.equal(321);
      expect(output.ABC123.detailExtractions[1].data[0].type).to.equal('number');
      expect(output.ABC123.detailExtractions[1].data[0].width).to.not.exist;

      expect(output.ABC123.detailExtractions[1].data[1].confidence).to.not.exist;
      expect(output.ABC123.detailExtractions[1].data[1].count).to.not.exist;
      expect(output.ABC123.detailExtractions[1].data[1].highlight).to.not.exist;
      expect(output.ABC123.detailExtractions[1].data[1].id).to.equal(654);
      expect(output.ABC123.detailExtractions[1].data[1].icon).to.equal('numberIcon');
      expect(output.ABC123.detailExtractions[1].data[1].link).to.not.exist;
      expect(output.ABC123.detailExtractions[1].data[1].provenances.length).to.equal(0);
      expect(output.ABC123.detailExtractions[1].data[1].styleClass).to.equal('numberStyle');
      expect(output.ABC123.detailExtractions[1].data[1].text).to.equal(654);
      expect(output.ABC123.detailExtractions[1].data[1].type).to.equal('number');
      expect(output.ABC123.detailExtractions[1].data[1].width).to.not.exist;

      expect(output.ABC123.detailExtractions[2].isDate).to.be.false;
      expect(output.ABC123.detailExtractions[2].isUrl).to.be.false;
      expect(output.ABC123.detailExtractions[2].key).to.equal('phone');
      expect(output.ABC123.detailExtractions[2].name).to.equal('Phones');
      expect(output.ABC123.detailExtractions[2].type).to.equal('phone');
      expect(output.ABC123.detailExtractions[2].data.length).to.equal(2);

      expect(output.ABC123.detailExtractions[2].data[0].confidence).to.not.exist;
      expect(output.ABC123.detailExtractions[2].data[0].count).to.not.exist;
      expect(output.ABC123.detailExtractions[2].data[0].highlight).to.not.exist;
      expect(output.ABC123.detailExtractions[2].data[0].id).to.equal('1112223333');
      expect(output.ABC123.detailExtractions[2].data[0].icon).to.equal('phoneIcon');
      expect(output.ABC123.detailExtractions[2].data[0].link).to.equal('/entity.html?domain=TestDomain&id=1112223333&type=phone');
      expect(output.ABC123.detailExtractions[2].data[0].provenances.length).to.equal(0);
      expect(output.ABC123.detailExtractions[2].data[0].styleClass).to.equal('phoneStyle');
      expect(output.ABC123.detailExtractions[2].data[0].text).to.equal('111-222-3333');
      expect(output.ABC123.detailExtractions[2].data[0].type).to.equal('phone');
      expect(output.ABC123.detailExtractions[2].data[0].width).to.not.exist;

      expect(output.ABC123.detailExtractions[2].data[1].confidence).to.not.exist;
      expect(output.ABC123.detailExtractions[2].data[1].count).to.not.exist;
      expect(output.ABC123.detailExtractions[2].data[1].highlight).to.not.exist;
      expect(output.ABC123.detailExtractions[2].data[1].id).to.equal('4445556666');
      expect(output.ABC123.detailExtractions[2].data[1].icon).to.equal('phoneIcon');
      expect(output.ABC123.detailExtractions[2].data[1].link).to.equal('/entity.html?domain=TestDomain&id=4445556666&type=phone');
      expect(output.ABC123.detailExtractions[2].data[1].provenances.length).to.equal(0);
      expect(output.ABC123.detailExtractions[2].data[1].styleClass).to.equal('phoneStyle');
      expect(output.ABC123.detailExtractions[2].data[1].text).to.equal('444-555-6666');
      expect(output.ABC123.detailExtractions[2].data[1].type).to.equal('phone');
      expect(output.ABC123.detailExtractions[2].data[1].width).to.not.exist;

      expect(output.ABC123.detailExtractions[3].isDate).to.be.false;
      expect(output.ABC123.detailExtractions[3].isUrl).to.be.false;
      expect(output.ABC123.detailExtractions[3].key).to.equal('price');
      expect(output.ABC123.detailExtractions[3].name).to.equal('Prices');
      expect(output.ABC123.detailExtractions[3].type).to.equal('hyphenated');
      expect(output.ABC123.detailExtractions[3].data.length).to.equal(2);

      expect(output.ABC123.detailExtractions[3].data[0].confidence).to.not.exist;
      expect(output.ABC123.detailExtractions[3].data[0].count).to.not.exist;
      expect(output.ABC123.detailExtractions[3].data[0].highlight).to.not.exist;
      expect(output.ABC123.detailExtractions[3].data[0].id).to.equal('price1-currency:currency1-time_unit:time1');
      expect(output.ABC123.detailExtractions[3].data[0].icon).to.equal('priceIcon');
      expect(output.ABC123.detailExtractions[3].data[0].link).to.not.exist;
      expect(output.ABC123.detailExtractions[3].data[0].provenances.length).to.equal(0);
      expect(output.ABC123.detailExtractions[3].data[0].styleClass).to.equal('priceStyle');
      expect(output.ABC123.detailExtractions[3].data[0].text).to.equal('price1 currency1 per time1 minutes');
      expect(output.ABC123.detailExtractions[3].data[0].type).to.equal('price');
      expect(output.ABC123.detailExtractions[3].data[0].width).to.not.exist;

      expect(output.ABC123.detailExtractions[3].data[1].confidence).to.not.exist;
      expect(output.ABC123.detailExtractions[3].data[1].count).to.not.exist;
      expect(output.ABC123.detailExtractions[3].data[1].highlight).to.not.exist;
      expect(output.ABC123.detailExtractions[3].data[1].id).to.equal('price2-currency:currency2-time_unit:time2');
      expect(output.ABC123.detailExtractions[3].data[1].icon).to.equal('priceIcon');
      expect(output.ABC123.detailExtractions[3].data[1].link).to.not.exist;
      expect(output.ABC123.detailExtractions[3].data[1].provenances.length).to.equal(0);
      expect(output.ABC123.detailExtractions[3].data[1].styleClass).to.equal('priceStyle');
      expect(output.ABC123.detailExtractions[3].data[1].text).to.equal('price2 currency2 per time2 minutes');
      expect(output.ABC123.detailExtractions[3].data[1].type).to.equal('price');
      expect(output.ABC123.detailExtractions[3].data[1].width).to.not.exist;

      expect(output.ABC123.detailExtractions[4].isDate).to.be.false;
      expect(output.ABC123.detailExtractions[4].isUrl).to.be.false;
      expect(output.ABC123.detailExtractions[4].key).to.equal('unnested');
      expect(output.ABC123.detailExtractions[4].name).to.equal('Unnested Items');
      expect(output.ABC123.detailExtractions[4].type).to.equal('string');
      expect(output.ABC123.detailExtractions[4].data.length).to.equal(2);

      expect(output.ABC123.detailExtractions[4].data[0].confidence).to.not.exist;
      expect(output.ABC123.detailExtractions[4].data[0].count).to.not.exist;
      expect(output.ABC123.detailExtractions[4].data[0].highlight).to.not.exist;
      expect(output.ABC123.detailExtractions[4].data[0].id).to.equal('unnested1');
      expect(output.ABC123.detailExtractions[4].data[0].icon).to.equal('unnestedIcon');
      expect(output.ABC123.detailExtractions[4].data[0].link).to.not.exist;
      expect(output.ABC123.detailExtractions[4].data[0].provenances.length).to.equal(0);
      expect(output.ABC123.detailExtractions[4].data[0].styleClass).to.equal('unnestedStyle');
      expect(output.ABC123.detailExtractions[4].data[0].text).to.equal('unnested1');
      expect(output.ABC123.detailExtractions[4].data[0].type).to.equal('unnested');
      expect(output.ABC123.detailExtractions[4].data[0].width).to.not.exist;

      expect(output.ABC123.detailExtractions[4].data[1].confidence).to.not.exist;
      expect(output.ABC123.detailExtractions[4].data[1].count).to.not.exist;
      expect(output.ABC123.detailExtractions[4].data[1].highlight).to.not.exist;
      expect(output.ABC123.detailExtractions[4].data[1].id).to.equal('unnested2');
      expect(output.ABC123.detailExtractions[4].data[1].icon).to.equal('unnestedIcon');
      expect(output.ABC123.detailExtractions[4].data[1].link).to.not.exist;
      expect(output.ABC123.detailExtractions[4].data[1].provenances.length).to.equal(0);
      expect(output.ABC123.detailExtractions[4].data[1].styleClass).to.equal('unnestedStyle');
      expect(output.ABC123.detailExtractions[4].data[1].text).to.equal('unnested2');
      expect(output.ABC123.detailExtractions[4].data[1].type).to.equal('unnested');
      expect(output.ABC123.detailExtractions[4].data[1].width).to.not.exist;

      expect(output.ABC123.detailExtractions[5].isDate).to.be.false;
      expect(output.ABC123.detailExtractions[5].isUrl).to.be.false;
      expect(output.ABC123.detailExtractions[5].key).to.equal('user');
      expect(output.ABC123.detailExtractions[5].name).to.equal('Users');
      expect(output.ABC123.detailExtractions[5].type).to.equal('username');
      expect(output.ABC123.detailExtractions[5].data.length).to.equal(2);

      expect(output.ABC123.detailExtractions[5].data[0].confidence).to.not.exist;
      expect(output.ABC123.detailExtractions[5].data[0].count).to.not.exist;
      expect(output.ABC123.detailExtractions[5].data[0].highlight).to.not.exist;
      expect(output.ABC123.detailExtractions[5].data[0].id).to.equal('type1 user1');
      expect(output.ABC123.detailExtractions[5].data[0].icon).to.equal('userIcon');
      expect(output.ABC123.detailExtractions[5].data[0].link).to.equal('/entity.html?domain=TestDomain&id=type1%20user1&type=user');
      expect(output.ABC123.detailExtractions[5].data[0].provenances.length).to.equal(0);
      expect(output.ABC123.detailExtractions[5].data[0].styleClass).to.equal('userStyle');
      expect(output.ABC123.detailExtractions[5].data[0].text).to.equal('User1');
      expect(output.ABC123.detailExtractions[5].data[0].type).to.equal('user');
      expect(output.ABC123.detailExtractions[5].data[0].width).to.not.exist;

      expect(output.ABC123.detailExtractions[5].data[1].confidence).to.not.exist;
      expect(output.ABC123.detailExtractions[5].data[1].count).to.not.exist;
      expect(output.ABC123.detailExtractions[5].data[1].highlight).to.not.exist;
      expect(output.ABC123.detailExtractions[5].data[1].id).to.equal('type2 user2');
      expect(output.ABC123.detailExtractions[5].data[1].icon).to.equal('userIcon');
      expect(output.ABC123.detailExtractions[5].data[1].link).to.equal('/entity.html?domain=TestDomain&id=type2%20user2&type=user');
      expect(output.ABC123.detailExtractions[5].data[1].provenances.length).to.equal(0);
      expect(output.ABC123.detailExtractions[5].data[1].styleClass).to.equal('userStyle');
      expect(output.ABC123.detailExtractions[5].data[1].text).to.equal('User2');
      expect(output.ABC123.detailExtractions[5].data[1].type).to.equal('user');
      expect(output.ABC123.detailExtractions[5].data[1].width).to.not.exist;

      expect(output.ABC123.nestedExtractions[0].isDate).to.be.false;
      expect(output.ABC123.nestedExtractions[0].isUrl).to.be.false;
      expect(output.ABC123.nestedExtractions[0].key).to.equal('comment');
      expect(output.ABC123.nestedExtractions[0].name).to.equal('Comments');
      expect(output.ABC123.nestedExtractions[0].type).to.equal('kg_id');
      expect(output.ABC123.nestedExtractions[0].data.length).to.equal(2);

      expect(output.ABC123.nestedExtractions[0].data[0].confidence).to.not.exist;
      expect(output.ABC123.nestedExtractions[0].data[0].count).to.not.exist;
      expect(output.ABC123.nestedExtractions[0].data[0].id).to.equal('comment1');
      expect(output.ABC123.nestedExtractions[0].data[0].icon).to.equal('commentIcon');
      expect(output.ABC123.nestedExtractions[0].data[0].link).to.equal('/result.html?domain=TestDomain&id=comment1');
      expect(output.ABC123.nestedExtractions[0].data[0].provenances.length).to.equal(0);
      expect(output.ABC123.nestedExtractions[0].data[0].styleClass).to.equal('commentStyle');
      expect(output.ABC123.nestedExtractions[0].data[0].text).to.equal('comment1');
      expect(output.ABC123.nestedExtractions[0].data[0].type).to.equal('comment');
      expect(output.ABC123.nestedExtractions[0].data[0].width).to.not.exist;

      expect(output.ABC123.nestedExtractions[0].data[1].confidence).to.not.exist;
      expect(output.ABC123.nestedExtractions[0].data[1].count).to.not.exist;
      expect(output.ABC123.nestedExtractions[0].data[1].id).to.equal('comment2');
      expect(output.ABC123.nestedExtractions[0].data[1].icon).to.equal('commentIcon');
      expect(output.ABC123.nestedExtractions[0].data[1].link).to.equal('/result.html?domain=TestDomain&id=comment2');
      expect(output.ABC123.nestedExtractions[0].data[1].provenances.length).to.equal(0);
      expect(output.ABC123.nestedExtractions[0].data[1].styleClass).to.equal('commentStyle');
      expect(output.ABC123.nestedExtractions[0].data[1].text).to.equal('comment2');
      expect(output.ABC123.nestedExtractions[0].data[1].type).to.equal('comment');
      expect(output.ABC123.nestedExtractions[0].data[1].width).to.not.exist;

      expect(output.ABC123.details[0].name).to.equal('Url');
      expect(output.ABC123.details[0].link).to.equal('testUrl1');
      expect(output.ABC123.details[0].text).to.equal('testUrl1');

      expect(output.ABC123.details[1].name).to.equal('Description');
      expect(output.ABC123.details[1].highlightedText).to.equal('This is description 1');
      expect(output.ABC123.details[1].text).to.equal('This is description 1');

      expect(output.ABC123.details[2].name).to.equal('Cached Page');
      expect(output.ABC123.details[2].link).to.equal('/cached.html?domain=TestDomain&id=ABC123');
      expect(output.ABC123.details[2].text).to.equal('Open in New Tab (Runs External Code)');

      expect(output.DEF456.id).to.equal('DEF456');
      expect(output.DEF456.description).to.equal('This is description 3');
      expect(output.DEF456.highlightedText).to.equal('Title 3');
      expect(output.DEF456.icon).to.equal('commentIcon');
      expect(output.DEF456.link).to.equal('/result.html?domain=TestDomain&id=DEF456');
      expect(output.DEF456.name).to.equal('Comment');
      expect(output.DEF456.styleClass).to.equal('commentStyle');
      expect(output.DEF456.tags).to.deep.equal({});
      expect(output.DEF456.title).to.equal('Title 3');
      expect(output.DEF456.type).to.equal('comment');
      expect(output.DEF456.url).to.equal('testUrl2');

      expect(output.DEF456.timestamp).to.not.exist;
      expect(output.DEF456.esData).to.not.exist;
      expect(output.DEF456.images).to.not.exist;
      expect(output.DEF456.headerExtractions.length).to.equal(4);
      expect(output.DEF456.detailExtractions.length).to.equal(6);
      expect(output.DEF456.nestedExtractions.length).to.equal(1);
      expect(output.DEF456.details.length).to.equal(3);

      expect(output.DEF456.headerExtractions[0].isDate).to.be.false;
      expect(output.DEF456.headerExtractions[0].isUrl).to.be.true;
      expect(output.DEF456.headerExtractions[0].key).to.equal('website');
      expect(output.DEF456.headerExtractions[0].name).to.equal('Website');
      expect(output.DEF456.headerExtractions[0].type).to.equal('url');
      expect(output.DEF456.headerExtractions[0].data.length).to.equal(1);

      expect(output.DEF456.headerExtractions[0].data[0].confidence).to.not.exist;
      expect(output.DEF456.headerExtractions[0].data[0].count).to.not.exist;
      expect(output.DEF456.headerExtractions[0].data[0].highlight).to.not.exist;
      expect(output.DEF456.headerExtractions[0].data[0].id).to.equal('website3.com');
      expect(output.DEF456.headerExtractions[0].data[0].icon).to.equal('websiteIcon');
      expect(output.DEF456.headerExtractions[0].data[0].link).to.not.exist;
      expect(output.DEF456.headerExtractions[0].data[0].provenances.length).to.equal(0);
      expect(output.DEF456.headerExtractions[0].data[0].styleClass).to.equal('websiteStyle');
      expect(output.DEF456.headerExtractions[0].data[0].text).to.equal('website3.com');
      expect(output.DEF456.headerExtractions[0].data[0].type).to.equal('website');
      expect(output.DEF456.headerExtractions[0].data[0].width).to.not.exist;

      expect(output.DEF456.headerExtractions[1].isDate).to.be.true;
      expect(output.DEF456.headerExtractions[1].isUrl).to.be.false;
      expect(output.DEF456.headerExtractions[1].key).to.equal('date');
      expect(output.DEF456.headerExtractions[1].name).to.equal('Date');
      expect(output.DEF456.headerExtractions[1].type).to.equal('date');
      expect(output.DEF456.headerExtractions[1].data.length).to.equal(1);

      expect(output.DEF456.headerExtractions[1].data[0].confidence).to.not.exist;
      expect(output.DEF456.headerExtractions[1].data[0].count).to.not.exist;
      expect(output.DEF456.headerExtractions[1].data[0].highlight).to.not.exist;
      expect(output.DEF456.headerExtractions[1].data[0].id).to.equal('date3');
      expect(output.DEF456.headerExtractions[1].data[0].icon).to.equal('dateIcon');
      expect(output.DEF456.headerExtractions[1].data[0].link).to.not.exist;
      expect(output.DEF456.headerExtractions[1].data[0].provenances.length).to.equal(0);
      expect(output.DEF456.headerExtractions[1].data[0].styleClass).to.equal('dateStyle');
      expect(output.DEF456.headerExtractions[1].data[0].text).to.equal('Mar 3, 2018');
      expect(output.DEF456.headerExtractions[1].data[0].type).to.equal('date');
      expect(output.DEF456.headerExtractions[1].data[0].width).to.not.exist;

      expect(output.DEF456.headerExtractions[2].isDate).to.be.false;
      expect(output.DEF456.headerExtractions[2].isUrl).to.be.false;
      expect(output.DEF456.headerExtractions[2].key).to.equal('city');
      expect(output.DEF456.headerExtractions[2].name).to.equal('City');
      expect(output.DEF456.headerExtractions[2].type).to.equal('location');
      expect(output.DEF456.headerExtractions[2].data.length).to.equal(1);

      expect(output.DEF456.headerExtractions[2].data[0].confidence).to.not.exist;
      expect(output.DEF456.headerExtractions[2].data[0].count).to.not.exist;
      expect(output.DEF456.headerExtractions[2].data[0].highlight).to.not.exist;
      expect(output.DEF456.headerExtractions[2].data[0].id).to.equal('city3:state3:country3:3:33');
      expect(output.DEF456.headerExtractions[2].data[0].icon).to.equal('cityIcon');
      expect(output.DEF456.headerExtractions[2].data[0].link).to.equal('/entity.html?domain=TestDomain&id=city3%3Astate3%3Acountry3%3A3%3A33&type=city');
      expect(output.DEF456.headerExtractions[2].data[0].provenances.length).to.equal(0);
      expect(output.DEF456.headerExtractions[2].data[0].styleClass).to.equal('cityStyle');
      expect(output.DEF456.headerExtractions[2].data[0].text).to.equal('city3, state3');
      expect(output.DEF456.headerExtractions[2].data[0].type).to.equal('city');
      expect(output.DEF456.headerExtractions[2].data[0].width).to.not.exist;

      expect(output.DEF456.headerExtractions[3].isDate).to.be.false;
      expect(output.DEF456.headerExtractions[3].isUrl).to.be.false;
      expect(output.DEF456.headerExtractions[3].key).to.equal('label');
      expect(output.DEF456.headerExtractions[3].name).to.equal('Label');
      expect(output.DEF456.headerExtractions[3].type).to.equal('string');
      expect(output.DEF456.headerExtractions[3].data.length).to.equal(1);

      expect(output.DEF456.headerExtractions[3].data[0].confidence).to.not.exist;
      expect(output.DEF456.headerExtractions[3].data[0].count).to.not.exist;
      expect(output.DEF456.headerExtractions[3].data[0].highlight).to.not.exist;
      expect(output.DEF456.headerExtractions[3].data[0].id).to.equal('label3');
      expect(output.DEF456.headerExtractions[3].data[0].icon).to.equal('labelIcon');
      expect(output.DEF456.headerExtractions[3].data[0].link).to.not.exist;
      expect(output.DEF456.headerExtractions[3].data[0].provenances.length).to.equal(0);
      expect(output.DEF456.headerExtractions[3].data[0].styleClass).to.equal('labelStyle');
      expect(output.DEF456.headerExtractions[3].data[0].text).to.equal('Label3');
      expect(output.DEF456.headerExtractions[3].data[0].type).to.equal('label');
      expect(output.DEF456.headerExtractions[3].data[0].width).to.not.exist;

      expect(output.DEF456.detailExtractions[0].isDate).to.be.false;
      expect(output.DEF456.detailExtractions[0].isUrl).to.be.false;
      expect(output.DEF456.detailExtractions[0].key).to.equal('email');
      expect(output.DEF456.detailExtractions[0].name).to.equal('Email');
      expect(output.DEF456.detailExtractions[0].type).to.equal('email');
      expect(output.DEF456.detailExtractions[0].data.length).to.equal(1);

      expect(output.DEF456.detailExtractions[0].data[0].confidence).to.not.exist;
      expect(output.DEF456.detailExtractions[0].data[0].count).to.not.exist;
      expect(output.DEF456.detailExtractions[0].data[0].highlight).to.not.exist;
      expect(output.DEF456.detailExtractions[0].data[0].id).to.equal('email3@address3.com');
      expect(output.DEF456.detailExtractions[0].data[0].icon).to.equal('emailIcon');
      expect(output.DEF456.detailExtractions[0].data[0].link).to.equal('/entity.html?domain=TestDomain&id=email3%40address3.com&type=email');
      expect(output.DEF456.detailExtractions[0].data[0].provenances.length).to.equal(0);
      expect(output.DEF456.detailExtractions[0].data[0].styleClass).to.equal('emailStyle');
      expect(output.DEF456.detailExtractions[0].data[0].text).to.equal('email3@address3.com');
      expect(output.DEF456.detailExtractions[0].data[0].type).to.equal('email');
      expect(output.DEF456.detailExtractions[0].data[0].width).to.not.exist;

      expect(output.DEF456.detailExtractions[1].isDate).to.be.false;
      expect(output.DEF456.detailExtractions[1].isUrl).to.be.false;
      expect(output.DEF456.detailExtractions[1].key).to.equal('number');
      expect(output.DEF456.detailExtractions[1].name).to.equal('Number');
      expect(output.DEF456.detailExtractions[1].type).to.equal('number');
      expect(output.DEF456.detailExtractions[1].data.length).to.equal(1);

      expect(output.DEF456.detailExtractions[1].data[0].confidence).to.not.exist;
      expect(output.DEF456.detailExtractions[1].data[0].count).to.not.exist;
      expect(output.DEF456.detailExtractions[1].data[0].highlight).to.not.exist;
      expect(output.DEF456.detailExtractions[1].data[0].id).to.equal(987);
      expect(output.DEF456.detailExtractions[1].data[0].icon).to.equal('numberIcon');
      expect(output.DEF456.detailExtractions[1].data[0].link).to.not.exist;
      expect(output.DEF456.detailExtractions[1].data[0].provenances.length).to.equal(0);
      expect(output.DEF456.detailExtractions[1].data[0].styleClass).to.equal('numberStyle');
      expect(output.DEF456.detailExtractions[1].data[0].text).to.equal(987);
      expect(output.DEF456.detailExtractions[1].data[0].type).to.equal('number');
      expect(output.DEF456.detailExtractions[1].data[0].width).to.not.exist;

      expect(output.DEF456.detailExtractions[2].isDate).to.be.false;
      expect(output.DEF456.detailExtractions[2].isUrl).to.be.false;
      expect(output.DEF456.detailExtractions[2].key).to.equal('phone');
      expect(output.DEF456.detailExtractions[2].name).to.equal('Phone');
      expect(output.DEF456.detailExtractions[2].type).to.equal('phone');
      expect(output.DEF456.detailExtractions[2].data.length).to.equal(1);

      expect(output.DEF456.detailExtractions[2].data[0].confidence).to.not.exist;
      expect(output.DEF456.detailExtractions[2].data[0].count).to.not.exist;
      expect(output.DEF456.detailExtractions[2].data[0].highlight).to.not.exist;
      expect(output.DEF456.detailExtractions[2].data[0].id).to.equal('7778889999');
      expect(output.DEF456.detailExtractions[2].data[0].icon).to.equal('phoneIcon');
      expect(output.DEF456.detailExtractions[2].data[0].link).to.equal('/entity.html?domain=TestDomain&id=7778889999&type=phone');
      expect(output.DEF456.detailExtractions[2].data[0].provenances.length).to.equal(0);
      expect(output.DEF456.detailExtractions[2].data[0].styleClass).to.equal('phoneStyle');
      expect(output.DEF456.detailExtractions[2].data[0].text).to.equal('777-888-9999');
      expect(output.DEF456.detailExtractions[2].data[0].type).to.equal('phone');
      expect(output.DEF456.detailExtractions[2].data[0].width).to.not.exist;

      expect(output.DEF456.detailExtractions[3].isDate).to.be.false;
      expect(output.DEF456.detailExtractions[3].isUrl).to.be.false;
      expect(output.DEF456.detailExtractions[3].key).to.equal('price');
      expect(output.DEF456.detailExtractions[3].name).to.equal('Price');
      expect(output.DEF456.detailExtractions[3].type).to.equal('hyphenated');
      expect(output.DEF456.detailExtractions[3].data.length).to.equal(1);

      expect(output.DEF456.detailExtractions[3].data[0].confidence).to.not.exist;
      expect(output.DEF456.detailExtractions[3].data[0].count).to.not.exist;
      expect(output.DEF456.detailExtractions[3].data[0].highlight).to.not.exist;
      expect(output.DEF456.detailExtractions[3].data[0].id).to.equal('price3-currency:currency3-time_unit:time3');
      expect(output.DEF456.detailExtractions[3].data[0].icon).to.equal('priceIcon');
      expect(output.DEF456.detailExtractions[3].data[0].link).to.not.exist;
      expect(output.DEF456.detailExtractions[3].data[0].provenances.length).to.equal(0);
      expect(output.DEF456.detailExtractions[3].data[0].styleClass).to.equal('priceStyle');
      expect(output.DEF456.detailExtractions[3].data[0].text).to.equal('price3 currency3 per time3 minutes');
      expect(output.DEF456.detailExtractions[3].data[0].type).to.equal('price');
      expect(output.DEF456.detailExtractions[3].data[0].width).to.not.exist;

      expect(output.DEF456.detailExtractions[4].isDate).to.be.false;
      expect(output.DEF456.detailExtractions[4].isUrl).to.be.false;
      expect(output.DEF456.detailExtractions[4].key).to.equal('unnested');
      expect(output.DEF456.detailExtractions[4].name).to.equal('Unnested Item');
      expect(output.DEF456.detailExtractions[4].type).to.equal('string');
      expect(output.DEF456.detailExtractions[4].data.length).to.equal(1);

      expect(output.DEF456.detailExtractions[4].data[0].confidence).to.not.exist;
      expect(output.DEF456.detailExtractions[4].data[0].count).to.not.exist;
      expect(output.DEF456.detailExtractions[4].data[0].highlight).to.not.exist;
      expect(output.DEF456.detailExtractions[4].data[0].id).to.equal('unnested3');
      expect(output.DEF456.detailExtractions[4].data[0].icon).to.equal('unnestedIcon');
      expect(output.DEF456.detailExtractions[4].data[0].link).to.not.exist;
      expect(output.DEF456.detailExtractions[4].data[0].provenances.length).to.equal(0);
      expect(output.DEF456.detailExtractions[4].data[0].styleClass).to.equal('unnestedStyle');
      expect(output.DEF456.detailExtractions[4].data[0].text).to.equal('unnested3');
      expect(output.DEF456.detailExtractions[4].data[0].type).to.equal('unnested');
      expect(output.DEF456.detailExtractions[4].data[0].width).to.not.exist;

      expect(output.DEF456.detailExtractions[5].isDate).to.be.false;
      expect(output.DEF456.detailExtractions[5].isUrl).to.be.false;
      expect(output.DEF456.detailExtractions[5].key).to.equal('user');
      expect(output.DEF456.detailExtractions[5].name).to.equal('User');
      expect(output.DEF456.detailExtractions[5].type).to.equal('username');
      expect(output.DEF456.detailExtractions[5].data.length).to.equal(1);

      expect(output.DEF456.detailExtractions[5].data[0].confidence).to.not.exist;
      expect(output.DEF456.detailExtractions[5].data[0].count).to.not.exist;
      expect(output.DEF456.detailExtractions[5].data[0].highlight).to.not.exist;
      expect(output.DEF456.detailExtractions[5].data[0].id).to.equal('type3 user3');
      expect(output.DEF456.detailExtractions[5].data[0].icon).to.equal('userIcon');
      expect(output.DEF456.detailExtractions[5].data[0].link).to.equal('/entity.html?domain=TestDomain&id=type3%20user3&type=user');
      expect(output.DEF456.detailExtractions[5].data[0].provenances.length).to.equal(0);
      expect(output.DEF456.detailExtractions[5].data[0].styleClass).to.equal('userStyle');
      expect(output.DEF456.detailExtractions[5].data[0].text).to.equal('User3');
      expect(output.DEF456.detailExtractions[5].data[0].type).to.equal('user');
      expect(output.DEF456.detailExtractions[5].data[0].width).to.not.exist;

      expect(output.DEF456.nestedExtractions[0].isDate).to.be.false;
      expect(output.DEF456.nestedExtractions[0].isUrl).to.be.false;
      expect(output.DEF456.nestedExtractions[0].key).to.equal('comment');
      expect(output.DEF456.nestedExtractions[0].name).to.equal('Comment');
      expect(output.DEF456.nestedExtractions[0].type).to.equal('kg_id');
      expect(output.DEF456.nestedExtractions[0].data.length).to.equal(1);

      expect(output.DEF456.nestedExtractions[0].data[0].confidence).to.not.exist;
      expect(output.DEF456.nestedExtractions[0].data[0].count).to.not.exist;
      expect(output.DEF456.nestedExtractions[0].data[0].id).to.equal('comment3');
      expect(output.DEF456.nestedExtractions[0].data[0].icon).to.equal('commentIcon');
      expect(output.DEF456.nestedExtractions[0].data[0].link).to.equal('/result.html?domain=TestDomain&id=comment3');
      expect(output.DEF456.nestedExtractions[0].data[0].provenances.length).to.equal(0);
      expect(output.DEF456.nestedExtractions[0].data[0].styleClass).to.equal('commentStyle');
      expect(output.DEF456.nestedExtractions[0].data[0].text).to.equal('comment3');
      expect(output.DEF456.nestedExtractions[0].data[0].type).to.equal('comment');
      expect(output.DEF456.nestedExtractions[0].data[0].width).to.not.exist;

      expect(output.DEF456.details[0].name).to.equal('Url');
      expect(output.DEF456.details[0].link).to.equal('testUrl2');
      expect(output.DEF456.details[0].text).to.equal('testUrl2');

      expect(output.DEF456.details[1].name).to.equal('Description');
      expect(output.DEF456.details[1].highlightedText).to.equal('This is description 3');
      expect(output.DEF456.details[1].text).to.equal('This is description 3');

      expect(output.DEF456.details[2].name).to.equal('Cached Page');
      expect(output.DEF456.details[2].link).to.equal('/cached.html?domain=TestDomain&id=DEF456');
      expect(output.DEF456.details[2].text).to.equal('Open in New Tab (Runs External Code)');
    });

    test('nestedResults given images does return expected object', function() {
      /* jscs:disable requireCamelCaseOrUpperCaseIdentifiers */
      var output = transformFunctions.transforms.entity.nestedResults({
        hits: {
          hits: [{
            _source: {
              doc_id: 'ABC123',
              objects: [{
                img_sha1: 'image1'
              }, {
                img_sha1: 'image2'
              }],
              url: 'testUrl1'
            }
          }, {
            _source: {
              doc_id: 'DEF456',
              objects: [{
                img_sha1: 'image3'
              }],
              url: 'testUrl2'
            }
          }]
        }
      }, {
        extractionId: 'comment',
        searchFields: SEARCH_FIELDS
      });
      /* jscs:enable requireCamelCaseOrUpperCaseIdentifiers */

      expect(output.ABC123.images.length).to.equal(2);

      expect(output.ABC123.images[0].confidence).to.not.exist;
      expect(output.ABC123.images[0].count).to.not.exist;
      expect(output.ABC123.images[0].id).to.equal('image1');
      expect(output.ABC123.images[0].icon).to.equal('image:photo');
      expect(output.ABC123.images[0].link).to.equal('/entity.html?domain=TestDomain&id=image1&type=image');
      expect(output.ABC123.images[0].provenances.length).to.equal(0);
      expect(output.ABC123.images[0].styleClass).to.not.exist;
      expect(output.ABC123.images[0].text).to.equal('Image #1');
      expect(output.ABC123.images[0].type).to.equal('image');
      expect(output.ABC123.images[0].width).to.not.exist;

      expect(output.ABC123.images[1].confidence).to.not.exist;
      expect(output.ABC123.images[1].count).to.not.exist;
      expect(output.ABC123.images[1].id).to.equal('image2');
      expect(output.ABC123.images[1].icon).to.equal('image:photo');
      expect(output.ABC123.images[1].link).to.equal('/entity.html?domain=TestDomain&id=image2&type=image');
      expect(output.ABC123.images[1].provenances.length).to.equal(0);
      expect(output.ABC123.images[1].styleClass).to.not.exist;
      expect(output.ABC123.images[1].text).to.equal('Image #2');
      expect(output.ABC123.images[1].type).to.equal('image');
      expect(output.ABC123.images[1].width).to.not.exist;

      expect(output.DEF456.images.length).to.equal(1);

      expect(output.DEF456.images[0].confidence).to.not.exist;
      expect(output.DEF456.images[0].count).to.not.exist;
      expect(output.DEF456.images[0].id).to.equal('image3');
      expect(output.DEF456.images[0].icon).to.equal('image:photo');
      expect(output.DEF456.images[0].link).to.equal('/entity.html?domain=TestDomain&id=image3&type=image');
      expect(output.DEF456.images[0].provenances.length).to.equal(0);
      expect(output.DEF456.images[0].styleClass).to.not.exist;
      expect(output.DEF456.images[0].text).to.equal('Image #1');
      expect(output.DEF456.images[0].type).to.equal('image');
      expect(output.DEF456.images[0].width).to.not.exist;
    });

    test('result given incomplete data does return empty object', function() {
      expect(transformFunctions.transforms.entity.result({}, SEARCH_FIELDS)).to.deep.equal({});
      expect(transformFunctions.transforms.entity.result({
        hits: {}
      }, SEARCH_FIELDS)).to.deep.equal({});
      expect(transformFunctions.transforms.entity.result({
        hits: {
          hits: []
        }
      }, SEARCH_FIELDS)).to.deep.equal({});
      expect(transformFunctions.transforms.entity.result({
        hits: {
          hits: [{}]
        }
      }, SEARCH_FIELDS)).to.deep.equal({});
      expect(transformFunctions.transforms.entity.result({
        hits: {
          hits: [{}]
        }
      }, SEARCH_FIELDS)).to.deep.equal({});
      expect(transformFunctions.transforms.entity.result({
        hits: {
          hits: [{
            _source: {}
          }]
        }
      }, SEARCH_FIELDS)).to.deep.equal({});
    });

    test('result given no extractions does return expected object', function() {
      /* jscs:disable requireCamelCaseOrUpperCaseIdentifiers */
      var output = transformFunctions.transforms.entity.result({
        hits: {
          hits: [{
            _source: {
              doc_id: 'ABC123',
              url: 'testUrl1'
            }
          }]
        }
      }, SEARCH_FIELDS);
      /* jscs:enable requireCamelCaseOrUpperCaseIdentifiers */

      expect(output.id).to.equal('ABC123');
      expect(output.description).to.equal('');
      expect(output.highlightedText).to.equal('');
      expect(output.icon).to.equal('TestIcon');
      expect(output.link).to.equal('/result.html?domain=TestDomain&id=ABC123');
      expect(output.name).to.equal('TestResult');
      expect(output.tags).to.deep.equal({});
      expect(output.title).to.equal('');
      expect(output.type).to.equal('webpage');
      expect(output.url).to.equal('testUrl1');

      expect(output.timestamp).to.not.exist;
      expect(output.esData).to.not.exist;
      expect(output.images).to.not.exist;
      expect(output.styleClass).to.not.exist;

      expect(output.headerExtractions).to.deep.equal([{
        data: [],
        icon: 'websiteIcon',
        isDate: false,
        isUrl: true,
        key: 'website',
        name: 'Websites',
        styleClass: 'websiteStyle',
        type: 'url',
        width: undefined,
        index: 3
      }, {
        data: [],
        icon: 'dateIcon',
        isDate: true,
        isUrl: false,
        key: 'date',
        name: 'Dates',
        styleClass: 'dateStyle',
        type: 'date',
        width: undefined,
        index: 1
      }, {
        data: [],
        icon: 'cityIcon',
        isDate: false,
        isUrl: false,
        key: 'city',
        name: 'Cities',
        styleClass: 'cityStyle',
        type: 'location',
        width: undefined,
        index: 0
      }, {
        data: [],
        icon: 'labelIcon',
        isDate: false,
        isUrl: false,
        key: 'label',
        name: 'Labels',
        styleClass: 'labelStyle',
        type: 'string',
        width: undefined,
        index: 2
      }]);

      expect(output.detailExtractions).to.deep.equal([{
        data: [],
        icon: 'emailIcon',
        isDate: false,
        isUrl: false,
        key: 'email',
        name: 'Emails',
        styleClass: 'emailStyle',
        type: 'email',
        width: undefined
      }, {
        data: [],
        icon: 'numberIcon',
        isDate: false,
        isUrl: false,
        key: 'number',
        name: 'Numbers',
        styleClass: 'numberStyle',
        type: 'number',
        width: undefined
      }, {
        data: [],
        icon: 'phoneIcon',
        isDate: false,
        isUrl: false,
        key: 'phone',
        name: 'Phones',
        styleClass: 'phoneStyle',
        type: 'phone',
        width: undefined
      }, {
        data: [],
        icon: 'priceIcon',
        isDate: false,
        isUrl: false,
        key: 'price',
        name: 'Prices',
        styleClass: 'priceStyle',
        type: 'hyphenated',
        width: undefined
      }, {
        data: [],
        icon: 'unnestedIcon',
        isDate: false,
        isUrl: false,
        key: 'unnested',
        name: 'Unnested Items',
        styleClass: 'unnestedStyle',
        type: 'string',
        width: undefined
      }, {
        data: [],
        icon: 'userIcon',
        isDate: false,
        isUrl: false,
        key: 'user',
        name: 'Users',
        styleClass: 'userStyle',
        type: 'username',
        width: undefined
      }]);

      expect(output.nestedExtractions).to.deep.equal([{
        data: [],
        icon: 'commentIcon',
        isDate: false,
        isUrl: false,
        key: 'comment',
        name: 'Comments',
        styleClass: 'commentStyle',
        type: 'kg_id',
        width: undefined
      }]);

      expect(output.details).to.deep.equal([{
        name: 'Url',
        link: 'testUrl1',
        text: 'testUrl1'
      }, {
        name: 'Description',
        highlightedText: '',
        text: ''
      }, {
        name: 'Cached Page',
        link: '/cached.html?domain=TestDomain&id=ABC123',
        text: 'Open in New Tab (Runs External Code)'
      }]);
    });

    test('result given many extractions does return expected object', function() {
      /* jscs:disable requireCamelCaseOrUpperCaseIdentifiers */
      var output = transformFunctions.transforms.entity.result({
        hits: {
          hits: [RESULT_1]
        }
      }, SEARCH_FIELDS);
      /* jscs:enable requireCamelCaseOrUpperCaseIdentifiers */

      expect(output.id).to.equal('ABC123');
      expect(output.description).to.equal('This is description 1');
      expect(output.highlightedText).to.equal('Title 1');
      expect(output.icon).to.equal('TestIcon');
      expect(output.link).to.equal('/result.html?domain=TestDomain&id=ABC123');
      expect(output.name).to.equal('TestResult');
      expect(output.tags).to.deep.equal({});
      expect(output.title).to.equal('Title 1');
      expect(output.type).to.equal('webpage');
      expect(output.url).to.equal('testUrl1');

      expect(output.timestamp).to.not.exist;
      expect(output.esData).to.not.exist;
      expect(output.images).to.not.exist;
      expect(output.styleClass).to.not.exist;
      expect(output.headerExtractions.length).to.equal(4);
      expect(output.detailExtractions.length).to.equal(6);
      expect(output.nestedExtractions.length).to.equal(1);
      expect(output.details.length).to.equal(3);

      expect(output.headerExtractions[0].isDate).to.be.false;
      expect(output.headerExtractions[0].isUrl).to.be.true;
      expect(output.headerExtractions[0].key).to.equal('website');
      expect(output.headerExtractions[0].name).to.equal('Websites');
      expect(output.headerExtractions[0].type).to.equal('url');
      expect(output.headerExtractions[0].data.length).to.equal(2);

      expect(output.headerExtractions[0].data[0].confidence).to.not.exist;
      expect(output.headerExtractions[0].data[0].count).to.not.exist;
      expect(output.headerExtractions[0].data[0].highlight).to.not.exist;
      expect(output.headerExtractions[0].data[0].id).to.equal('website1.com');
      expect(output.headerExtractions[0].data[0].icon).to.equal('websiteIcon');
      expect(output.headerExtractions[0].data[0].link).to.not.exist;
      expect(output.headerExtractions[0].data[0].provenances.length).to.equal(0);
      expect(output.headerExtractions[0].data[0].styleClass).to.equal('websiteStyle');
      expect(output.headerExtractions[0].data[0].text).to.equal('website1.com');
      expect(output.headerExtractions[0].data[0].type).to.equal('website');
      expect(output.headerExtractions[0].data[0].width).to.not.exist;

      expect(output.headerExtractions[0].data[1].confidence).to.not.exist;
      expect(output.headerExtractions[0].data[1].count).to.not.exist;
      expect(output.headerExtractions[0].data[1].highlight).to.not.exist;
      expect(output.headerExtractions[0].data[1].id).to.equal('website2.com');
      expect(output.headerExtractions[0].data[1].icon).to.equal('websiteIcon');
      expect(output.headerExtractions[0].data[1].link).to.not.exist;
      expect(output.headerExtractions[0].data[1].provenances.length).to.equal(0);
      expect(output.headerExtractions[0].data[1].styleClass).to.equal('websiteStyle');
      expect(output.headerExtractions[0].data[1].text).to.equal('website2.com');
      expect(output.headerExtractions[0].data[1].type).to.equal('website');
      expect(output.headerExtractions[0].data[1].width).to.not.exist;

      expect(output.headerExtractions[1].isDate).to.be.true;
      expect(output.headerExtractions[1].isUrl).to.be.false;
      expect(output.headerExtractions[1].key).to.equal('date');
      expect(output.headerExtractions[1].name).to.equal('Dates');
      expect(output.headerExtractions[1].type).to.equal('date');
      expect(output.headerExtractions[1].data.length).to.equal(1);

      expect(output.headerExtractions[1].data[0].confidence).to.not.exist;
      expect(output.headerExtractions[1].data[0].count).to.not.exist;
      expect(output.headerExtractions[1].data[0].highlight).to.not.exist;
      expect(output.headerExtractions[1].data[0].id).to.equal('date1');
      expect(output.headerExtractions[1].data[0].icon).to.equal('dateIcon');
      expect(output.headerExtractions[1].data[0].link).to.not.exist;
      expect(output.headerExtractions[1].data[0].provenances.length).to.equal(0);
      expect(output.headerExtractions[1].data[0].styleClass).to.equal('dateStyle');
      expect(output.headerExtractions[1].data[0].text).to.equal('From Jan 1, 2018 to Feb 2, 2018');
      expect(output.headerExtractions[1].data[0].type).to.equal('date');
      expect(output.headerExtractions[1].data[0].width).to.not.exist;

      expect(output.headerExtractions[2].isDate).to.be.false;
      expect(output.headerExtractions[2].isUrl).to.be.false;
      expect(output.headerExtractions[2].key).to.equal('city');
      expect(output.headerExtractions[2].name).to.equal('Cities');
      expect(output.headerExtractions[2].type).to.equal('location');
      expect(output.headerExtractions[2].data.length).to.equal(2);

      expect(output.headerExtractions[2].data[0].confidence).to.not.exist;
      expect(output.headerExtractions[2].data[0].count).to.not.exist;
      expect(output.headerExtractions[2].data[0].highlight).to.not.exist;
      expect(output.headerExtractions[2].data[0].id).to.equal('city1:state1:country1:1:11');
      expect(output.headerExtractions[2].data[0].icon).to.equal('cityIcon');
      expect(output.headerExtractions[2].data[0].link).to.equal('/entity.html?domain=TestDomain&id=city1%3Astate1%3Acountry1%3A1%3A11&type=city');
      expect(output.headerExtractions[2].data[0].provenances.length).to.equal(0);
      expect(output.headerExtractions[2].data[0].styleClass).to.equal('cityStyle');
      expect(output.headerExtractions[2].data[0].text).to.equal('city1, state1');
      expect(output.headerExtractions[2].data[0].type).to.equal('city');
      expect(output.headerExtractions[2].data[0].width).to.not.exist;

      expect(output.headerExtractions[2].data[1].confidence).to.not.exist;
      expect(output.headerExtractions[2].data[1].count).to.not.exist;
      expect(output.headerExtractions[2].data[1].highlight).to.not.exist;
      expect(output.headerExtractions[2].data[1].id).to.equal('city2:state2:country2:2:22');
      expect(output.headerExtractions[2].data[1].icon).to.equal('cityIcon');
      expect(output.headerExtractions[2].data[1].link).to.equal('/entity.html?domain=TestDomain&id=city2%3Astate2%3Acountry2%3A2%3A22&type=city');
      expect(output.headerExtractions[2].data[1].provenances.length).to.equal(0);
      expect(output.headerExtractions[2].data[1].styleClass).to.equal('cityStyle');
      expect(output.headerExtractions[2].data[1].text).to.equal('city2, state2');
      expect(output.headerExtractions[2].data[1].type).to.equal('city');
      expect(output.headerExtractions[2].data[1].width).to.not.exist;

      expect(output.headerExtractions[3].isDate).to.be.false;
      expect(output.headerExtractions[3].isUrl).to.be.false;
      expect(output.headerExtractions[3].key).to.equal('label');
      expect(output.headerExtractions[3].name).to.equal('Labels');
      expect(output.headerExtractions[3].type).to.equal('string');
      expect(output.headerExtractions[3].data.length).to.equal(2);

      expect(output.headerExtractions[3].data[0].confidence).to.not.exist;
      expect(output.headerExtractions[3].data[0].count).to.not.exist;
      expect(output.headerExtractions[3].data[0].highlight).to.not.exist;
      expect(output.headerExtractions[3].data[0].id).to.equal('label1');
      expect(output.headerExtractions[3].data[0].icon).to.equal('labelIcon');
      expect(output.headerExtractions[3].data[0].link).to.not.exist;
      expect(output.headerExtractions[3].data[0].provenances.length).to.equal(0);
      expect(output.headerExtractions[3].data[0].styleClass).to.equal('labelStyle');
      expect(output.headerExtractions[3].data[0].text).to.equal('Label1');
      expect(output.headerExtractions[3].data[0].type).to.equal('label');
      expect(output.headerExtractions[3].data[0].width).to.not.exist;

      expect(output.headerExtractions[3].data[1].confidence).to.not.exist;
      expect(output.headerExtractions[3].data[1].count).to.not.exist;
      expect(output.headerExtractions[3].data[1].highlight).to.not.exist;
      expect(output.headerExtractions[3].data[1].id).to.equal('label2');
      expect(output.headerExtractions[3].data[1].icon).to.equal('labelIcon');
      expect(output.headerExtractions[3].data[1].link).to.not.exist;
      expect(output.headerExtractions[3].data[1].provenances.length).to.equal(0);
      expect(output.headerExtractions[3].data[1].styleClass).to.equal('labelStyle');
      expect(output.headerExtractions[3].data[1].text).to.equal('Label2');
      expect(output.headerExtractions[3].data[1].type).to.equal('label');
      expect(output.headerExtractions[3].data[1].width).to.not.exist;

      expect(output.detailExtractions[0].isDate).to.be.false;
      expect(output.detailExtractions[0].isUrl).to.be.false;
      expect(output.detailExtractions[0].key).to.equal('email');
      expect(output.detailExtractions[0].name).to.equal('Emails');
      expect(output.detailExtractions[0].type).to.equal('email');
      expect(output.detailExtractions[0].data.length).to.equal(2);

      expect(output.detailExtractions[0].data[0].confidence).to.not.exist;
      expect(output.detailExtractions[0].data[0].count).to.not.exist;
      expect(output.detailExtractions[0].data[0].highlight).to.not.exist;
      expect(output.detailExtractions[0].data[0].id).to.equal('email1@address1.com');
      expect(output.detailExtractions[0].data[0].icon).to.equal('emailIcon');
      expect(output.detailExtractions[0].data[0].link).to.equal('/entity.html?domain=TestDomain&id=email1%40address1.com&type=email');
      expect(output.detailExtractions[0].data[0].provenances.length).to.equal(0);
      expect(output.detailExtractions[0].data[0].styleClass).to.equal('emailStyle');
      expect(output.detailExtractions[0].data[0].text).to.equal('email1@address1.com');
      expect(output.detailExtractions[0].data[0].type).to.equal('email');
      expect(output.detailExtractions[0].data[0].width).to.not.exist;

      expect(output.detailExtractions[0].data[1].confidence).to.not.exist;
      expect(output.detailExtractions[0].data[1].count).to.not.exist;
      expect(output.detailExtractions[0].data[1].highlight).to.not.exist;
      expect(output.detailExtractions[0].data[1].id).to.equal('email2@address2.com');
      expect(output.detailExtractions[0].data[1].icon).to.equal('emailIcon');
      expect(output.detailExtractions[0].data[1].link).to.equal('/entity.html?domain=TestDomain&id=email2%40address2.com&type=email');
      expect(output.detailExtractions[0].data[1].provenances.length).to.equal(0);
      expect(output.detailExtractions[0].data[1].styleClass).to.equal('emailStyle');
      expect(output.detailExtractions[0].data[1].text).to.equal('email2@address2.com');
      expect(output.detailExtractions[0].data[1].type).to.equal('email');
      expect(output.detailExtractions[0].data[1].width).to.not.exist;

      expect(output.detailExtractions[1].isDate).to.be.false;
      expect(output.detailExtractions[1].isUrl).to.be.false;
      expect(output.detailExtractions[1].key).to.equal('number');
      expect(output.detailExtractions[1].name).to.equal('Numbers');
      expect(output.detailExtractions[1].type).to.equal('number');
      expect(output.detailExtractions[1].data.length).to.equal(2);

      expect(output.detailExtractions[1].data[0].confidence).to.not.exist;
      expect(output.detailExtractions[1].data[0].count).to.not.exist;
      expect(output.detailExtractions[1].data[0].highlight).to.not.exist;
      expect(output.detailExtractions[1].data[0].id).to.equal(321);
      expect(output.detailExtractions[1].data[0].icon).to.equal('numberIcon');
      expect(output.detailExtractions[1].data[0].link).to.not.exist;
      expect(output.detailExtractions[1].data[0].provenances.length).to.equal(0);
      expect(output.detailExtractions[1].data[0].styleClass).to.equal('numberStyle');
      expect(output.detailExtractions[1].data[0].text).to.equal(321);
      expect(output.detailExtractions[1].data[0].type).to.equal('number');
      expect(output.detailExtractions[1].data[0].width).to.not.exist;

      expect(output.detailExtractions[1].data[1].confidence).to.not.exist;
      expect(output.detailExtractions[1].data[1].count).to.not.exist;
      expect(output.detailExtractions[1].data[1].highlight).to.not.exist;
      expect(output.detailExtractions[1].data[1].id).to.equal(654);
      expect(output.detailExtractions[1].data[1].icon).to.equal('numberIcon');
      expect(output.detailExtractions[1].data[1].link).to.not.exist;
      expect(output.detailExtractions[1].data[1].provenances.length).to.equal(0);
      expect(output.detailExtractions[1].data[1].styleClass).to.equal('numberStyle');
      expect(output.detailExtractions[1].data[1].text).to.equal(654);
      expect(output.detailExtractions[1].data[1].type).to.equal('number');
      expect(output.detailExtractions[1].data[1].width).to.not.exist;

      expect(output.detailExtractions[2].isDate).to.be.false;
      expect(output.detailExtractions[2].isUrl).to.be.false;
      expect(output.detailExtractions[2].key).to.equal('phone');
      expect(output.detailExtractions[2].name).to.equal('Phones');
      expect(output.detailExtractions[2].type).to.equal('phone');
      expect(output.detailExtractions[2].data.length).to.equal(2);

      expect(output.detailExtractions[2].data[0].confidence).to.not.exist;
      expect(output.detailExtractions[2].data[0].count).to.not.exist;
      expect(output.detailExtractions[2].data[0].highlight).to.not.exist;
      expect(output.detailExtractions[2].data[0].id).to.equal('1112223333');
      expect(output.detailExtractions[2].data[0].icon).to.equal('phoneIcon');
      expect(output.detailExtractions[2].data[0].link).to.equal('/entity.html?domain=TestDomain&id=1112223333&type=phone');
      expect(output.detailExtractions[2].data[0].provenances.length).to.equal(0);
      expect(output.detailExtractions[2].data[0].styleClass).to.equal('phoneStyle');
      expect(output.detailExtractions[2].data[0].text).to.equal('111-222-3333');
      expect(output.detailExtractions[2].data[0].type).to.equal('phone');
      expect(output.detailExtractions[2].data[0].width).to.not.exist;

      expect(output.detailExtractions[2].data[1].confidence).to.not.exist;
      expect(output.detailExtractions[2].data[1].count).to.not.exist;
      expect(output.detailExtractions[2].data[1].highlight).to.not.exist;
      expect(output.detailExtractions[2].data[1].id).to.equal('4445556666');
      expect(output.detailExtractions[2].data[1].icon).to.equal('phoneIcon');
      expect(output.detailExtractions[2].data[1].link).to.equal('/entity.html?domain=TestDomain&id=4445556666&type=phone');
      expect(output.detailExtractions[2].data[1].provenances.length).to.equal(0);
      expect(output.detailExtractions[2].data[1].styleClass).to.equal('phoneStyle');
      expect(output.detailExtractions[2].data[1].text).to.equal('444-555-6666');
      expect(output.detailExtractions[2].data[1].type).to.equal('phone');
      expect(output.detailExtractions[2].data[1].width).to.not.exist;

      expect(output.detailExtractions[3].isDate).to.be.false;
      expect(output.detailExtractions[3].isUrl).to.be.false;
      expect(output.detailExtractions[3].key).to.equal('price');
      expect(output.detailExtractions[3].name).to.equal('Prices');
      expect(output.detailExtractions[3].type).to.equal('hyphenated');
      expect(output.detailExtractions[3].data.length).to.equal(2);

      expect(output.detailExtractions[3].data[0].confidence).to.not.exist;
      expect(output.detailExtractions[3].data[0].count).to.not.exist;
      expect(output.detailExtractions[3].data[0].highlight).to.not.exist;
      expect(output.detailExtractions[3].data[0].id).to.equal('price1-currency:currency1-time_unit:time1');
      expect(output.detailExtractions[3].data[0].icon).to.equal('priceIcon');
      expect(output.detailExtractions[3].data[0].link).to.not.exist;
      expect(output.detailExtractions[3].data[0].provenances.length).to.equal(0);
      expect(output.detailExtractions[3].data[0].styleClass).to.equal('priceStyle');
      expect(output.detailExtractions[3].data[0].text).to.equal('price1 currency1 per time1 minutes');
      expect(output.detailExtractions[3].data[0].type).to.equal('price');
      expect(output.detailExtractions[3].data[0].width).to.not.exist;

      expect(output.detailExtractions[3].data[1].confidence).to.not.exist;
      expect(output.detailExtractions[3].data[1].count).to.not.exist;
      expect(output.detailExtractions[3].data[1].highlight).to.not.exist;
      expect(output.detailExtractions[3].data[1].id).to.equal('price2-currency:currency2-time_unit:time2');
      expect(output.detailExtractions[3].data[1].icon).to.equal('priceIcon');
      expect(output.detailExtractions[3].data[1].link).to.not.exist;
      expect(output.detailExtractions[3].data[1].provenances.length).to.equal(0);
      expect(output.detailExtractions[3].data[1].styleClass).to.equal('priceStyle');
      expect(output.detailExtractions[3].data[1].text).to.equal('price2 currency2 per time2 minutes');
      expect(output.detailExtractions[3].data[1].type).to.equal('price');
      expect(output.detailExtractions[3].data[1].width).to.not.exist;

      expect(output.detailExtractions[4].isDate).to.be.false;
      expect(output.detailExtractions[4].isUrl).to.be.false;
      expect(output.detailExtractions[4].key).to.equal('unnested');
      expect(output.detailExtractions[4].name).to.equal('Unnested Items');
      expect(output.detailExtractions[4].type).to.equal('string');
      expect(output.detailExtractions[4].data.length).to.equal(2);

      expect(output.detailExtractions[4].data[0].confidence).to.not.exist;
      expect(output.detailExtractions[4].data[0].count).to.not.exist;
      expect(output.detailExtractions[4].data[0].highlight).to.not.exist;
      expect(output.detailExtractions[4].data[0].id).to.equal('unnested1');
      expect(output.detailExtractions[4].data[0].icon).to.equal('unnestedIcon');
      expect(output.detailExtractions[4].data[0].link).to.not.exist;
      expect(output.detailExtractions[4].data[0].provenances.length).to.equal(0);
      expect(output.detailExtractions[4].data[0].styleClass).to.equal('unnestedStyle');
      expect(output.detailExtractions[4].data[0].text).to.equal('unnested1');
      expect(output.detailExtractions[4].data[0].type).to.equal('unnested');
      expect(output.detailExtractions[4].data[0].width).to.not.exist;

      expect(output.detailExtractions[4].data[1].confidence).to.not.exist;
      expect(output.detailExtractions[4].data[1].count).to.not.exist;
      expect(output.detailExtractions[4].data[1].highlight).to.not.exist;
      expect(output.detailExtractions[4].data[1].id).to.equal('unnested2');
      expect(output.detailExtractions[4].data[1].icon).to.equal('unnestedIcon');
      expect(output.detailExtractions[4].data[1].link).to.not.exist;
      expect(output.detailExtractions[4].data[1].provenances.length).to.equal(0);
      expect(output.detailExtractions[4].data[1].styleClass).to.equal('unnestedStyle');
      expect(output.detailExtractions[4].data[1].text).to.equal('unnested2');
      expect(output.detailExtractions[4].data[1].type).to.equal('unnested');
      expect(output.detailExtractions[4].data[1].width).to.not.exist;

      expect(output.detailExtractions[5].isDate).to.be.false;
      expect(output.detailExtractions[5].isUrl).to.be.false;
      expect(output.detailExtractions[5].key).to.equal('user');
      expect(output.detailExtractions[5].name).to.equal('Users');
      expect(output.detailExtractions[5].type).to.equal('username');
      expect(output.detailExtractions[5].data.length).to.equal(2);

      expect(output.detailExtractions[5].data[0].confidence).to.not.exist;
      expect(output.detailExtractions[5].data[0].count).to.not.exist;
      expect(output.detailExtractions[5].data[0].highlight).to.not.exist;
      expect(output.detailExtractions[5].data[0].id).to.equal('type1 user1');
      expect(output.detailExtractions[5].data[0].icon).to.equal('userIcon');
      expect(output.detailExtractions[5].data[0].link).to.equal('/entity.html?domain=TestDomain&id=type1%20user1&type=user');
      expect(output.detailExtractions[5].data[0].provenances.length).to.equal(0);
      expect(output.detailExtractions[5].data[0].styleClass).to.equal('userStyle');
      expect(output.detailExtractions[5].data[0].text).to.equal('User1');
      expect(output.detailExtractions[5].data[0].type).to.equal('user');
      expect(output.detailExtractions[5].data[0].width).to.not.exist;

      expect(output.detailExtractions[5].data[1].confidence).to.not.exist;
      expect(output.detailExtractions[5].data[1].count).to.not.exist;
      expect(output.detailExtractions[5].data[1].highlight).to.not.exist;
      expect(output.detailExtractions[5].data[1].id).to.equal('type2 user2');
      expect(output.detailExtractions[5].data[1].icon).to.equal('userIcon');
      expect(output.detailExtractions[5].data[1].link).to.equal('/entity.html?domain=TestDomain&id=type2%20user2&type=user');
      expect(output.detailExtractions[5].data[1].provenances.length).to.equal(0);
      expect(output.detailExtractions[5].data[1].styleClass).to.equal('userStyle');
      expect(output.detailExtractions[5].data[1].text).to.equal('User2');
      expect(output.detailExtractions[5].data[1].type).to.equal('user');
      expect(output.detailExtractions[5].data[1].width).to.not.exist;

      expect(output.nestedExtractions[0].isDate).to.be.false;
      expect(output.nestedExtractions[0].isUrl).to.be.false;
      expect(output.nestedExtractions[0].key).to.equal('comment');
      expect(output.nestedExtractions[0].name).to.equal('Comments');
      expect(output.nestedExtractions[0].type).to.equal('kg_id');
      expect(output.nestedExtractions[0].data.length).to.equal(2);

      expect(output.nestedExtractions[0].data[0].confidence).to.not.exist;
      expect(output.nestedExtractions[0].data[0].count).to.not.exist;
      expect(output.nestedExtractions[0].data[0].id).to.equal('comment1');
      expect(output.nestedExtractions[0].data[0].icon).to.equal('commentIcon');
      expect(output.nestedExtractions[0].data[0].link).to.equal('/result.html?domain=TestDomain&id=comment1');
      expect(output.nestedExtractions[0].data[0].provenances.length).to.equal(0);
      expect(output.nestedExtractions[0].data[0].styleClass).to.equal('commentStyle');
      expect(output.nestedExtractions[0].data[0].text).to.equal('comment1');
      expect(output.nestedExtractions[0].data[0].type).to.equal('comment');
      expect(output.nestedExtractions[0].data[0].width).to.not.exist;

      expect(output.nestedExtractions[0].data[1].confidence).to.not.exist;
      expect(output.nestedExtractions[0].data[1].count).to.not.exist;
      expect(output.nestedExtractions[0].data[1].id).to.equal('comment2');
      expect(output.nestedExtractions[0].data[1].icon).to.equal('commentIcon');
      expect(output.nestedExtractions[0].data[1].link).to.equal('/result.html?domain=TestDomain&id=comment2');
      expect(output.nestedExtractions[0].data[1].provenances.length).to.equal(0);
      expect(output.nestedExtractions[0].data[1].styleClass).to.equal('commentStyle');
      expect(output.nestedExtractions[0].data[1].text).to.equal('comment2');
      expect(output.nestedExtractions[0].data[1].type).to.equal('comment');
      expect(output.nestedExtractions[0].data[1].width).to.not.exist;

      expect(output.details[0].name).to.equal('Url');
      expect(output.details[0].link).to.equal('testUrl1');
      expect(output.details[0].text).to.equal('testUrl1');

      expect(output.details[1].name).to.equal('Description');
      expect(output.details[1].highlightedText).to.equal('This is description 1');
      expect(output.details[1].text).to.equal('This is description 1');

      expect(output.details[2].name).to.equal('Cached Page');
      expect(output.details[2].link).to.equal('/cached.html?domain=TestDomain&id=ABC123');
      expect(output.details[2].text).to.equal('Open in New Tab (Runs External Code)');
    });

    test('result does return expected object if hideCachedPage is true', function() {
      transformFunctions.serverConfig = {
        hideCachedPage: true,
        resultIcon: 'TestIcon',
        resultNamePlural: 'TestResults',
        resultNameSingular: 'TestResult',
        resultQueryField: 'TestQueryField',
        timestampField: 'timestamp_crawl',
        uidField: 'doc_id'
      };

      /* jscs:disable requireCamelCaseOrUpperCaseIdentifiers */
      var output = transformFunctions.transforms.entity.result({
        hits: {
          hits: [RESULT_1]
        }
      }, SEARCH_FIELDS);
      /* jscs:enable requireCamelCaseOrUpperCaseIdentifiers */

      expect(output.details).to.deep.equal([{
        name: 'Url',
        link: 'testUrl1',
        text: 'testUrl1'
      }, {
        name: 'Description',
        highlightedText: 'This is description 1',
        text: 'This is description 1'
      }]);
    });

    test('result does return expected object if link in title field config is undefined', function() {
      // Set the link in the title field config to undefined.
      SEARCH_FIELDS[9].link = undefined;

      /* jscs:disable requireCamelCaseOrUpperCaseIdentifiers */
      var output = transformFunctions.transforms.entity.result({
        hits: {
          hits: [RESULT_1]
        }
      }, SEARCH_FIELDS);
      /* jscs:enable requireCamelCaseOrUpperCaseIdentifiers */

      expect(output.highlightedText).to.equal('Title 1');
      expect(output.link).to.not.exist;
      expect(output.title).to.equal('Title 1');

      // Reset the link in the title field config.
      SEARCH_FIELDS[9].link = 'result';
    });

    test('result given many extractions does return expected object if showMultipleTitles is true', function() {
      transformFunctions.serverConfig = {
        resultIcon: 'TestIcon',
        resultNamePlural: 'TestResults',
        resultNameSingular: 'TestResult',
        resultQueryField: 'TestQueryField',
        showMultipleTitles: true,
        timestampField: 'timestamp_crawl',
        uidField: 'doc_id'
      };

      /* jscs:disable requireCamelCaseOrUpperCaseIdentifiers */
      var output = transformFunctions.transforms.entity.result({
        hits: {
          hits: [RESULT_1]
        }
      }, SEARCH_FIELDS);
      /* jscs:enable requireCamelCaseOrUpperCaseIdentifiers */

      expect(output.title).to.equal('Title 1 Title 2');
      expect(output.highlightedText).to.equal('Title 1 Title 2');
    });

    test('result given many extractions does return expected object if showMultipleDescriptions is true', function() {
      transformFunctions.serverConfig = {
        resultIcon: 'TestIcon',
        resultNamePlural: 'TestResults',
        resultNameSingular: 'TestResult',
        resultQueryField: 'TestQueryField',
        showMultipleDescriptions: true,
        timestampField: 'timestamp_crawl',
        uidField: 'doc_id'
      };

      /* jscs:disable requireCamelCaseOrUpperCaseIdentifiers */
      var output = transformFunctions.transforms.entity.result({
        hits: {
          hits: [RESULT_1]
        }
      }, SEARCH_FIELDS);
      /* jscs:enable requireCamelCaseOrUpperCaseIdentifiers */

      expect(output.description).to.equal('This is description 1 This is description 2');
      expect(output.details.length).to.equal(4);

      expect(output.details[0].name).to.equal('Url');
      expect(output.details[0].link).to.equal('testUrl1');
      expect(output.details[0].text).to.equal('testUrl1');

      expect(output.details[1].name).to.equal('Description');
      expect(output.details[1].highlightedText).to.equal('This is description 1');
      expect(output.details[1].text).to.equal('This is description 1');

      expect(output.details[2].name).to.equal('Description');
      expect(output.details[2].highlightedText).to.equal('This is description 2');
      expect(output.details[2].text).to.equal('This is description 2');

      expect(output.details[3].name).to.equal('Cached Page');
      expect(output.details[3].link).to.equal('/cached.html?domain=TestDomain&id=ABC123');
      expect(output.details[3].text).to.equal('Open in New Tab (Runs External Code)');
    });

    test('result given confidences does return expected object', function() {
      /* jscs:disable requireCamelCaseOrUpperCaseIdentifiers */
      var output = transformFunctions.transforms.entity.result({
        hits: {
          hits: [{
            _source: {
              doc_id: 'ABC123',
              extractions: {
                websiteField: [{
                  confidence: 0.9,
                  key: 'website1.com',
                  value: 'website1.com'
                }, {
                  confidence: 0.85,
                  key: 'website2.com',
                  value: 'website2.com'
                }],
                dateField: [{
                  confidence: 0.8,
                  key: 'date1',
                  value: '2018-01-01T00:00:00'
                }, {
                  confidence: 0.7,
                  key: 'date2',
                  value: '2018-02-02T00:00:00'
                }]
              },
              url: 'testUrl1'
            }
          }]
        }
      }, SEARCH_FIELDS);
      /* jscs:enable requireCamelCaseOrUpperCaseIdentifiers */

      expect(output.headerExtractions[0].data[0].confidence).to.equal(90);
      expect(output.headerExtractions[0].data[1].confidence).to.equal(85);
      expect(output.headerExtractions[1].data[0].confidence).to.equal(75);
    });

    test('result given provenances does return expected object', function() {
      /* jscs:disable requireCamelCaseOrUpperCaseIdentifiers */
      var output = transformFunctions.transforms.entity.result({
        hits: {
          hits: [{
            _source: {
              doc_id: 'ABC123',
              extractions: {
                websiteField: [{
                  key: 'website1.com',
                  value: 'website1.com',
                  provenance: [{
                    method: 'extraction_method_1',
                    source: {
                      context: {
                        text: 'prev1 website1.com next1'
                      }
                    }
                  }]
                }, {
                  key: 'website2.com',
                  value: 'website2.com',
                  provenance: [{
                    method: 'extraction_method_2',
                    source: {
                      context: {
                        text: 'prev2 website2.com next2'
                      }
                    }
                  }, {
                    method: 'extraction_method_3',
                    source: {
                      context: {
                        text: 'prev3 website2.com next3'
                      }
                    }
                  }, {
                    method: 'extraction_method_4',
                    source: {
                      context: {
                        text: 'prev4 website2.com next4'
                      }
                    }
                  }]
                }],
                dateField: [{
                  key: 'date1',
                  value: '2018-01-01T00:00:00',
                  provenance: [{
                    method: 'extraction_method_5',
                    source: {
                      context: {
                        text: 'prev5 date1 next5'
                      }
                    }
                  }]
                }, {
                  key: 'date2',
                  value: '2018-02-02T00:00:00',
                  provenance: [{
                    method: 'extraction_method_6',
                    source: {
                      context: {
                        text: 'prev6 date2 next6'
                      }
                    }
                  }]
                }]
              },
              url: 'testUrl1'
            }
          }]
        }
      }, SEARCH_FIELDS);
      /* jscs:enable requireCamelCaseOrUpperCaseIdentifiers */

      expect(output.headerExtractions[0].data[0].confidence).to.equal(100);
      expect(output.headerExtractions[0].data[0].provenances.length).to.equal(1);
      expect(output.headerExtractions[0].data[0].provenances[0].method).to.equal('extraction_method_1');
      expect(output.headerExtractions[0].data[0].provenances[0].text).to.equal('prev1 website1.com next1');

      expect(output.headerExtractions[0].data[1].confidence).to.equal(100);
      expect(output.headerExtractions[0].data[1].provenances.length).to.equal(3);
      expect(output.headerExtractions[0].data[1].provenances[0].method).to.equal('extraction_method_2');
      expect(output.headerExtractions[0].data[1].provenances[0].text).to.equal('prev2 website2.com next2');
      expect(output.headerExtractions[0].data[1].provenances[1].method).to.equal('extraction_method_3');
      expect(output.headerExtractions[0].data[1].provenances[1].text).to.equal('prev3 website2.com next3');
      expect(output.headerExtractions[0].data[1].provenances[2].method).to.equal('extraction_method_4');
      expect(output.headerExtractions[0].data[1].provenances[2].text).to.equal('prev4 website2.com next4');

      expect(output.headerExtractions[1].data[0].confidence).to.equal(100);
      expect(output.headerExtractions[1].data[0].provenances.length).to.equal(2);
      expect(output.headerExtractions[1].data[0].provenances[0].method).to.equal('extraction_method_5');
      expect(output.headerExtractions[1].data[0].provenances[0].text).to.equal('prev5 date1 next5');
      expect(output.headerExtractions[1].data[0].provenances[1].method).to.equal('extraction_method_6');
      expect(output.headerExtractions[1].data[0].provenances[1].text).to.equal('prev6 date2 next6');
    });

    test('result given tags and annotations does return expected object', function() {
      /* jscs:disable requireCamelCaseOrUpperCaseIdentifiers */
      var output = transformFunctions.transforms.entity.result({
        hits: {
          hits: [{
            _source: {
              doc_id: 'ABC123',
              extractions: {
                labelField: [{
                  human_annotation: 1,
                  key: 'label1',
                  value: 'Label1'
                }, {
                  human_annotation: 0,
                  key: 'label2',
                  value: 'Label2'
                }]
              },
              knowledge_graph: {
                _tags: {
                  tag1: {
                    human_annotation: 1
                  },
                  tag2: {
                    human_annotation: 0
                  }
                }
              },
              url: 'testUrl1'
            }
          }]
        }
      }, SEARCH_FIELDS);
      /* jscs:enable requireCamelCaseOrUpperCaseIdentifiers */

      expect(output.tags).to.deep.equal({
        tag1: {
          type: 'result',
          user: 'positive'
        },
        tag2: {
          type: 'result',
          user: 'negative'
        }
      });

      expect(output.headerExtractions[3].data[0].classifications).to.deep.equal({
        type: 'label',
        user: 'positive'
      });

      expect(output.headerExtractions[3].data[1].classifications).to.deep.equal({
        type: 'label',
        user: 'negative'
      });
    });

    test('result given images does return expected object', function() {
      /* jscs:disable requireCamelCaseOrUpperCaseIdentifiers */
      var output = transformFunctions.transforms.entity.result({
        hits: {
          hits: [{
            _source: {
              doc_id: 'ABC123',
              objects: [{
                img_sha1: 'image1'
              }, {
                img_sha1: 'image2'
              }],
              url: 'testUrl1'
            }
          }]
        }
      }, SEARCH_FIELDS);
      /* jscs:enable requireCamelCaseOrUpperCaseIdentifiers */

      expect(output.images.length).to.equal(2);

      expect(output.images[0].confidence).to.not.exist;
      expect(output.images[0].count).to.not.exist;
      expect(output.images[0].id).to.equal('image1');
      expect(output.images[0].icon).to.equal('image:photo');
      expect(output.images[0].link).to.equal('/entity.html?domain=TestDomain&id=image1&type=image');
      expect(output.images[0].provenances.length).to.equal(0);
      expect(output.images[0].styleClass).to.not.exist;
      expect(output.images[0].text).to.equal('Image #1');
      expect(output.images[0].type).to.equal('image');
      expect(output.images[0].width).to.not.exist;

      expect(output.images[1].confidence).to.not.exist;
      expect(output.images[1].count).to.not.exist;
      expect(output.images[1].id).to.equal('image2');
      expect(output.images[1].icon).to.equal('image:photo');
      expect(output.images[1].link).to.equal('/entity.html?domain=TestDomain&id=image2&type=image');
      expect(output.images[1].provenances.length).to.equal(0);
      expect(output.images[1].styleClass).to.not.exist;
      expect(output.images[1].text).to.equal('Image #2');
      expect(output.images[1].type).to.equal('image');
      expect(output.images[1].width).to.not.exist;
    });

    test('result given timestamps does return expected object', function() {
      /* jscs:disable requireCamelCaseOrUpperCaseIdentifiers */
      var output = transformFunctions.transforms.entity.result({
        hits: {
          hits: [{
            _source: {
              doc_id: 'ABC123',
              timestamp_crawl: '2018-01-01T00:00:00',
              timestamp: '2018-02-02T00:00:00',
              url: 'testUrl1'
            }
          }]
        }
      }, SEARCH_FIELDS);
      /* jscs:enable requireCamelCaseOrUpperCaseIdentifiers */

      expect(output.timestamp).to.equal('Jan 1, 2018');
      expect(output.details.length).to.equal(4);

      expect(output.details[0].name).to.equal('Url');
      expect(output.details[0].link).to.equal('testUrl1');
      expect(output.details[0].text).to.equal('testUrl1');

      expect(output.details[1].name).to.equal('Timestamp');
      expect(output.details[1].text).to.equal('Jan 1, 2018');

      expect(output.details[2].name).to.equal('Description');
      expect(output.details[2].highlightedText).to.equal('');
      expect(output.details[2].text).to.equal('');

      expect(output.details[3].name).to.equal('Cached Page');
      expect(output.details[3].link).to.equal('/cached.html?domain=TestDomain&id=ABC123');
      expect(output.details[3].text).to.equal('Open in New Tab (Runs External Code)');

      /* jscs:disable requireCamelCaseOrUpperCaseIdentifiers */
      output = transformFunctions.transforms.entity.result({
        hits: {
          hits: [{
            _source: {
              doc_id: 'ABC123',
              timestamp: '2018-02-02T00:00:00',
              url: 'testUrl1'
            }
          }]
        }
      }, SEARCH_FIELDS);
      /* jscs:enable requireCamelCaseOrUpperCaseIdentifiers */

      expect(output.timestamp).to.equal('Feb 2, 2018');
      expect(output.details.length).to.equal(4);

      expect(output.details[0].name).to.equal('Url');
      expect(output.details[0].link).to.equal('testUrl1');
      expect(output.details[0].text).to.equal('testUrl1');

      expect(output.details[1].name).to.equal('Timestamp');
      expect(output.details[1].text).to.equal('Feb 2, 2018');

      expect(output.details[2].name).to.equal('Description');
      expect(output.details[2].highlightedText).to.equal('');
      expect(output.details[2].text).to.equal('');

      expect(output.details[3].name).to.equal('Cached Page');
      expect(output.details[3].link).to.equal('/cached.html?domain=TestDomain&id=ABC123');
      expect(output.details[3].text).to.equal('Open in New Tab (Runs External Code)');
    });

    test('result given elasticsearch data enpoint does return expected object', function() {
      /* jscs:disable requireCamelCaseOrUpperCaseIdentifiers */
      transformFunctions.clientConfig = {
        index: {
          sample: 'TestIndexName'
        },
        root_name: 'TestIndexType'
      };
      /* jscs:enable requireCamelCaseOrUpperCaseIdentifiers */
      transformFunctions.serverConfig = {
        databaseType: 'sample',
        esHost: {
          host: 'TestHost'
        },
        resultIcon: 'TestIcon',
        resultNamePlural: 'TestResults',
        resultNameSingular: 'TestResult',
        resultQueryField: 'TestQueryField',
        timestampField: 'timestamp_crawl',
        uidField: 'doc_id'
      };
      expect(transformFunctions.esConfig.esDataEndpoint).to.not.exist;
      transformFunctions.serverConfig = {
        databaseType: 'sample',
        esHost: {
          host: 'TestHost'
        },
        resultIcon: 'TestIcon',
        resultNamePlural: 'TestResults',
        resultNameSingular: 'TestResult',
        resultQueryField: 'TestQueryField',
        showEsData: true,
        timestampField: 'timestamp_crawl',
        uidField: 'doc_id'
      };
      expect(transformFunctions.esConfig.esDataEndpoint).to.equal('TestHost/TestIndexName/TestIndexType/');

      /* jscs:disable requireCamelCaseOrUpperCaseIdentifiers */
      var output = transformFunctions.transforms.entity.result({
        hits: {
          hits: [{
            _source: {
              doc_id: 'ABC123',
              url: 'testUrl1'
            }
          }]
        }
      }, SEARCH_FIELDS);
      /* jscs:enable requireCamelCaseOrUpperCaseIdentifiers */

      expect(output.details.length).to.equal(4);

      expect(output.details[0].name).to.equal('Raw ES Data');
      expect(output.details[0].link).to.equal('TestHost/TestIndexName/TestIndexType/ABC123');
      expect(output.details[0].text).to.equal('Open');

      expect(output.details[1].name).to.equal('Url');
      expect(output.details[1].link).to.equal('testUrl1');
      expect(output.details[1].text).to.equal('testUrl1');

      expect(output.details[2].name).to.equal('Description');
      expect(output.details[2].highlightedText).to.equal('');
      expect(output.details[2].text).to.equal('');

      expect(output.details[3].name).to.equal('Cached Page');
      expect(output.details[3].link).to.equal('/cached.html?domain=TestDomain&id=ABC123');
      expect(output.details[3].text).to.equal('Open in New Tab (Runs External Code)');
    });

    test('result given time series data does return expected object', function() {
      // TODO
    });

    test('results given incomplete data does return empty array', function() {
      expect(transformFunctions.transforms.entity.results({}, SEARCH_FIELDS)).to.deep.equal([]);
      expect(transformFunctions.transforms.entity.results({
        hits: {}
      }, SEARCH_FIELDS)).to.deep.equal([]);
      expect(transformFunctions.transforms.entity.results({
        hits: {
          hits: []
        }
      }, SEARCH_FIELDS)).to.deep.equal([]);
      expect(transformFunctions.transforms.entity.results({
        hits: {
          hits: [{}]
        }
      }, SEARCH_FIELDS)).to.deep.equal([]);
      expect(transformFunctions.transforms.entity.results({
        hits: {
          hits: [{}]
        }
      }, SEARCH_FIELDS)).to.deep.equal([]);
      expect(transformFunctions.transforms.entity.results({
        hits: {
          hits: [{
            _source: {}
          }]
        }
      }, SEARCH_FIELDS)).to.deep.equal([]);
    });

    test('results given no extractions does return expected array', function() {
      /* jscs:disable requireCamelCaseOrUpperCaseIdentifiers */
      var output = transformFunctions.transforms.entity.results({
        hits: {
          hits: [{
            _source: {
              doc_id: 'ABC123',
              url: 'testUrl1'
            }
          }, {
            _source: {
              doc_id: 'DEF456',
              url: 'testUrl2'
            }
          }]
        }
      }, SEARCH_FIELDS);
      /* jscs:enable requireCamelCaseOrUpperCaseIdentifiers */

      expect(output.length).to.equal(2);

      expect(output[0].id).to.equal('ABC123');
      expect(output[0].description).to.equal('');
      expect(output[0].highlightedText).to.equal('');
      expect(output[0].icon).to.equal('TestIcon');
      expect(output[0].link).to.equal('/result.html?domain=TestDomain&id=ABC123');
      expect(output[0].name).to.equal('TestResult');
      expect(output[0].tags).to.deep.equal({});
      expect(output[0].title).to.equal('');
      expect(output[0].type).to.equal('webpage');
      expect(output[0].url).to.equal('testUrl1');

      expect(output[0].timestamp).to.not.exist;
      expect(output[0].esData).to.not.exist;
      expect(output[0].images).to.not.exist;
      expect(output[0].styleClass).to.not.exist;

      expect(output[0].headerExtractions).to.deep.equal([{
        data: [],
        icon: 'websiteIcon',
        isDate: false,
        isUrl: true,
        key: 'website',
        name: 'Websites',
        styleClass: 'websiteStyle',
        type: 'url',
        width: undefined,
        index: 3
      }, {
        data: [],
        icon: 'dateIcon',
        isDate: true,
        isUrl: false,
        key: 'date',
        name: 'Dates',
        styleClass: 'dateStyle',
        type: 'date',
        width: undefined,
        index: 1
      }, {
        data: [],
        icon: 'cityIcon',
        isDate: false,
        isUrl: false,
        key: 'city',
        name: 'Cities',
        styleClass: 'cityStyle',
        type: 'location',
        width: undefined,
        index: 0
      }, {
        data: [],
        icon: 'labelIcon',
        isDate: false,
        isUrl: false,
        key: 'label',
        name: 'Labels',
        styleClass: 'labelStyle',
        type: 'string',
        width: undefined,
        index: 2
      }]);

      expect(output[0].detailExtractions).to.deep.equal([{
        data: [],
        icon: 'emailIcon',
        isDate: false,
        isUrl: false,
        key: 'email',
        name: 'Emails',
        styleClass: 'emailStyle',
        type: 'email',
        width: undefined
      }, {
        data: [],
        icon: 'numberIcon',
        isDate: false,
        isUrl: false,
        key: 'number',
        name: 'Numbers',
        styleClass: 'numberStyle',
        type: 'number',
        width: undefined
      }, {
        data: [],
        icon: 'phoneIcon',
        isDate: false,
        isUrl: false,
        key: 'phone',
        name: 'Phones',
        styleClass: 'phoneStyle',
        type: 'phone',
        width: undefined
      }, {
        data: [],
        icon: 'priceIcon',
        isDate: false,
        isUrl: false,
        key: 'price',
        name: 'Prices',
        styleClass: 'priceStyle',
        type: 'hyphenated',
        width: undefined
      }, {
        data: [],
        icon: 'unnestedIcon',
        isDate: false,
        isUrl: false,
        key: 'unnested',
        name: 'Unnested Items',
        styleClass: 'unnestedStyle',
        type: 'string',
        width: undefined
      }, {
        data: [],
        icon: 'userIcon',
        isDate: false,
        isUrl: false,
        key: 'user',
        name: 'Users',
        styleClass: 'userStyle',
        type: 'username',
        width: undefined
      }]);

      expect(output[0].nestedExtractions).to.deep.equal([{
        data: [],
        icon: 'commentIcon',
        isDate: false,
        isUrl: false,
        key: 'comment',
        name: 'Comments',
        styleClass: 'commentStyle',
        type: 'kg_id',
        width: undefined
      }]);

      expect(output[0].details).to.deep.equal([{
        name: 'Url',
        link: 'testUrl1',
        text: 'testUrl1'
      }, {
        name: 'Description',
        highlightedText: '',
        text: ''
      }, {
        name: 'Cached Page',
        link: '/cached.html?domain=TestDomain&id=ABC123',
        text: 'Open in New Tab (Runs External Code)'
      }]);

      expect(output[1].id).to.equal('DEF456');
      expect(output[1].description).to.equal('');
      expect(output[1].highlightedText).to.equal('');
      expect(output[1].icon).to.equal('TestIcon');
      expect(output[1].link).to.equal('/result.html?domain=TestDomain&id=DEF456');
      expect(output[1].name).to.equal('TestResult');
      expect(output[1].tags).to.deep.equal({});
      expect(output[1].title).to.equal('');
      expect(output[1].type).to.equal('webpage');
      expect(output[1].url).to.equal('testUrl2');

      expect(output[1].timestamp).to.not.exist;
      expect(output[1].esData).to.not.exist;
      expect(output[1].images).to.not.exist;
      expect(output[1].styleClass).to.not.exist;

      expect(output[1].headerExtractions).to.deep.equal([{
        data: [],
        icon: 'websiteIcon',
        isDate: false,
        isUrl: true,
        key: 'website',
        name: 'Websites',
        styleClass: 'websiteStyle',
        type: 'url',
        width: undefined,
        index: 3
      }, {
        data: [],
        icon: 'dateIcon',
        isDate: true,
        isUrl: false,
        key: 'date',
        name: 'Dates',
        styleClass: 'dateStyle',
        type: 'date',
        width: undefined,
        index: 1
      }, {
        data: [],
        icon: 'cityIcon',
        isDate: false,
        isUrl: false,
        key: 'city',
        name: 'Cities',
        styleClass: 'cityStyle',
        type: 'location',
        width: undefined,
        index: 0
      }, {
        data: [],
        icon: 'labelIcon',
        isDate: false,
        isUrl: false,
        key: 'label',
        name: 'Labels',
        styleClass: 'labelStyle',
        type: 'string',
        width: undefined,
        index: 2
      }]);

      expect(output[1].detailExtractions).to.deep.equal([{
        data: [],
        icon: 'emailIcon',
        isDate: false,
        isUrl: false,
        key: 'email',
        name: 'Emails',
        styleClass: 'emailStyle',
        type: 'email',
        width: undefined
      }, {
        data: [],
        icon: 'numberIcon',
        isDate: false,
        isUrl: false,
        key: 'number',
        name: 'Numbers',
        styleClass: 'numberStyle',
        type: 'number',
        width: undefined
      }, {
        data: [],
        icon: 'phoneIcon',
        isDate: false,
        isUrl: false,
        key: 'phone',
        name: 'Phones',
        styleClass: 'phoneStyle',
        type: 'phone',
        width: undefined
      }, {
        data: [],
        icon: 'priceIcon',
        isDate: false,
        isUrl: false,
        key: 'price',
        name: 'Prices',
        styleClass: 'priceStyle',
        type: 'hyphenated',
        width: undefined
      }, {
        data: [],
        icon: 'unnestedIcon',
        isDate: false,
        isUrl: false,
        key: 'unnested',
        name: 'Unnested Items',
        styleClass: 'unnestedStyle',
        type: 'string',
        width: undefined
      }, {
        data: [],
        icon: 'userIcon',
        isDate: false,
        isUrl: false,
        key: 'user',
        name: 'Users',
        styleClass: 'userStyle',
        type: 'username',
        width: undefined
      }]);

      expect(output[1].nestedExtractions).to.deep.equal([{
        data: [],
        icon: 'commentIcon',
        isDate: false,
        isUrl: false,
        key: 'comment',
        name: 'Comments',
        styleClass: 'commentStyle',
        type: 'kg_id',
        width: undefined
      }]);

      expect(output[1].details).to.deep.equal([{
        name: 'Url',
        link: 'testUrl2',
        text: 'testUrl2'
      }, {
        name: 'Description',
        highlightedText: '',
        text: ''
      }, {
        name: 'Cached Page',
        link: '/cached.html?domain=TestDomain&id=DEF456',
        text: 'Open in New Tab (Runs External Code)'
      }]);
    });

    test('results given multiple results with many extractions does return expected array', function() {
      /* jscs:disable requireCamelCaseOrUpperCaseIdentifiers */
      var output = transformFunctions.transforms.entity.results({
        hits: {
          hits: [RESULT_1, RESULT_2]
        }
      }, SEARCH_FIELDS);
      /* jscs:enable requireCamelCaseOrUpperCaseIdentifiers */

      expect(output.length).to.equal(2);

      expect(output[0].id).to.equal('ABC123');
      expect(output[0].description).to.equal('This is description 1');
      expect(output[0].highlightedText).to.equal('Title 1');
      expect(output[0].icon).to.equal('TestIcon');
      expect(output[0].link).to.equal('/result.html?domain=TestDomain&id=ABC123');
      expect(output[0].name).to.equal('TestResult');
      expect(output[0].tags).to.deep.equal({});
      expect(output[0].title).to.equal('Title 1');
      expect(output[0].type).to.equal('webpage');
      expect(output[0].url).to.equal('testUrl1');

      expect(output[0].timestamp).to.not.exist;
      expect(output[0].esData).to.not.exist;
      expect(output[0].images).to.not.exist;
      expect(output[0].styleClass).to.not.exist;
      expect(output[0].headerExtractions.length).to.equal(4);
      expect(output[0].detailExtractions.length).to.equal(6);
      expect(output[0].nestedExtractions.length).to.equal(1);
      expect(output[0].details.length).to.equal(3);

      expect(output[0].headerExtractions[0].isDate).to.be.false;
      expect(output[0].headerExtractions[0].isUrl).to.be.true;
      expect(output[0].headerExtractions[0].key).to.equal('website');
      expect(output[0].headerExtractions[0].name).to.equal('Websites');
      expect(output[0].headerExtractions[0].type).to.equal('url');
      expect(output[0].headerExtractions[0].data.length).to.equal(2);

      expect(output[0].headerExtractions[0].data[0].confidence).to.not.exist;
      expect(output[0].headerExtractions[0].data[0].count).to.not.exist;
      expect(output[0].headerExtractions[0].data[0].highlight).to.not.exist;
      expect(output[0].headerExtractions[0].data[0].id).to.equal('website1.com');
      expect(output[0].headerExtractions[0].data[0].icon).to.equal('websiteIcon');
      expect(output[0].headerExtractions[0].data[0].link).to.not.exist;
      expect(output[0].headerExtractions[0].data[0].provenances.length).to.equal(0);
      expect(output[0].headerExtractions[0].data[0].styleClass).to.equal('websiteStyle');
      expect(output[0].headerExtractions[0].data[0].text).to.equal('website1.com');
      expect(output[0].headerExtractions[0].data[0].type).to.equal('website');
      expect(output[0].headerExtractions[0].data[0].width).to.not.exist;

      expect(output[0].headerExtractions[0].data[1].confidence).to.not.exist;
      expect(output[0].headerExtractions[0].data[1].count).to.not.exist;
      expect(output[0].headerExtractions[0].data[1].highlight).to.not.exist;
      expect(output[0].headerExtractions[0].data[1].id).to.equal('website2.com');
      expect(output[0].headerExtractions[0].data[1].icon).to.equal('websiteIcon');
      expect(output[0].headerExtractions[0].data[1].link).to.not.exist;
      expect(output[0].headerExtractions[0].data[1].provenances.length).to.equal(0);
      expect(output[0].headerExtractions[0].data[1].styleClass).to.equal('websiteStyle');
      expect(output[0].headerExtractions[0].data[1].text).to.equal('website2.com');
      expect(output[0].headerExtractions[0].data[1].type).to.equal('website');
      expect(output[0].headerExtractions[0].data[1].width).to.not.exist;

      expect(output[0].headerExtractions[1].isDate).to.be.true;
      expect(output[0].headerExtractions[1].isUrl).to.be.false;
      expect(output[0].headerExtractions[1].key).to.equal('date');
      expect(output[0].headerExtractions[1].name).to.equal('Dates');
      expect(output[0].headerExtractions[1].type).to.equal('date');
      expect(output[0].headerExtractions[1].data.length).to.equal(1);

      expect(output[0].headerExtractions[1].data[0].confidence).to.not.exist;
      expect(output[0].headerExtractions[1].data[0].count).to.not.exist;
      expect(output[0].headerExtractions[1].data[0].highlight).to.not.exist;
      expect(output[0].headerExtractions[1].data[0].id).to.equal('date1');
      expect(output[0].headerExtractions[1].data[0].icon).to.equal('dateIcon');
      expect(output[0].headerExtractions[1].data[0].link).to.not.exist;
      expect(output[0].headerExtractions[1].data[0].provenances.length).to.equal(0);
      expect(output[0].headerExtractions[1].data[0].styleClass).to.equal('dateStyle');
      expect(output[0].headerExtractions[1].data[0].text).to.equal('From Jan 1, 2018 to Feb 2, 2018');
      expect(output[0].headerExtractions[1].data[0].type).to.equal('date');
      expect(output[0].headerExtractions[1].data[0].width).to.not.exist;

      expect(output[0].headerExtractions[2].isDate).to.be.false;
      expect(output[0].headerExtractions[2].isUrl).to.be.false;
      expect(output[0].headerExtractions[2].key).to.equal('city');
      expect(output[0].headerExtractions[2].name).to.equal('Cities');
      expect(output[0].headerExtractions[2].type).to.equal('location');
      expect(output[0].headerExtractions[2].data.length).to.equal(2);

      expect(output[0].headerExtractions[2].data[0].confidence).to.not.exist;
      expect(output[0].headerExtractions[2].data[0].count).to.not.exist;
      expect(output[0].headerExtractions[2].data[0].highlight).to.not.exist;
      expect(output[0].headerExtractions[2].data[0].id).to.equal('city1:state1:country1:1:11');
      expect(output[0].headerExtractions[2].data[0].icon).to.equal('cityIcon');
      expect(output[0].headerExtractions[2].data[0].link).to.equal('/entity.html?domain=TestDomain&id=city1%3Astate1%3Acountry1%3A1%3A11&type=city');
      expect(output[0].headerExtractions[2].data[0].provenances.length).to.equal(0);
      expect(output[0].headerExtractions[2].data[0].styleClass).to.equal('cityStyle');
      expect(output[0].headerExtractions[2].data[0].text).to.equal('city1, state1');
      expect(output[0].headerExtractions[2].data[0].type).to.equal('city');
      expect(output[0].headerExtractions[2].data[0].width).to.not.exist;

      expect(output[0].headerExtractions[2].data[1].confidence).to.not.exist;
      expect(output[0].headerExtractions[2].data[1].count).to.not.exist;
      expect(output[0].headerExtractions[2].data[1].highlight).to.not.exist;
      expect(output[0].headerExtractions[2].data[1].id).to.equal('city2:state2:country2:2:22');
      expect(output[0].headerExtractions[2].data[1].icon).to.equal('cityIcon');
      expect(output[0].headerExtractions[2].data[1].link).to.equal('/entity.html?domain=TestDomain&id=city2%3Astate2%3Acountry2%3A2%3A22&type=city');
      expect(output[0].headerExtractions[2].data[1].provenances.length).to.equal(0);
      expect(output[0].headerExtractions[2].data[1].styleClass).to.equal('cityStyle');
      expect(output[0].headerExtractions[2].data[1].text).to.equal('city2, state2');
      expect(output[0].headerExtractions[2].data[1].type).to.equal('city');
      expect(output[0].headerExtractions[2].data[1].width).to.not.exist;

      expect(output[0].headerExtractions[3].isDate).to.be.false;
      expect(output[0].headerExtractions[3].isUrl).to.be.false;
      expect(output[0].headerExtractions[3].key).to.equal('label');
      expect(output[0].headerExtractions[3].name).to.equal('Labels');
      expect(output[0].headerExtractions[3].type).to.equal('string');
      expect(output[0].headerExtractions[3].data.length).to.equal(2);

      expect(output[0].headerExtractions[3].data[0].confidence).to.not.exist;
      expect(output[0].headerExtractions[3].data[0].count).to.not.exist;
      expect(output[0].headerExtractions[3].data[0].highlight).to.not.exist;
      expect(output[0].headerExtractions[3].data[0].id).to.equal('label1');
      expect(output[0].headerExtractions[3].data[0].icon).to.equal('labelIcon');
      expect(output[0].headerExtractions[3].data[0].link).to.not.exist;
      expect(output[0].headerExtractions[3].data[0].provenances.length).to.equal(0);
      expect(output[0].headerExtractions[3].data[0].styleClass).to.equal('labelStyle');
      expect(output[0].headerExtractions[3].data[0].text).to.equal('Label1');
      expect(output[0].headerExtractions[3].data[0].type).to.equal('label');
      expect(output[0].headerExtractions[3].data[0].width).to.not.exist;

      expect(output[0].headerExtractions[3].data[1].confidence).to.not.exist;
      expect(output[0].headerExtractions[3].data[1].count).to.not.exist;
      expect(output[0].headerExtractions[3].data[1].highlight).to.not.exist;
      expect(output[0].headerExtractions[3].data[1].id).to.equal('label2');
      expect(output[0].headerExtractions[3].data[1].icon).to.equal('labelIcon');
      expect(output[0].headerExtractions[3].data[1].link).to.not.exist;
      expect(output[0].headerExtractions[3].data[1].provenances.length).to.equal(0);
      expect(output[0].headerExtractions[3].data[1].styleClass).to.equal('labelStyle');
      expect(output[0].headerExtractions[3].data[1].text).to.equal('Label2');
      expect(output[0].headerExtractions[3].data[1].type).to.equal('label');
      expect(output[0].headerExtractions[3].data[1].width).to.not.exist;

      expect(output[0].detailExtractions[0].isDate).to.be.false;
      expect(output[0].detailExtractions[0].isUrl).to.be.false;
      expect(output[0].detailExtractions[0].key).to.equal('email');
      expect(output[0].detailExtractions[0].name).to.equal('Emails');
      expect(output[0].detailExtractions[0].type).to.equal('email');
      expect(output[0].detailExtractions[0].data.length).to.equal(2);

      expect(output[0].detailExtractions[0].data[0].confidence).to.not.exist;
      expect(output[0].detailExtractions[0].data[0].count).to.not.exist;
      expect(output[0].detailExtractions[0].data[0].highlight).to.not.exist;
      expect(output[0].detailExtractions[0].data[0].id).to.equal('email1@address1.com');
      expect(output[0].detailExtractions[0].data[0].icon).to.equal('emailIcon');
      expect(output[0].detailExtractions[0].data[0].link).to.equal('/entity.html?domain=TestDomain&id=email1%40address1.com&type=email');
      expect(output[0].detailExtractions[0].data[0].provenances.length).to.equal(0);
      expect(output[0].detailExtractions[0].data[0].styleClass).to.equal('emailStyle');
      expect(output[0].detailExtractions[0].data[0].text).to.equal('email1@address1.com');
      expect(output[0].detailExtractions[0].data[0].type).to.equal('email');
      expect(output[0].detailExtractions[0].data[0].width).to.not.exist;

      expect(output[0].detailExtractions[0].data[1].confidence).to.not.exist;
      expect(output[0].detailExtractions[0].data[1].count).to.not.exist;
      expect(output[0].detailExtractions[0].data[1].highlight).to.not.exist;
      expect(output[0].detailExtractions[0].data[1].id).to.equal('email2@address2.com');
      expect(output[0].detailExtractions[0].data[1].icon).to.equal('emailIcon');
      expect(output[0].detailExtractions[0].data[1].link).to.equal('/entity.html?domain=TestDomain&id=email2%40address2.com&type=email');
      expect(output[0].detailExtractions[0].data[1].provenances.length).to.equal(0);
      expect(output[0].detailExtractions[0].data[1].styleClass).to.equal('emailStyle');
      expect(output[0].detailExtractions[0].data[1].text).to.equal('email2@address2.com');
      expect(output[0].detailExtractions[0].data[1].type).to.equal('email');
      expect(output[0].detailExtractions[0].data[1].width).to.not.exist;

      expect(output[0].detailExtractions[1].isDate).to.be.false;
      expect(output[0].detailExtractions[1].isUrl).to.be.false;
      expect(output[0].detailExtractions[1].key).to.equal('number');
      expect(output[0].detailExtractions[1].name).to.equal('Numbers');
      expect(output[0].detailExtractions[1].type).to.equal('number');
      expect(output[0].detailExtractions[1].data.length).to.equal(2);

      expect(output[0].detailExtractions[1].data[0].confidence).to.not.exist;
      expect(output[0].detailExtractions[1].data[0].count).to.not.exist;
      expect(output[0].detailExtractions[1].data[0].highlight).to.not.exist;
      expect(output[0].detailExtractions[1].data[0].id).to.equal(321);
      expect(output[0].detailExtractions[1].data[0].icon).to.equal('numberIcon');
      expect(output[0].detailExtractions[1].data[0].link).to.not.exist;
      expect(output[0].detailExtractions[1].data[0].provenances.length).to.equal(0);
      expect(output[0].detailExtractions[1].data[0].styleClass).to.equal('numberStyle');
      expect(output[0].detailExtractions[1].data[0].text).to.equal(321);
      expect(output[0].detailExtractions[1].data[0].type).to.equal('number');
      expect(output[0].detailExtractions[1].data[0].width).to.not.exist;

      expect(output[0].detailExtractions[1].data[1].confidence).to.not.exist;
      expect(output[0].detailExtractions[1].data[1].count).to.not.exist;
      expect(output[0].detailExtractions[1].data[1].highlight).to.not.exist;
      expect(output[0].detailExtractions[1].data[1].id).to.equal(654);
      expect(output[0].detailExtractions[1].data[1].icon).to.equal('numberIcon');
      expect(output[0].detailExtractions[1].data[1].link).to.not.exist;
      expect(output[0].detailExtractions[1].data[1].provenances.length).to.equal(0);
      expect(output[0].detailExtractions[1].data[1].styleClass).to.equal('numberStyle');
      expect(output[0].detailExtractions[1].data[1].text).to.equal(654);
      expect(output[0].detailExtractions[1].data[1].type).to.equal('number');
      expect(output[0].detailExtractions[1].data[1].width).to.not.exist;

      expect(output[0].detailExtractions[2].isDate).to.be.false;
      expect(output[0].detailExtractions[2].isUrl).to.be.false;
      expect(output[0].detailExtractions[2].key).to.equal('phone');
      expect(output[0].detailExtractions[2].name).to.equal('Phones');
      expect(output[0].detailExtractions[2].type).to.equal('phone');
      expect(output[0].detailExtractions[2].data.length).to.equal(2);

      expect(output[0].detailExtractions[2].data[0].confidence).to.not.exist;
      expect(output[0].detailExtractions[2].data[0].count).to.not.exist;
      expect(output[0].detailExtractions[2].data[0].highlight).to.not.exist;
      expect(output[0].detailExtractions[2].data[0].id).to.equal('1112223333');
      expect(output[0].detailExtractions[2].data[0].icon).to.equal('phoneIcon');
      expect(output[0].detailExtractions[2].data[0].link).to.equal('/entity.html?domain=TestDomain&id=1112223333&type=phone');
      expect(output[0].detailExtractions[2].data[0].provenances.length).to.equal(0);
      expect(output[0].detailExtractions[2].data[0].styleClass).to.equal('phoneStyle');
      expect(output[0].detailExtractions[2].data[0].text).to.equal('111-222-3333');
      expect(output[0].detailExtractions[2].data[0].type).to.equal('phone');
      expect(output[0].detailExtractions[2].data[0].width).to.not.exist;

      expect(output[0].detailExtractions[2].data[1].confidence).to.not.exist;
      expect(output[0].detailExtractions[2].data[1].count).to.not.exist;
      expect(output[0].detailExtractions[2].data[1].highlight).to.not.exist;
      expect(output[0].detailExtractions[2].data[1].id).to.equal('4445556666');
      expect(output[0].detailExtractions[2].data[1].icon).to.equal('phoneIcon');
      expect(output[0].detailExtractions[2].data[1].link).to.equal('/entity.html?domain=TestDomain&id=4445556666&type=phone');
      expect(output[0].detailExtractions[2].data[1].provenances.length).to.equal(0);
      expect(output[0].detailExtractions[2].data[1].styleClass).to.equal('phoneStyle');
      expect(output[0].detailExtractions[2].data[1].text).to.equal('444-555-6666');
      expect(output[0].detailExtractions[2].data[1].type).to.equal('phone');
      expect(output[0].detailExtractions[2].data[1].width).to.not.exist;

      expect(output[0].detailExtractions[3].isDate).to.be.false;
      expect(output[0].detailExtractions[3].isUrl).to.be.false;
      expect(output[0].detailExtractions[3].key).to.equal('price');
      expect(output[0].detailExtractions[3].name).to.equal('Prices');
      expect(output[0].detailExtractions[3].type).to.equal('hyphenated');
      expect(output[0].detailExtractions[3].data.length).to.equal(2);

      expect(output[0].detailExtractions[3].data[0].confidence).to.not.exist;
      expect(output[0].detailExtractions[3].data[0].count).to.not.exist;
      expect(output[0].detailExtractions[3].data[0].highlight).to.not.exist;
      expect(output[0].detailExtractions[3].data[0].id).to.equal('price1-currency:currency1-time_unit:time1');
      expect(output[0].detailExtractions[3].data[0].icon).to.equal('priceIcon');
      expect(output[0].detailExtractions[3].data[0].link).to.not.exist;
      expect(output[0].detailExtractions[3].data[0].provenances.length).to.equal(0);
      expect(output[0].detailExtractions[3].data[0].styleClass).to.equal('priceStyle');
      expect(output[0].detailExtractions[3].data[0].text).to.equal('price1 currency1 per time1 minutes');
      expect(output[0].detailExtractions[3].data[0].type).to.equal('price');
      expect(output[0].detailExtractions[3].data[0].width).to.not.exist;

      expect(output[0].detailExtractions[3].data[1].confidence).to.not.exist;
      expect(output[0].detailExtractions[3].data[1].count).to.not.exist;
      expect(output[0].detailExtractions[3].data[1].highlight).to.not.exist;
      expect(output[0].detailExtractions[3].data[1].id).to.equal('price2-currency:currency2-time_unit:time2');
      expect(output[0].detailExtractions[3].data[1].icon).to.equal('priceIcon');
      expect(output[0].detailExtractions[3].data[1].link).to.not.exist;
      expect(output[0].detailExtractions[3].data[1].provenances.length).to.equal(0);
      expect(output[0].detailExtractions[3].data[1].styleClass).to.equal('priceStyle');
      expect(output[0].detailExtractions[3].data[1].text).to.equal('price2 currency2 per time2 minutes');
      expect(output[0].detailExtractions[3].data[1].type).to.equal('price');
      expect(output[0].detailExtractions[3].data[1].width).to.not.exist;

      expect(output[0].detailExtractions[4].isDate).to.be.false;
      expect(output[0].detailExtractions[4].isUrl).to.be.false;
      expect(output[0].detailExtractions[4].key).to.equal('unnested');
      expect(output[0].detailExtractions[4].name).to.equal('Unnested Items');
      expect(output[0].detailExtractions[4].type).to.equal('string');
      expect(output[0].detailExtractions[4].data.length).to.equal(2);

      expect(output[0].detailExtractions[4].data[0].confidence).to.not.exist;
      expect(output[0].detailExtractions[4].data[0].count).to.not.exist;
      expect(output[0].detailExtractions[4].data[0].highlight).to.not.exist;
      expect(output[0].detailExtractions[4].data[0].id).to.equal('unnested1');
      expect(output[0].detailExtractions[4].data[0].icon).to.equal('unnestedIcon');
      expect(output[0].detailExtractions[4].data[0].link).to.not.exist;
      expect(output[0].detailExtractions[4].data[0].provenances.length).to.equal(0);
      expect(output[0].detailExtractions[4].data[0].styleClass).to.equal('unnestedStyle');
      expect(output[0].detailExtractions[4].data[0].text).to.equal('unnested1');
      expect(output[0].detailExtractions[4].data[0].type).to.equal('unnested');
      expect(output[0].detailExtractions[4].data[0].width).to.not.exist;

      expect(output[0].detailExtractions[4].data[1].confidence).to.not.exist;
      expect(output[0].detailExtractions[4].data[1].count).to.not.exist;
      expect(output[0].detailExtractions[4].data[1].highlight).to.not.exist;
      expect(output[0].detailExtractions[4].data[1].id).to.equal('unnested2');
      expect(output[0].detailExtractions[4].data[1].icon).to.equal('unnestedIcon');
      expect(output[0].detailExtractions[4].data[1].link).to.not.exist;
      expect(output[0].detailExtractions[4].data[1].provenances.length).to.equal(0);
      expect(output[0].detailExtractions[4].data[1].styleClass).to.equal('unnestedStyle');
      expect(output[0].detailExtractions[4].data[1].text).to.equal('unnested2');
      expect(output[0].detailExtractions[4].data[1].type).to.equal('unnested');
      expect(output[0].detailExtractions[4].data[1].width).to.not.exist;

      expect(output[0].detailExtractions[5].isDate).to.be.false;
      expect(output[0].detailExtractions[5].isUrl).to.be.false;
      expect(output[0].detailExtractions[5].key).to.equal('user');
      expect(output[0].detailExtractions[5].name).to.equal('Users');
      expect(output[0].detailExtractions[5].type).to.equal('username');
      expect(output[0].detailExtractions[5].data.length).to.equal(2);

      expect(output[0].detailExtractions[5].data[0].confidence).to.not.exist;
      expect(output[0].detailExtractions[5].data[0].count).to.not.exist;
      expect(output[0].detailExtractions[5].data[0].highlight).to.not.exist;
      expect(output[0].detailExtractions[5].data[0].id).to.equal('type1 user1');
      expect(output[0].detailExtractions[5].data[0].icon).to.equal('userIcon');
      expect(output[0].detailExtractions[5].data[0].link).to.equal('/entity.html?domain=TestDomain&id=type1%20user1&type=user');
      expect(output[0].detailExtractions[5].data[0].provenances.length).to.equal(0);
      expect(output[0].detailExtractions[5].data[0].styleClass).to.equal('userStyle');
      expect(output[0].detailExtractions[5].data[0].text).to.equal('User1');
      expect(output[0].detailExtractions[5].data[0].type).to.equal('user');
      expect(output[0].detailExtractions[5].data[0].width).to.not.exist;

      expect(output[0].detailExtractions[5].data[1].confidence).to.not.exist;
      expect(output[0].detailExtractions[5].data[1].count).to.not.exist;
      expect(output[0].detailExtractions[5].data[1].highlight).to.not.exist;
      expect(output[0].detailExtractions[5].data[1].id).to.equal('type2 user2');
      expect(output[0].detailExtractions[5].data[1].icon).to.equal('userIcon');
      expect(output[0].detailExtractions[5].data[1].link).to.equal('/entity.html?domain=TestDomain&id=type2%20user2&type=user');
      expect(output[0].detailExtractions[5].data[1].provenances.length).to.equal(0);
      expect(output[0].detailExtractions[5].data[1].styleClass).to.equal('userStyle');
      expect(output[0].detailExtractions[5].data[1].text).to.equal('User2');
      expect(output[0].detailExtractions[5].data[1].type).to.equal('user');
      expect(output[0].detailExtractions[5].data[1].width).to.not.exist;

      expect(output[0].nestedExtractions[0].isDate).to.be.false;
      expect(output[0].nestedExtractions[0].isUrl).to.be.false;
      expect(output[0].nestedExtractions[0].key).to.equal('comment');
      expect(output[0].nestedExtractions[0].name).to.equal('Comments');
      expect(output[0].nestedExtractions[0].type).to.equal('kg_id');
      expect(output[0].nestedExtractions[0].data.length).to.equal(2);

      expect(output[0].nestedExtractions[0].data[0].confidence).to.not.exist;
      expect(output[0].nestedExtractions[0].data[0].count).to.not.exist;
      expect(output[0].nestedExtractions[0].data[0].id).to.equal('comment1');
      expect(output[0].nestedExtractions[0].data[0].icon).to.equal('commentIcon');
      expect(output[0].nestedExtractions[0].data[0].link).to.equal('/result.html?domain=TestDomain&id=comment1');
      expect(output[0].nestedExtractions[0].data[0].provenances.length).to.equal(0);
      expect(output[0].nestedExtractions[0].data[0].styleClass).to.equal('commentStyle');
      expect(output[0].nestedExtractions[0].data[0].text).to.equal('comment1');
      expect(output[0].nestedExtractions[0].data[0].type).to.equal('comment');
      expect(output[0].nestedExtractions[0].data[0].width).to.not.exist;

      expect(output[0].nestedExtractions[0].data[1].confidence).to.not.exist;
      expect(output[0].nestedExtractions[0].data[1].count).to.not.exist;
      expect(output[0].nestedExtractions[0].data[1].id).to.equal('comment2');
      expect(output[0].nestedExtractions[0].data[1].icon).to.equal('commentIcon');
      expect(output[0].nestedExtractions[0].data[1].link).to.equal('/result.html?domain=TestDomain&id=comment2');
      expect(output[0].nestedExtractions[0].data[1].provenances.length).to.equal(0);
      expect(output[0].nestedExtractions[0].data[1].styleClass).to.equal('commentStyle');
      expect(output[0].nestedExtractions[0].data[1].text).to.equal('comment2');
      expect(output[0].nestedExtractions[0].data[1].type).to.equal('comment');
      expect(output[0].nestedExtractions[0].data[1].width).to.not.exist;

      expect(output[0].details[0].name).to.equal('Url');
      expect(output[0].details[0].link).to.equal('testUrl1');
      expect(output[0].details[0].text).to.equal('testUrl1');

      expect(output[0].details[1].name).to.equal('Description');
      expect(output[0].details[1].highlightedText).to.equal('This is description 1');
      expect(output[0].details[1].text).to.equal('This is description 1');

      expect(output[0].details[2].name).to.equal('Cached Page');
      expect(output[0].details[2].link).to.equal('/cached.html?domain=TestDomain&id=ABC123');
      expect(output[0].details[2].text).to.equal('Open in New Tab (Runs External Code)');

      expect(output[1].id).to.equal('DEF456');
      expect(output[1].description).to.equal('This is description 3');
      expect(output[1].highlightedText).to.equal('Title 3');
      expect(output[1].icon).to.equal('TestIcon');
      expect(output[1].link).to.equal('/result.html?domain=TestDomain&id=DEF456');
      expect(output[1].name).to.equal('TestResult');
      expect(output[1].tags).to.deep.equal({});
      expect(output[1].title).to.equal('Title 3');
      expect(output[1].type).to.equal('webpage');
      expect(output[1].url).to.equal('testUrl2');

      expect(output[1].timestamp).to.not.exist;
      expect(output[1].esData).to.not.exist;
      expect(output[1].images).to.not.exist;
      expect(output[1].styleClass).to.not.exist;
      expect(output[1].headerExtractions.length).to.equal(4);
      expect(output[1].detailExtractions.length).to.equal(6);
      expect(output[1].nestedExtractions.length).to.equal(1);
      expect(output[1].details.length).to.equal(3);

      expect(output[1].headerExtractions[0].isDate).to.be.false;
      expect(output[1].headerExtractions[0].isUrl).to.be.true;
      expect(output[1].headerExtractions[0].key).to.equal('website');
      expect(output[1].headerExtractions[0].name).to.equal('Website');
      expect(output[1].headerExtractions[0].type).to.equal('url');
      expect(output[1].headerExtractions[0].data.length).to.equal(1);

      expect(output[1].headerExtractions[0].data[0].confidence).to.not.exist;
      expect(output[1].headerExtractions[0].data[0].count).to.not.exist;
      expect(output[1].headerExtractions[0].data[0].highlight).to.not.exist;
      expect(output[1].headerExtractions[0].data[0].id).to.equal('website3.com');
      expect(output[1].headerExtractions[0].data[0].icon).to.equal('websiteIcon');
      expect(output[1].headerExtractions[0].data[0].link).to.not.exist;
      expect(output[1].headerExtractions[0].data[0].provenances.length).to.equal(0);
      expect(output[1].headerExtractions[0].data[0].styleClass).to.equal('websiteStyle');
      expect(output[1].headerExtractions[0].data[0].text).to.equal('website3.com');
      expect(output[1].headerExtractions[0].data[0].type).to.equal('website');
      expect(output[1].headerExtractions[0].data[0].width).to.not.exist;

      expect(output[1].headerExtractions[1].isDate).to.be.true;
      expect(output[1].headerExtractions[1].isUrl).to.be.false;
      expect(output[1].headerExtractions[1].key).to.equal('date');
      expect(output[1].headerExtractions[1].name).to.equal('Date');
      expect(output[1].headerExtractions[1].type).to.equal('date');
      expect(output[1].headerExtractions[1].data.length).to.equal(1);

      expect(output[1].headerExtractions[1].data[0].confidence).to.not.exist;
      expect(output[1].headerExtractions[1].data[0].count).to.not.exist;
      expect(output[1].headerExtractions[1].data[0].highlight).to.not.exist;
      expect(output[1].headerExtractions[1].data[0].id).to.equal('date3');
      expect(output[1].headerExtractions[1].data[0].icon).to.equal('dateIcon');
      expect(output[1].headerExtractions[1].data[0].link).to.not.exist;
      expect(output[1].headerExtractions[1].data[0].provenances.length).to.equal(0);
      expect(output[1].headerExtractions[1].data[0].styleClass).to.equal('dateStyle');
      expect(output[1].headerExtractions[1].data[0].text).to.equal('Mar 3, 2018');
      expect(output[1].headerExtractions[1].data[0].type).to.equal('date');
      expect(output[1].headerExtractions[1].data[0].width).to.not.exist;

      expect(output[1].headerExtractions[2].isDate).to.be.false;
      expect(output[1].headerExtractions[2].isUrl).to.be.false;
      expect(output[1].headerExtractions[2].key).to.equal('city');
      expect(output[1].headerExtractions[2].name).to.equal('City');
      expect(output[1].headerExtractions[2].type).to.equal('location');
      expect(output[1].headerExtractions[2].data.length).to.equal(1);

      expect(output[1].headerExtractions[2].data[0].confidence).to.not.exist;
      expect(output[1].headerExtractions[2].data[0].count).to.not.exist;
      expect(output[1].headerExtractions[2].data[0].highlight).to.not.exist;
      expect(output[1].headerExtractions[2].data[0].id).to.equal('city3:state3:country3:3:33');
      expect(output[1].headerExtractions[2].data[0].icon).to.equal('cityIcon');
      expect(output[1].headerExtractions[2].data[0].link).to.equal('/entity.html?domain=TestDomain&id=city3%3Astate3%3Acountry3%3A3%3A33&type=city');
      expect(output[1].headerExtractions[2].data[0].provenances.length).to.equal(0);
      expect(output[1].headerExtractions[2].data[0].styleClass).to.equal('cityStyle');
      expect(output[1].headerExtractions[2].data[0].text).to.equal('city3, state3');
      expect(output[1].headerExtractions[2].data[0].type).to.equal('city');
      expect(output[1].headerExtractions[2].data[0].width).to.not.exist;

      expect(output[1].headerExtractions[3].isDate).to.be.false;
      expect(output[1].headerExtractions[3].isUrl).to.be.false;
      expect(output[1].headerExtractions[3].key).to.equal('label');
      expect(output[1].headerExtractions[3].name).to.equal('Label');
      expect(output[1].headerExtractions[3].type).to.equal('string');
      expect(output[1].headerExtractions[3].data.length).to.equal(1);

      expect(output[1].headerExtractions[3].data[0].confidence).to.not.exist;
      expect(output[1].headerExtractions[3].data[0].count).to.not.exist;
      expect(output[1].headerExtractions[3].data[0].highlight).to.not.exist;
      expect(output[1].headerExtractions[3].data[0].id).to.equal('label3');
      expect(output[1].headerExtractions[3].data[0].icon).to.equal('labelIcon');
      expect(output[1].headerExtractions[3].data[0].link).to.not.exist;
      expect(output[1].headerExtractions[3].data[0].provenances.length).to.equal(0);
      expect(output[1].headerExtractions[3].data[0].styleClass).to.equal('labelStyle');
      expect(output[1].headerExtractions[3].data[0].text).to.equal('Label3');
      expect(output[1].headerExtractions[3].data[0].type).to.equal('label');
      expect(output[1].headerExtractions[3].data[0].width).to.not.exist;

      expect(output[1].detailExtractions[0].isDate).to.be.false;
      expect(output[1].detailExtractions[0].isUrl).to.be.false;
      expect(output[1].detailExtractions[0].key).to.equal('email');
      expect(output[1].detailExtractions[0].name).to.equal('Email');
      expect(output[1].detailExtractions[0].type).to.equal('email');
      expect(output[1].detailExtractions[0].data.length).to.equal(1);

      expect(output[1].detailExtractions[0].data[0].confidence).to.not.exist;
      expect(output[1].detailExtractions[0].data[0].count).to.not.exist;
      expect(output[1].detailExtractions[0].data[0].highlight).to.not.exist;
      expect(output[1].detailExtractions[0].data[0].id).to.equal('email3@address3.com');
      expect(output[1].detailExtractions[0].data[0].icon).to.equal('emailIcon');
      expect(output[1].detailExtractions[0].data[0].link).to.equal('/entity.html?domain=TestDomain&id=email3%40address3.com&type=email');
      expect(output[1].detailExtractions[0].data[0].provenances.length).to.equal(0);
      expect(output[1].detailExtractions[0].data[0].styleClass).to.equal('emailStyle');
      expect(output[1].detailExtractions[0].data[0].text).to.equal('email3@address3.com');
      expect(output[1].detailExtractions[0].data[0].type).to.equal('email');
      expect(output[1].detailExtractions[0].data[0].width).to.not.exist;

      expect(output[1].detailExtractions[1].isDate).to.be.false;
      expect(output[1].detailExtractions[1].isUrl).to.be.false;
      expect(output[1].detailExtractions[1].key).to.equal('number');
      expect(output[1].detailExtractions[1].name).to.equal('Number');
      expect(output[1].detailExtractions[1].type).to.equal('number');
      expect(output[1].detailExtractions[1].data.length).to.equal(1);

      expect(output[1].detailExtractions[1].data[0].confidence).to.not.exist;
      expect(output[1].detailExtractions[1].data[0].count).to.not.exist;
      expect(output[1].detailExtractions[1].data[0].highlight).to.not.exist;
      expect(output[1].detailExtractions[1].data[0].id).to.equal(987);
      expect(output[1].detailExtractions[1].data[0].icon).to.equal('numberIcon');
      expect(output[1].detailExtractions[1].data[0].link).to.not.exist;
      expect(output[1].detailExtractions[1].data[0].provenances.length).to.equal(0);
      expect(output[1].detailExtractions[1].data[0].styleClass).to.equal('numberStyle');
      expect(output[1].detailExtractions[1].data[0].text).to.equal(987);
      expect(output[1].detailExtractions[1].data[0].type).to.equal('number');
      expect(output[1].detailExtractions[1].data[0].width).to.not.exist;

      expect(output[1].detailExtractions[2].isDate).to.be.false;
      expect(output[1].detailExtractions[2].isUrl).to.be.false;
      expect(output[1].detailExtractions[2].key).to.equal('phone');
      expect(output[1].detailExtractions[2].name).to.equal('Phone');
      expect(output[1].detailExtractions[2].type).to.equal('phone');
      expect(output[1].detailExtractions[2].data.length).to.equal(1);

      expect(output[1].detailExtractions[2].data[0].confidence).to.not.exist;
      expect(output[1].detailExtractions[2].data[0].count).to.not.exist;
      expect(output[1].detailExtractions[2].data[0].highlight).to.not.exist;
      expect(output[1].detailExtractions[2].data[0].id).to.equal('7778889999');
      expect(output[1].detailExtractions[2].data[0].icon).to.equal('phoneIcon');
      expect(output[1].detailExtractions[2].data[0].link).to.equal('/entity.html?domain=TestDomain&id=7778889999&type=phone');
      expect(output[1].detailExtractions[2].data[0].provenances.length).to.equal(0);
      expect(output[1].detailExtractions[2].data[0].styleClass).to.equal('phoneStyle');
      expect(output[1].detailExtractions[2].data[0].text).to.equal('777-888-9999');
      expect(output[1].detailExtractions[2].data[0].type).to.equal('phone');
      expect(output[1].detailExtractions[2].data[0].width).to.not.exist;

      expect(output[1].detailExtractions[3].isDate).to.be.false;
      expect(output[1].detailExtractions[3].isUrl).to.be.false;
      expect(output[1].detailExtractions[3].key).to.equal('price');
      expect(output[1].detailExtractions[3].name).to.equal('Price');
      expect(output[1].detailExtractions[3].type).to.equal('hyphenated');
      expect(output[1].detailExtractions[3].data.length).to.equal(1);

      expect(output[1].detailExtractions[3].data[0].confidence).to.not.exist;
      expect(output[1].detailExtractions[3].data[0].count).to.not.exist;
      expect(output[1].detailExtractions[3].data[0].highlight).to.not.exist;
      expect(output[1].detailExtractions[3].data[0].id).to.equal('price3-currency:currency3-time_unit:time3');
      expect(output[1].detailExtractions[3].data[0].icon).to.equal('priceIcon');
      expect(output[1].detailExtractions[3].data[0].link).to.not.exist;
      expect(output[1].detailExtractions[3].data[0].provenances.length).to.equal(0);
      expect(output[1].detailExtractions[3].data[0].styleClass).to.equal('priceStyle');
      expect(output[1].detailExtractions[3].data[0].text).to.equal('price3 currency3 per time3 minutes');
      expect(output[1].detailExtractions[3].data[0].type).to.equal('price');
      expect(output[1].detailExtractions[3].data[0].width).to.not.exist;

      expect(output[1].detailExtractions[4].isDate).to.be.false;
      expect(output[1].detailExtractions[4].isUrl).to.be.false;
      expect(output[1].detailExtractions[4].key).to.equal('unnested');
      expect(output[1].detailExtractions[4].name).to.equal('Unnested Item');
      expect(output[1].detailExtractions[4].type).to.equal('string');
      expect(output[1].detailExtractions[4].data.length).to.equal(1);

      expect(output[1].detailExtractions[4].data[0].confidence).to.not.exist;
      expect(output[1].detailExtractions[4].data[0].count).to.not.exist;
      expect(output[1].detailExtractions[4].data[0].highlight).to.not.exist;
      expect(output[1].detailExtractions[4].data[0].id).to.equal('unnested3');
      expect(output[1].detailExtractions[4].data[0].icon).to.equal('unnestedIcon');
      expect(output[1].detailExtractions[4].data[0].link).to.not.exist;
      expect(output[1].detailExtractions[4].data[0].provenances.length).to.equal(0);
      expect(output[1].detailExtractions[4].data[0].styleClass).to.equal('unnestedStyle');
      expect(output[1].detailExtractions[4].data[0].text).to.equal('unnested3');
      expect(output[1].detailExtractions[4].data[0].type).to.equal('unnested');
      expect(output[1].detailExtractions[4].data[0].width).to.not.exist;

      expect(output[1].detailExtractions[5].isDate).to.be.false;
      expect(output[1].detailExtractions[5].isUrl).to.be.false;
      expect(output[1].detailExtractions[5].key).to.equal('user');
      expect(output[1].detailExtractions[5].name).to.equal('User');
      expect(output[1].detailExtractions[5].type).to.equal('username');
      expect(output[1].detailExtractions[5].data.length).to.equal(1);

      expect(output[1].detailExtractions[5].data[0].confidence).to.not.exist;
      expect(output[1].detailExtractions[5].data[0].count).to.not.exist;
      expect(output[1].detailExtractions[5].data[0].highlight).to.not.exist;
      expect(output[1].detailExtractions[5].data[0].id).to.equal('type3 user3');
      expect(output[1].detailExtractions[5].data[0].icon).to.equal('userIcon');
      expect(output[1].detailExtractions[5].data[0].link).to.equal('/entity.html?domain=TestDomain&id=type3%20user3&type=user');
      expect(output[1].detailExtractions[5].data[0].provenances.length).to.equal(0);
      expect(output[1].detailExtractions[5].data[0].styleClass).to.equal('userStyle');
      expect(output[1].detailExtractions[5].data[0].text).to.equal('User3');
      expect(output[1].detailExtractions[5].data[0].type).to.equal('user');
      expect(output[1].detailExtractions[5].data[0].width).to.not.exist;

      expect(output[1].nestedExtractions[0].isDate).to.be.false;
      expect(output[1].nestedExtractions[0].isUrl).to.be.false;
      expect(output[1].nestedExtractions[0].key).to.equal('comment');
      expect(output[1].nestedExtractions[0].name).to.equal('Comment');
      expect(output[1].nestedExtractions[0].type).to.equal('kg_id');
      expect(output[1].nestedExtractions[0].data.length).to.equal(1);

      expect(output[1].nestedExtractions[0].data[0].confidence).to.not.exist;
      expect(output[1].nestedExtractions[0].data[0].count).to.not.exist;
      expect(output[1].nestedExtractions[0].data[0].id).to.equal('comment3');
      expect(output[1].nestedExtractions[0].data[0].icon).to.equal('commentIcon');
      expect(output[1].nestedExtractions[0].data[0].link).to.equal('/result.html?domain=TestDomain&id=comment3');
      expect(output[1].nestedExtractions[0].data[0].provenances.length).to.equal(0);
      expect(output[1].nestedExtractions[0].data[0].styleClass).to.equal('commentStyle');
      expect(output[1].nestedExtractions[0].data[0].text).to.equal('comment3');
      expect(output[1].nestedExtractions[0].data[0].type).to.equal('comment');
      expect(output[1].nestedExtractions[0].data[0].width).to.not.exist;

      expect(output[1].details[0].name).to.equal('Url');
      expect(output[1].details[0].link).to.equal('testUrl2');
      expect(output[1].details[0].text).to.equal('testUrl2');

      expect(output[1].details[1].name).to.equal('Description');
      expect(output[1].details[1].highlightedText).to.equal('This is description 3');
      expect(output[1].details[1].text).to.equal('This is description 3');

      expect(output[1].details[2].name).to.equal('Cached Page');
      expect(output[1].details[2].link).to.equal('/cached.html?domain=TestDomain&id=DEF456');
      expect(output[1].details[2].text).to.equal('Open in New Tab (Runs External Code)');
    });

    test('results given images does return expected array', function() {
      /* jscs:disable requireCamelCaseOrUpperCaseIdentifiers */
      var output = transformFunctions.transforms.entity.results({
        hits: {
          hits: [{
            _source: {
              doc_id: 'ABC123',
              objects: [{
                img_sha1: 'image1'
              }, {
                img_sha1: 'image2'
              }],
              url: 'testUrl1'
            }
          }, {
            _source: {
              doc_id: 'DEF456',
              objects: [{
                img_sha1: 'image3'
              }],
              url: 'testUrl2'
            }
          }]
        }
      }, SEARCH_FIELDS);
      /* jscs:enable requireCamelCaseOrUpperCaseIdentifiers */

      expect(output[0].images.length).to.equal(2);

      expect(output[0].images[0].confidence).to.not.exist;
      expect(output[0].images[0].count).to.not.exist;
      expect(output[0].images[0].id).to.equal('image1');
      expect(output[0].images[0].icon).to.equal('image:photo');
      expect(output[0].images[0].link).to.equal('/entity.html?domain=TestDomain&id=image1&type=image');
      expect(output[0].images[0].provenances.length).to.equal(0);
      expect(output[0].images[0].styleClass).to.not.exist;
      expect(output[0].images[0].text).to.equal('Image #1');
      expect(output[0].images[0].type).to.equal('image');
      expect(output[0].images[0].width).to.not.exist;

      expect(output[0].images[1].confidence).to.not.exist;
      expect(output[0].images[1].count).to.not.exist;
      expect(output[0].images[1].id).to.equal('image2');
      expect(output[0].images[1].icon).to.equal('image:photo');
      expect(output[0].images[1].link).to.equal('/entity.html?domain=TestDomain&id=image2&type=image');
      expect(output[0].images[1].provenances.length).to.equal(0);
      expect(output[0].images[1].styleClass).to.not.exist;
      expect(output[0].images[1].text).to.equal('Image #2');
      expect(output[0].images[1].type).to.equal('image');
      expect(output[0].images[1].width).to.not.exist;

      expect(output[1].images.length).to.equal(1);

      expect(output[1].images[0].confidence).to.not.exist;
      expect(output[1].images[0].count).to.not.exist;
      expect(output[1].images[0].id).to.equal('image3');
      expect(output[1].images[0].icon).to.equal('image:photo');
      expect(output[1].images[0].link).to.equal('/entity.html?domain=TestDomain&id=image3&type=image');
      expect(output[1].images[0].provenances.length).to.equal(0);
      expect(output[1].images[0].styleClass).to.not.exist;
      expect(output[1].images[0].text).to.equal('Image #1');
      expect(output[1].images[0].type).to.equal('image');
      expect(output[1].images[0].width).to.not.exist;
    });

    test('results given string highlights does return expected array', function() {
      /* jscs:disable requireCamelCaseOrUpperCaseIdentifiers */
      var result = {
        highlight: {
          path1: ['<em>label1</em>']
        },
        matched_queries: [
          'highlight1:path1'
        ],
        _source: RESULT_1._source
      };
      var output = transformFunctions.transforms.entity.results({
        highlights: {
          label: {
            label1: 'highlight1'
          }
        },
        hits: {
          hits: [result]
        },
      }, SEARCH_FIELDS);
      /* jscs:enable requireCamelCaseOrUpperCaseIdentifiers */

      expect(output[0].headerExtractions[3].data[0].confidence).to.not.exist;
      expect(output[0].headerExtractions[3].data[0].count).to.not.exist;
      expect(output[0].headerExtractions[3].data[0].highlight).to.be.true;
      expect(output[0].headerExtractions[3].data[0].id).to.equal('label1');
      expect(output[0].headerExtractions[3].data[0].icon).to.equal('labelIcon');
      expect(output[0].headerExtractions[3].data[0].link).to.not.exist;
      expect(output[0].headerExtractions[3].data[0].provenances.length).to.equal(0);
      expect(output[0].headerExtractions[3].data[0].styleClass).to.equal('labelStyle');
      expect(output[0].headerExtractions[3].data[0].text).to.equal('Label1');
      expect(output[0].headerExtractions[3].data[0].type).to.equal('label');
      expect(output[0].headerExtractions[3].data[0].width).to.not.exist;

      expect(output[0].headerExtractions[3].data[1].confidence).to.not.exist;
      expect(output[0].headerExtractions[3].data[1].count).to.not.exist;
      expect(output[0].headerExtractions[3].data[1].highlight).to.be.false;
      expect(output[0].headerExtractions[3].data[1].id).to.equal('label2');
      expect(output[0].headerExtractions[3].data[1].icon).to.equal('labelIcon');
      expect(output[0].headerExtractions[3].data[1].link).to.not.exist;
      expect(output[0].headerExtractions[3].data[1].provenances.length).to.equal(0);
      expect(output[0].headerExtractions[3].data[1].styleClass).to.equal('labelStyle');
      expect(output[0].headerExtractions[3].data[1].text).to.equal('Label2');
      expect(output[0].headerExtractions[3].data[1].type).to.equal('label');
      expect(output[0].headerExtractions[3].data[1].width).to.not.exist;
    });

    test('results given location highlights does return expected array', function() {
      /* jscs:disable requireCamelCaseOrUpperCaseIdentifiers */
      var result = {
        highlight: {
          path1: ['<em>city1</em>, state1, country1'],
          path2: ['<em>city2, state2, country2</em>']
        },
        matched_queries: [
          'highlight1:path1',
          'highlight2:path2'
        ],
        _source: RESULT_1._source
      };
      var output = transformFunctions.transforms.entity.results({
        highlights: {
          city: {
            city1: 'highlight1',
            city2: 'highlight2'
          }
        },
        hits: {
          hits: [result]
        },
      }, SEARCH_FIELDS);
      /* jscs:enable requireCamelCaseOrUpperCaseIdentifiers */

      expect(output[0].headerExtractions[2].data[0].confidence).to.not.exist;
      expect(output[0].headerExtractions[2].data[0].count).to.not.exist;
      expect(output[0].headerExtractions[2].data[0].highlight).to.be.true;
      expect(output[0].headerExtractions[2].data[0].id).to.equal('city1:state1:country1:1:11');
      expect(output[0].headerExtractions[2].data[0].icon).to.equal('cityIcon');
      expect(output[0].headerExtractions[2].data[0].link).to.equal('/entity.html?domain=TestDomain&id=city1%3Astate1%3Acountry1%3A1%3A11&type=city');
      expect(output[0].headerExtractions[2].data[0].provenances.length).to.equal(0);
      expect(output[0].headerExtractions[2].data[0].styleClass).to.equal('cityStyle');
      expect(output[0].headerExtractions[2].data[0].text).to.equal('city1, state1');
      expect(output[0].headerExtractions[2].data[0].type).to.equal('city');
      expect(output[0].headerExtractions[2].data[0].width).to.not.exist;

      expect(output[0].headerExtractions[2].data[1].confidence).to.not.exist;
      expect(output[0].headerExtractions[2].data[1].count).to.not.exist;
      expect(output[0].headerExtractions[2].data[1].highlight).to.be.true;
      expect(output[0].headerExtractions[2].data[1].id).to.equal('city2:state2:country2:2:22');
      expect(output[0].headerExtractions[2].data[1].icon).to.equal('cityIcon');
      expect(output[0].headerExtractions[2].data[1].link).to.equal('/entity.html?domain=TestDomain&id=city2%3Astate2%3Acountry2%3A2%3A22&type=city');
      expect(output[0].headerExtractions[2].data[1].provenances.length).to.equal(0);
      expect(output[0].headerExtractions[2].data[1].styleClass).to.equal('cityStyle');
      expect(output[0].headerExtractions[2].data[1].text).to.equal('city2, state2');
      expect(output[0].headerExtractions[2].data[1].type).to.equal('city');
      expect(output[0].headerExtractions[2].data[1].width).to.not.exist;
    });

    test('results given email highlights does return expected array', function() {
      /* jscs:disable requireCamelCaseOrUpperCaseIdentifiers */
      var result = {
        highlight: {
          path1: ['<em>email1@address1.com</em>'],
          path2: ['<em>email2@address2.com</em>']
        },
        matched_queries: [
          'highlight1:path1',
          'highlight2:path2'
        ],
        _source: RESULT_1._source
      };
      var output = transformFunctions.transforms.entity.results({
        highlights: {
          email: {
            'email1@address1.com': 'highlight1',
            email2: 'highlight2'
          }
        },
        hits: {
          hits: [result]
        },
      }, SEARCH_FIELDS);
      /* jscs:enable requireCamelCaseOrUpperCaseIdentifiers */

      expect(output[0].detailExtractions[0].data[0].confidence).to.not.exist;
      expect(output[0].detailExtractions[0].data[0].count).to.not.exist;
      expect(output[0].detailExtractions[0].data[0].highlight).to.be.true;
      expect(output[0].detailExtractions[0].data[0].id).to.equal('email1@address1.com');
      expect(output[0].detailExtractions[0].data[0].icon).to.equal('emailIcon');
      expect(output[0].detailExtractions[0].data[0].link).to.equal('/entity.html?domain=TestDomain&id=email1%40address1.com&type=email');
      expect(output[0].detailExtractions[0].data[0].provenances.length).to.equal(0);
      expect(output[0].detailExtractions[0].data[0].styleClass).to.equal('emailStyle');
      expect(output[0].detailExtractions[0].data[0].text).to.equal('email1@address1.com');
      expect(output[0].detailExtractions[0].data[0].type).to.equal('email');
      expect(output[0].detailExtractions[0].data[0].width).to.not.exist;

      expect(output[0].detailExtractions[0].data[1].confidence).to.not.exist;
      expect(output[0].detailExtractions[0].data[1].count).to.not.exist;
      expect(output[0].detailExtractions[0].data[1].highlight).to.be.true;
      expect(output[0].detailExtractions[0].data[1].id).to.equal('email2@address2.com');
      expect(output[0].detailExtractions[0].data[1].icon).to.equal('emailIcon');
      expect(output[0].detailExtractions[0].data[1].link).to.equal('/entity.html?domain=TestDomain&id=email2%40address2.com&type=email');
      expect(output[0].detailExtractions[0].data[1].provenances.length).to.equal(0);
      expect(output[0].detailExtractions[0].data[1].styleClass).to.equal('emailStyle');
      expect(output[0].detailExtractions[0].data[1].text).to.equal('email2@address2.com');
      expect(output[0].detailExtractions[0].data[1].type).to.equal('email');
      expect(output[0].detailExtractions[0].data[1].width).to.not.exist;
    });

    test('results given number highlights does return expected array', function() {
      /* jscs:disable requireCamelCaseOrUpperCaseIdentifiers */
      var result = {
        highlight: {
          path1: ['<em>321</em>'],
          path2: ['<em>654</em>']
        },
        matched_queries: [
          'highlight1:path1',
          'highlight2:path2'
        ],
        _source: RESULT_1._source
      };
      var output = transformFunctions.transforms.entity.results({
        highlights: {
          number: {
            321: 'highlight1',
            654: 'highlight2'
          }
        },
        hits: {
          hits: [result]
        },
      }, SEARCH_FIELDS);
      /* jscs:enable requireCamelCaseOrUpperCaseIdentifiers */

      expect(output[0].detailExtractions[1].isDate).to.be.false;
      expect(output[0].detailExtractions[1].isUrl).to.be.false;
      expect(output[0].detailExtractions[1].key).to.equal('number');
      expect(output[0].detailExtractions[1].name).to.equal('Numbers');
      expect(output[0].detailExtractions[1].type).to.equal('number');
      expect(output[0].detailExtractions[1].data.length).to.equal(2);

      expect(output[0].detailExtractions[1].data[0].confidence).to.not.exist;
      expect(output[0].detailExtractions[1].data[0].count).to.not.exist;
      expect(output[0].detailExtractions[1].data[0].highlight).to.be.true;
      expect(output[0].detailExtractions[1].data[0].id).to.equal(321);
      expect(output[0].detailExtractions[1].data[0].icon).to.equal('numberIcon');
      expect(output[0].detailExtractions[1].data[0].link).to.not.exist;
      expect(output[0].detailExtractions[1].data[0].provenances.length).to.equal(0);
      expect(output[0].detailExtractions[1].data[0].styleClass).to.equal('numberStyle');
      expect(output[0].detailExtractions[1].data[0].text).to.equal(321);
      expect(output[0].detailExtractions[1].data[0].type).to.equal('number');
      expect(output[0].detailExtractions[1].data[0].width).to.not.exist;

      expect(output[0].detailExtractions[1].data[1].confidence).to.not.exist;
      expect(output[0].detailExtractions[1].data[1].count).to.not.exist;
      expect(output[0].detailExtractions[1].data[1].highlight).to.be.true;
      expect(output[0].detailExtractions[1].data[1].id).to.equal(654);
      expect(output[0].detailExtractions[1].data[1].icon).to.equal('numberIcon');
      expect(output[0].detailExtractions[1].data[1].link).to.not.exist;
      expect(output[0].detailExtractions[1].data[1].provenances.length).to.equal(0);
      expect(output[0].detailExtractions[1].data[1].styleClass).to.equal('numberStyle');
      expect(output[0].detailExtractions[1].data[1].text).to.equal(654);
      expect(output[0].detailExtractions[1].data[1].type).to.equal('number');
      expect(output[0].detailExtractions[1].data[1].width).to.not.exist;
    });

    test('results given phone highlights does return expected array', function() {
      /* jscs:disable requireCamelCaseOrUpperCaseIdentifiers */
      var result = {
        highlight: {
          path1: ['<em>1112223333</em>'],
          path2: ['<em>444-555-6666</em>']
        },
        matched_queries: [
          'highlight1:path1',
          'highlight2:path2'
        ],
        _source: RESULT_1._source
      };
      var output = transformFunctions.transforms.entity.results({
        highlights: {
          phone: {
            1112223333: 'highlight1',
            '444-555-6666': 'highlight2'
          }
        },
        hits: {
          hits: [result]
        },
      }, SEARCH_FIELDS);
      /* jscs:enable requireCamelCaseOrUpperCaseIdentifiers */

      expect(output[0].detailExtractions[2].data[0].confidence).to.not.exist;
      expect(output[0].detailExtractions[2].data[0].count).to.not.exist;
      expect(output[0].detailExtractions[2].data[0].highlight).to.be.true;
      expect(output[0].detailExtractions[2].data[0].id).to.equal('1112223333');
      expect(output[0].detailExtractions[2].data[0].icon).to.equal('phoneIcon');
      expect(output[0].detailExtractions[2].data[0].link).to.equal('/entity.html?domain=TestDomain&id=1112223333&type=phone');
      expect(output[0].detailExtractions[2].data[0].provenances.length).to.equal(0);
      expect(output[0].detailExtractions[2].data[0].styleClass).to.equal('phoneStyle');
      expect(output[0].detailExtractions[2].data[0].text).to.equal('111-222-3333');
      expect(output[0].detailExtractions[2].data[0].type).to.equal('phone');
      expect(output[0].detailExtractions[2].data[0].width).to.not.exist;

      expect(output[0].detailExtractions[2].data[1].confidence).to.not.exist;
      expect(output[0].detailExtractions[2].data[1].count).to.not.exist;
      expect(output[0].detailExtractions[2].data[1].highlight).to.be.true;
      expect(output[0].detailExtractions[2].data[1].id).to.equal('4445556666');
      expect(output[0].detailExtractions[2].data[1].icon).to.equal('phoneIcon');
      expect(output[0].detailExtractions[2].data[1].link).to.equal('/entity.html?domain=TestDomain&id=4445556666&type=phone');
      expect(output[0].detailExtractions[2].data[1].provenances.length).to.equal(0);
      expect(output[0].detailExtractions[2].data[1].styleClass).to.equal('phoneStyle');
      expect(output[0].detailExtractions[2].data[1].text).to.equal('444-555-6666');
      expect(output[0].detailExtractions[2].data[1].type).to.equal('phone');
      expect(output[0].detailExtractions[2].data[1].width).to.not.exist;
    });

    test('results given hyphenated highlights does return expected array', function() {
      /* jscs:disable requireCamelCaseOrUpperCaseIdentifiers */
      var result = {
        highlight: {
          path1: ['time1 <em>price1</em> currency1'],
          path2: ['price2 <em>currency2</em>']
        },
        matched_queries: [
          'highlight1:path1',
          'highlight2:path2'
        ],
        _source: RESULT_1._source
      };
      var output = transformFunctions.transforms.entity.results({
        highlights: {
          price: {
            price1: 'highlight1',
            currency2: 'highlight2'
          }
        },
        hits: {
          hits: [result]
        },
      }, SEARCH_FIELDS);
      /* jscs:enable requireCamelCaseOrUpperCaseIdentifiers */

      expect(output[0].detailExtractions[3].data[0].confidence).to.not.exist;
      expect(output[0].detailExtractions[3].data[0].count).to.not.exist;
      expect(output[0].detailExtractions[3].data[0].highlight).to.be.true;
      expect(output[0].detailExtractions[3].data[0].id).to.equal('price1-currency:currency1-time_unit:time1');
      expect(output[0].detailExtractions[3].data[0].icon).to.equal('priceIcon');
      expect(output[0].detailExtractions[3].data[0].link).to.not.exist;
      expect(output[0].detailExtractions[3].data[0].provenances.length).to.equal(0);
      expect(output[0].detailExtractions[3].data[0].styleClass).to.equal('priceStyle');
      expect(output[0].detailExtractions[3].data[0].text).to.equal('price1 currency1 per time1 minutes');
      expect(output[0].detailExtractions[3].data[0].type).to.equal('price');
      expect(output[0].detailExtractions[3].data[0].width).to.not.exist;

      expect(output[0].detailExtractions[3].data[1].confidence).to.not.exist;
      expect(output[0].detailExtractions[3].data[1].count).to.not.exist;
      expect(output[0].detailExtractions[3].data[1].highlight).to.be.true;
      expect(output[0].detailExtractions[3].data[1].id).to.equal('price2-currency:currency2-time_unit:time2');
      expect(output[0].detailExtractions[3].data[1].icon).to.equal('priceIcon');
      expect(output[0].detailExtractions[3].data[1].link).to.not.exist;
      expect(output[0].detailExtractions[3].data[1].provenances.length).to.equal(0);
      expect(output[0].detailExtractions[3].data[1].styleClass).to.equal('priceStyle');
      expect(output[0].detailExtractions[3].data[1].text).to.equal('price2 currency2 per time2 minutes');
      expect(output[0].detailExtractions[3].data[1].type).to.equal('price');
      expect(output[0].detailExtractions[3].data[1].width).to.not.exist;
    });

    test('results given unnested highlights does return expected array', function() {
      // TODO
    });

    test('results given username highlights does return expected array', function() {
      /* jscs:disable requireCamelCaseOrUpperCaseIdentifiers */
      var result = {
        highlight: {
          path1: ['type1 <em>user1</em>'],
          path2: ['<em>type 2 user2</em>']
        },
        matched_queries: [
          'highlight1:path1',
          'highlight2:path2'
        ],
        _source: RESULT_1._source
      };
      var output = transformFunctions.transforms.entity.results({
        highlights: {
          user: {
            user1: 'highlight1',
            user2: 'highlight2'
          }
        },
        hits: {
          hits: [result]
        },
      }, SEARCH_FIELDS);
      /* jscs:enable requireCamelCaseOrUpperCaseIdentifiers */

      expect(output[0].detailExtractions[5].data[0].confidence).to.not.exist;
      expect(output[0].detailExtractions[5].data[0].count).to.not.exist;
      expect(output[0].detailExtractions[5].data[0].highlight).to.be.true;
      expect(output[0].detailExtractions[5].data[0].id).to.equal('type1 user1');
      expect(output[0].detailExtractions[5].data[0].icon).to.equal('userIcon');
      expect(output[0].detailExtractions[5].data[0].link).to.equal('/entity.html?domain=TestDomain&id=type1%20user1&type=user');
      expect(output[0].detailExtractions[5].data[0].provenances.length).to.equal(0);
      expect(output[0].detailExtractions[5].data[0].styleClass).to.equal('userStyle');
      expect(output[0].detailExtractions[5].data[0].text).to.equal('User1');
      expect(output[0].detailExtractions[5].data[0].type).to.equal('user');
      expect(output[0].detailExtractions[5].data[0].width).to.not.exist;

      expect(output[0].detailExtractions[5].data[1].confidence).to.not.exist;
      expect(output[0].detailExtractions[5].data[1].count).to.not.exist;
      expect(output[0].detailExtractions[5].data[1].highlight).to.be.true;
      expect(output[0].detailExtractions[5].data[1].id).to.equal('type2 user2');
      expect(output[0].detailExtractions[5].data[1].icon).to.equal('userIcon');
      expect(output[0].detailExtractions[5].data[1].link).to.equal('/entity.html?domain=TestDomain&id=type2%20user2&type=user');
      expect(output[0].detailExtractions[5].data[1].provenances.length).to.equal(0);
      expect(output[0].detailExtractions[5].data[1].styleClass).to.equal('userStyle');
      expect(output[0].detailExtractions[5].data[1].text).to.equal('User2');
      expect(output[0].detailExtractions[5].data[1].type).to.equal('user');
      expect(output[0].detailExtractions[5].data[1].width).to.not.exist;
    });

    test('results given url highlights does return expected array', function() {
      /* jscs:disable requireCamelCaseOrUpperCaseIdentifiers */
      var result = {
        highlight: {
          path1: ['<em>website1.com</em>'],
          path2: ['<em>website2.com</em>']
        },
        matched_queries: [
          'highlight1:path1',
          'highlight2:path2'
        ],
        _source: RESULT_1._source
      };
      var output = transformFunctions.transforms.entity.results({
        highlights: {
          website: {
            'website1.com': 'highlight1',
            website2: 'highlight2'
          }
        },
        hits: {
          hits: [result]
        },
      }, SEARCH_FIELDS);
      /* jscs:enable requireCamelCaseOrUpperCaseIdentifiers */

      expect(output[0].headerExtractions[0].data[0].confidence).to.not.exist;
      expect(output[0].headerExtractions[0].data[0].count).to.not.exist;
      expect(output[0].headerExtractions[0].data[0].highlight).to.be.true;
      expect(output[0].headerExtractions[0].data[0].id).to.equal('website1.com');
      expect(output[0].headerExtractions[0].data[0].icon).to.equal('websiteIcon');
      expect(output[0].headerExtractions[0].data[0].link).to.not.exist;
      expect(output[0].headerExtractions[0].data[0].provenances.length).to.equal(0);
      expect(output[0].headerExtractions[0].data[0].styleClass).to.equal('websiteStyle');
      expect(output[0].headerExtractions[0].data[0].text).to.equal('website1.com');
      expect(output[0].headerExtractions[0].data[0].type).to.equal('website');
      expect(output[0].headerExtractions[0].data[0].width).to.not.exist;

      expect(output[0].headerExtractions[0].data[1].confidence).to.not.exist;
      expect(output[0].headerExtractions[0].data[1].count).to.not.exist;
      expect(output[0].headerExtractions[0].data[1].highlight).to.be.true;
      expect(output[0].headerExtractions[0].data[1].id).to.equal('website2.com');
      expect(output[0].headerExtractions[0].data[1].icon).to.equal('websiteIcon');
      expect(output[0].headerExtractions[0].data[1].link).to.not.exist;
      expect(output[0].headerExtractions[0].data[1].provenances.length).to.equal(0);
      expect(output[0].headerExtractions[0].data[1].styleClass).to.equal('websiteStyle');
      expect(output[0].headerExtractions[0].data[1].text).to.equal('website2.com');
      expect(output[0].headerExtractions[0].data[1].type).to.equal('website');
      expect(output[0].headerExtractions[0].data[1].width).to.not.exist;
    });

    test('results given incorrectly formatted highlights does return expected array', function() {
      /* jscs:disable requireCamelCaseOrUpperCaseIdentifiers */
      var result = {
        highlight: {
          path1: ['<em>city1</em>, state1, country1'],
          path2: ['city2, <em>state2</em>, country2'],
          path3: ['<em>email1</em>@address1.com'],
          path4: ['email2<em>@address1.com</em>'],
          path5: ['<em>111</em> 222 3333'],
          path6: ['<em>type1</em> user1'],
          path7: ['<em>website1</em>.com'],
          path8: ['website2.<em>com</em>']
        },
        matched_queries: [
          'highlight1:path1',
          'highlight2:path2',
          'highlight3:path3',
          'highlight4:path4',
          'highlight5:path5',
          'highlight6:path6',
          'highlight7:path7',
          'highlight8:path8'
        ],
        _source: RESULT_1._source
      };
      var output = transformFunctions.transforms.entity.results({
        highlights: {
          city: {
            'city1:state1:country1:1:11': 'highlight1',
            state2: 'highlight2'
          },
          email: {
            email1: 'highlight3',
            address2: 'highlight4'
          },
          phone: {
            111: 'highlight5'
          },
          user: {
            type1: 'highlight6'
          },
          website: {
            website1: 'highlight7',
            com: 'highlight8'
          }
        },
        hits: {
          hits: [result]
        },
      }, SEARCH_FIELDS);
      /* jscs:enable requireCamelCaseOrUpperCaseIdentifiers */

      expect(output[0].headerExtractions[0].data[0].highlight).to.be.false;
      expect(output[0].headerExtractions[0].data[1].highlight).to.be.false;
      expect(output[0].headerExtractions[2].data[0].highlight).to.be.false;
      expect(output[0].headerExtractions[2].data[1].highlight).to.be.false;
      expect(output[0].detailExtractions[0].data[0].highlight).to.be.false;
      expect(output[0].detailExtractions[0].data[1].highlight).to.be.false;
      expect(output[0].detailExtractions[1].data[0].highlight).to.be.false;
      expect(output[0].detailExtractions[3].data[0].highlight).to.be.false;
    });

    test('results does use content_extraction.title for title highlights', function() {
      /* jscs:disable requireCamelCaseOrUpperCaseIdentifiers */
      var result = {
        highlight: {
          'content_extraction.title.text': ['<em>Title</em> 1 <em>Title 2</em>']
        },
        _source: RESULT_1._source
      };
      var output = transformFunctions.transforms.entity.results({
        hits: {
          hits: [result]
        },
      }, SEARCH_FIELDS);
      /* jscs:enable requireCamelCaseOrUpperCaseIdentifiers */

      expect(output[0].title).to.equal('Title 1 Title 2');
      expect(output[0].highlightedText).to.equal('<em>Title</em> 1 <em>Title 2</em>');
    });

    test('results does use content_extraction.content_strict for description highlights', function() {
      /* jscs:enable requireCamelCaseOrUpperCaseIdentifiers */
      var result = {
        highlight: {
          'content_extraction.content_strict.text': ['This is <em>description</em> 1 <em>This is description 2</em>']
        },
        _source: RESULT_1._source
      };
      var output = transformFunctions.transforms.entity.results({
        hits: {
          hits: [result]
        },
      }, SEARCH_FIELDS);
      /* jscs:enable requireCamelCaseOrUpperCaseIdentifiers */

      expect(output[0].description).to.equal('This is description 1 This is description 2');
      expect(output[0].details[1].name).to.equal('Description');
      expect(output[0].details[1].highlightedText).to.equal('This is <em>description</em> 1 <em>This is description 2</em>');
      expect(output[0].details[1].text).to.equal('This is description 1 This is description 2');
    });

    test('results given time series data does return expected array', function() {
      // TODO
    });

    test('searchPageTimeline given incomplete data does return expected object with no sparklines', function() {
      expect(transformFunctions.transforms.entity.searchPageTimeline(null, {
        name: 'testProperty'
      })).to.deep.equal({
        sparklines: []
      });

      expect(transformFunctions.transforms.entity.searchPageTimeline({}, {
        name: 'testProperty'
      })).to.deep.equal({
        sparklines: []
      });

      expect(transformFunctions.transforms.entity.searchPageTimeline({
        aggregations: {}
      }, {
        name: 'testProperty'
      })).to.deep.equal({
        sparklines: []
      });

      expect(transformFunctions.transforms.entity.searchPageTimeline({
        aggregations: {
          testProperty: {}
        }
      }, {
        name: 'testProperty'
      })).to.deep.equal({
        sparklines: []
      });

      expect(transformFunctions.transforms.entity.searchPageTimeline({
        aggregations: {
          testProperty: {
            buckets: []
          }
        }
      }, {
        name: 'testProperty'
      })).to.deep.equal({
        sparklines: []
      });

      expect(transformFunctions.transforms.entity.searchPageTimeline({
        aggregations: {
          testProperty: {
            testProperty: {
              buckets: []
            }
          }
        }
      }, {
        name: 'testProperty'
      })).to.deep.equal({
        sparklines: []
      });
    });

    test('searchPageTimeline given aggregations with single bucket does return expected object with no sparklines', function() {
      /* jscs:disable requireCamelCaseOrUpperCaseIdentifiers */
      expect(transformFunctions.transforms.entity.searchPageTimeline({
        aggregations: {
          testProperty: {
            buckets: [{
              doc_count: 11111,
              key: 1514764800000,
              key_as_string: '2018-01-01T00:00:00'
            }]
          }
        }
      }, {
        name: 'testProperty'
      })).to.deep.equal({
        sparklines: []
      });
      /* jscs:enable requireCamelCaseOrUpperCaseIdentifiers */
    });

    test('searchPageTimeline given aggregations with many buckets does return expected object with one sparkline', function() {
      /* jscs:disable requireCamelCaseOrUpperCaseIdentifiers */
      var output = transformFunctions.transforms.entity.searchPageTimeline({
        aggregations: {
          testProperty: {
            buckets: [{
              doc_count: 11111,
              key: 1514764800000,
              key_as_string: '2018-01-01T00:00:00'
            }, {
              doc_count: 2222,
              key: 1514851200000,
              key_as_string: '2018-01-02T00:00:00'
            }, {
              doc_count: 333,
              key: 1514937600000,
              key_as_string: '2018-01-03T00:00:00'
            }, {
              doc_count: 44,
              key: 1515024000000,
              key_as_string: '2018-01-04T00:00:00'
            }, {
              doc_count: 5,
              key: 1515110400000,
              key_as_string: '2018-01-05T00:00:00'
            }]
          }
        }
      }, {
        name: 'testProperty'
      });
      /* jscs:enable requireCamelCaseOrUpperCaseIdentifiers */

      expect(output.begin).to.equal('Jan 1, 2018');
      expect(output.end).to.equal('Jan 5, 2018');
      expect(output.sparklines.length).to.equal(1);
      expect(output.sparklines[0].icon).to.not.exist;
      expect(output.sparklines[0].styleClass).to.not.exist;
      expect(output.sparklines[0].name).to.equal('(Unidentified)');
      expect(output.sparklines[0].points.length).to.equal(5);
      expect(output.sparklines[0].points[0].count).to.equal(11111);
      expect(output.sparklines[0].points[0].date).to.equal('Jan 1, 2018');
      expect(output.sparklines[0].points[1].count).to.equal(2222);
      expect(output.sparklines[0].points[1].date).to.equal('Jan 2, 2018');
      expect(output.sparklines[0].points[2].count).to.equal(333);
      expect(output.sparklines[0].points[2].date).to.equal('Jan 3, 2018');
      expect(output.sparklines[0].points[3].count).to.equal(44);
      expect(output.sparklines[0].points[3].date).to.equal('Jan 4, 2018');
      expect(output.sparklines[0].points[4].count).to.equal(5);
      expect(output.sparklines[0].points[4].date).to.equal('Jan 5, 2018');
    });

    test('searchPageTimeline given aggregations with nested format does return expected object with one sparkline', function() {
      /* jscs:disable requireCamelCaseOrUpperCaseIdentifiers */
      var output = transformFunctions.transforms.entity.searchPageTimeline({
        aggregations: {
          testProperty: {
            testProperty: {
              buckets: [{
                doc_count: 11111,
                key: 1514764800000,
                key_as_string: '2018-01-01T00:00:00'
              }, {
                doc_count: 2222,
                key: 1514851200000,
                key_as_string: '2018-01-02T00:00:00'
              }]
            }
          }
        }
      }, {
        name: 'testProperty'
      });
      /* jscs:enable requireCamelCaseOrUpperCaseIdentifiers */

      expect(output.begin).to.equal('Jan 1, 2018');
      expect(output.end).to.equal('Jan 2, 2018');
      expect(output.sparklines.length).to.equal(1);
      expect(output.sparklines[0].icon).to.not.exist;
      expect(output.sparklines[0].styleClass).to.not.exist;
      expect(output.sparklines[0].name).to.equal('(Unidentified)');
      expect(output.sparklines[0].points.length).to.equal(2);
      expect(output.sparklines[0].points[0].count).to.equal(11111);
      expect(output.sparklines[0].points[0].date).to.equal('Jan 1, 2018');
      expect(output.sparklines[0].points[1].count).to.equal(2222);
      expect(output.sparklines[0].points[1].date).to.equal('Jan 2, 2018');
    });

    test('timelines given incomplete data does return expected object with no timelines', function() {
      expect(transformFunctions.transforms.entity.timelines(null, {
        name: 'testProperty'
      })).to.deep.equal({
        histogram: [],
        sparklines: []
      });

      expect(transformFunctions.transforms.entity.timelines({}, {
        name: 'testProperty'
      })).to.deep.equal({
        histogram: [],
        sparklines: []
      });

      expect(transformFunctions.transforms.entity.timelines({
        aggregations: {}
      }, {
        name: 'testProperty'
      })).to.deep.equal({
        histogram: [],
        sparklines: []
      });

      expect(transformFunctions.transforms.entity.timelines({
        aggregations: {
          testProperty: {}
        }
      }, {
        name: 'testProperty'
      })).to.deep.equal({
        histogram: [],
        sparklines: []
      });

      expect(transformFunctions.transforms.entity.timelines({
        aggregations: {
          testProperty: {
            buckets: []
          }
        }
      }, {
        name: 'testProperty'
      })).to.deep.equal({
        histogram: [],
        sparklines: []
      });

      expect(transformFunctions.transforms.entity.timelines({
        aggregations: {
          testProperty: {
            testProperty: {
              buckets: []
            }
          }
        }
      }, {
        name: 'testProperty'
      })).to.deep.equal({
        histogram: [],
        sparklines: []
      });
    });

    test('timelines given aggregations with single bucket does return expected object with no timelines', function() {
      /* jscs:disable requireCamelCaseOrUpperCaseIdentifiers */
      expect(transformFunctions.transforms.entity.timelines({
        aggregations: {
          testProperty: {
            buckets: [{
              doc_count: 11111,
              key: 1514764800000,
              key_as_string: '2018-01-01T00:00:00'
            }]
          }
        }
      }, {
        name: 'testProperty'
      })).to.deep.equal({
        histogram: [],
        sparklines: []
      });
      /* jscs:enable requireCamelCaseOrUpperCaseIdentifiers */
    });

    test('timelines given aggregations with many buckets and no entity config does return expected object with histogram but no sparklines', function() {
      /* jscs:disable requireCamelCaseOrUpperCaseIdentifiers */
      var output = transformFunctions.transforms.entity.timelines({
        aggregations: {
          testProperty: {
            buckets: [{
              doc_count: 11111,
              key: 1514764800000,
              key_as_string: '2018-01-01T00:00:00'
            }, {
              doc_count: 2222,
              key: 1514851200000,
              key_as_string: '2018-01-02T00:00:00'
            }, {
              doc_count: 333,
              key: 1514937600000,
              key_as_string: '2018-01-03T00:00:00'
            }, {
              doc_count: 44,
              key: 1515024000000,
              key_as_string: '2018-01-04T00:00:00'
            }, {
              doc_count: 5,
              key: 1515110400000,
              key_as_string: '2018-01-05T00:00:00'
            }]
          }
        }
      }, {
        name: 'testProperty'
      });
      /* jscs:enable requireCamelCaseOrUpperCaseIdentifiers */

      expect(output.begin).to.equal('Jan 1, 2018');
      expect(output.end).to.equal('Jan 5, 2018');
      expect(output.histogram.length).to.equal(5);
      expect(output.sparklines.length).to.equal(0);

      expect(output.histogram[0].date).to.equal('Jan 1, 2018');
      expect(output.histogram[0].data.length).to.equal(1);
      expect(output.histogram[0].data[0].count).to.equal(11111);
      expect(output.histogram[0].data[0].icon).to.not.exist;
      expect(output.histogram[0].data[0].styleClass).to.not.exist;
      expect(output.histogram[0].data[0].text).to.equal('(Unidentified)');
      expect(output.histogram[0].data[0].textAndCount).to.equal('(Unidentified) (11,111)');
      expect(output.histogram[1].date).to.equal('Jan 2, 2018');
      expect(output.histogram[1].data.length).to.equal(1);
      expect(output.histogram[1].data[0].count).to.equal(2222);
      expect(output.histogram[1].data[0].icon).to.not.exist;
      expect(output.histogram[1].data[0].styleClass).to.not.exist;
      expect(output.histogram[1].data[0].text).to.equal('(Unidentified)');
      expect(output.histogram[1].data[0].textAndCount).to.equal('(Unidentified) (2,222)');
      expect(output.histogram[2].date).to.equal('Jan 3, 2018');
      expect(output.histogram[2].data.length).to.equal(1);
      expect(output.histogram[2].data[0].count).to.equal(333);
      expect(output.histogram[2].data[0].icon).to.not.exist;
      expect(output.histogram[2].data[0].styleClass).to.not.exist;
      expect(output.histogram[2].data[0].text).to.equal('(Unidentified)');
      expect(output.histogram[2].data[0].textAndCount).to.equal('(Unidentified) (333)');
      expect(output.histogram[3].date).to.equal('Jan 4, 2018');
      expect(output.histogram[3].data.length).to.equal(1);
      expect(output.histogram[3].data[0].count).to.equal(44);
      expect(output.histogram[3].data[0].icon).to.not.exist;
      expect(output.histogram[3].data[0].styleClass).to.not.exist;
      expect(output.histogram[3].data[0].text).to.equal('(Unidentified)');
      expect(output.histogram[3].data[0].textAndCount).to.equal('(Unidentified) (44)');
      expect(output.histogram[4].date).to.equal('Jan 5, 2018');
      expect(output.histogram[4].data.length).to.equal(1);
      expect(output.histogram[4].data[0].count).to.equal(5);
      expect(output.histogram[4].data[0].icon).to.not.exist;
      expect(output.histogram[4].data[0].styleClass).to.not.exist;
      expect(output.histogram[4].data[0].text).to.equal('(Unidentified)');
      expect(output.histogram[4].data[0].textAndCount).to.equal('(Unidentified) (5)');
    });

    test('timelines given aggregations with many buckets and entity config does return expected object with histogram and sparklines', function() {
      /* jscs:disable requireCamelCaseOrUpperCaseIdentifiers */
      var output = transformFunctions.transforms.entity.timelines({
        aggregations: {
          testProperty: {
            buckets: [{
              doc_count: 11111,
              key: 1514764800000,
              key_as_string: '2018-01-01T00:00:00',
              testEntity: {
                buckets: [{
                  doc_count: 10000,
                  key: 'entity1'
                }, {
                  doc_count: 1000,
                  key: 'entity2'
                }, {
                  doc_count: 100,
                  key: 'entity3'
                }, {
                  doc_count: 10,
                  key: 'entity4'
                }]
              }
            }, {
              doc_count: 2222,
              key: 1514851200000,
              key_as_string: '2018-01-02T00:00:00',
              testEntity: {
                buckets: [{
                  doc_count: 2000,
                  key: 'entity1'
                }, {
                  doc_count: 200,
                  key: 'entity2'
                }, {
                  doc_count: 20,
                  key: 'entity3'
                }]
              }
            }, {
              doc_count: 333,
              key: 1514937600000,
              key_as_string: '2018-01-03T00:00:00',
              testEntity: {
                buckets: [{
                  doc_count: 300,
                  key: 'entity1'
                }, {
                  doc_count: 30,
                  key: 'entity2'
                }, {
                  doc_count: 3,
                  key: 'entity5'
                }]
              }
            }, {
              doc_count: 44,
              key: 1515024000000,
              key_as_string: '2018-01-04T00:00:00',
              testEntity: {
                buckets: [{
                  doc_count: 40,
                  key: 'entity1'
                }]
              }
            }, {
              doc_count: 5,
              key: 1515110400000,
              key_as_string: '2018-01-05T00:00:00',
              testEntity: {
                buckets: [{
                  doc_count: 5,
                  key: 'entity1'
                }]
              }
            }]
          }
        }
      }, {
        entity: {
          key: 'testEntity',
          icon: 'entityIcon',
          styleClass: 'entityStyleClass',
          type: 'string'
        },
        name: 'testProperty'
      });
      /* jscs:enable requireCamelCaseOrUpperCaseIdentifiers */

      expect(output.begin).to.equal('Jan 1, 2018');
      expect(output.end).to.equal('Jan 5, 2018');
      expect(output.histogram.length).to.equal(5);
      expect(output.sparklines.length).to.equal(3);

      expect(output.histogram[0].date).to.equal('Jan 1, 2018');
      expect(output.histogram[0].data.length).to.equal(5);
      expect(output.histogram[0].data[0].count).to.equal(10000);
      expect(output.histogram[0].data[0].icon).to.equal('entityIcon');
      expect(output.histogram[0].data[0].styleClass).to.equal('entityStyleClass');
      expect(output.histogram[0].data[0].text).to.equal('entity1');
      expect(output.histogram[0].data[0].textAndCount).to.equal('entity1 (10,000)');
      expect(output.histogram[0].data[1].count).to.equal(1000);
      expect(output.histogram[0].data[1].icon).to.equal('entityIcon');
      expect(output.histogram[0].data[1].styleClass).to.equal('entityStyleClass');
      expect(output.histogram[0].data[1].text).to.equal('entity2');
      expect(output.histogram[0].data[1].textAndCount).to.equal('entity2 (1,000)');
      expect(output.histogram[0].data[2].count).to.equal(100);
      expect(output.histogram[0].data[2].icon).to.equal('entityIcon');
      expect(output.histogram[0].data[2].styleClass).to.equal('entityStyleClass');
      expect(output.histogram[0].data[2].text).to.equal('entity3');
      expect(output.histogram[0].data[2].textAndCount).to.equal('entity3 (100)');
      expect(output.histogram[0].data[3].count).to.equal(10);
      expect(output.histogram[0].data[3].icon).to.equal('entityIcon');
      expect(output.histogram[0].data[3].styleClass).to.equal('entityStyleClass');
      expect(output.histogram[0].data[3].text).to.equal('entity4');
      expect(output.histogram[0].data[3].textAndCount).to.equal('entity4 (10)');
      expect(output.histogram[0].data[4].count).to.equal(1);
      expect(output.histogram[0].data[4].icon).to.equal('entityIcon');
      expect(output.histogram[0].data[4].styleClass).to.equal('entityStyleClass');
      expect(output.histogram[0].data[4].text).to.equal('(Unidentified)');
      expect(output.histogram[0].data[4].textAndCount).to.equal('(Unidentified) (1)');

      expect(output.histogram[1].date).to.equal('Jan 2, 2018');
      expect(output.histogram[1].data.length).to.equal(4);
      expect(output.histogram[1].data[0].count).to.equal(2000);
      expect(output.histogram[1].data[0].icon).to.equal('entityIcon');
      expect(output.histogram[1].data[0].styleClass).to.equal('entityStyleClass');
      expect(output.histogram[1].data[0].text).to.equal('entity1');
      expect(output.histogram[1].data[0].textAndCount).to.equal('entity1 (2,000)');
      expect(output.histogram[1].data[1].count).to.equal(200);
      expect(output.histogram[1].data[1].icon).to.equal('entityIcon');
      expect(output.histogram[1].data[1].styleClass).to.equal('entityStyleClass');
      expect(output.histogram[1].data[1].text).to.equal('entity2');
      expect(output.histogram[1].data[1].textAndCount).to.equal('entity2 (200)');
      expect(output.histogram[1].data[2].count).to.equal(20);
      expect(output.histogram[1].data[2].icon).to.equal('entityIcon');
      expect(output.histogram[1].data[2].styleClass).to.equal('entityStyleClass');
      expect(output.histogram[1].data[2].text).to.equal('entity3');
      expect(output.histogram[1].data[2].textAndCount).to.equal('entity3 (20)');
      expect(output.histogram[1].data[3].count).to.equal(2);
      expect(output.histogram[1].data[3].icon).to.equal('entityIcon');
      expect(output.histogram[1].data[3].styleClass).to.equal('entityStyleClass');
      expect(output.histogram[1].data[3].text).to.equal('(Unidentified)');
      expect(output.histogram[1].data[3].textAndCount).to.equal('(Unidentified) (2)');

      expect(output.histogram[2].date).to.equal('Jan 3, 2018');
      expect(output.histogram[2].data.length).to.equal(3);
      expect(output.histogram[2].data[0].count).to.equal(300);
      expect(output.histogram[2].data[0].icon).to.equal('entityIcon');
      expect(output.histogram[2].data[0].styleClass).to.equal('entityStyleClass');
      expect(output.histogram[2].data[0].text).to.equal('entity1');
      expect(output.histogram[2].data[0].textAndCount).to.equal('entity1 (300)');
      expect(output.histogram[2].data[1].count).to.equal(30);
      expect(output.histogram[2].data[1].icon).to.equal('entityIcon');
      expect(output.histogram[2].data[1].styleClass).to.equal('entityStyleClass');
      expect(output.histogram[2].data[1].text).to.equal('entity2');
      expect(output.histogram[2].data[1].textAndCount).to.equal('entity2 (30)');
      expect(output.histogram[2].data[2].count).to.equal(3);
      expect(output.histogram[2].data[2].icon).to.equal('entityIcon');
      expect(output.histogram[2].data[2].styleClass).to.equal('entityStyleClass');
      expect(output.histogram[2].data[2].text).to.equal('entity5');
      expect(output.histogram[2].data[2].textAndCount).to.equal('entity5 (3)');

      expect(output.histogram[3].date).to.equal('Jan 4, 2018');
      expect(output.histogram[3].data.length).to.equal(2);
      expect(output.histogram[3].data[0].count).to.equal(40);
      expect(output.histogram[3].data[0].icon).to.equal('entityIcon');
      expect(output.histogram[3].data[0].styleClass).to.equal('entityStyleClass');
      expect(output.histogram[3].data[0].text).to.equal('entity1');
      expect(output.histogram[3].data[0].textAndCount).to.equal('entity1 (40)');
      expect(output.histogram[3].data[1].count).to.equal(4);
      expect(output.histogram[3].data[1].icon).to.equal('entityIcon');
      expect(output.histogram[3].data[1].styleClass).to.equal('entityStyleClass');
      expect(output.histogram[3].data[1].text).to.equal('(Unidentified)');
      expect(output.histogram[3].data[1].textAndCount).to.equal('(Unidentified) (4)');

      expect(output.histogram[4].date).to.equal('Jan 5, 2018');
      expect(output.histogram[4].data.length).to.equal(1);
      expect(output.histogram[4].data[0].count).to.equal(5);
      expect(output.histogram[4].data[0].icon).to.equal('entityIcon');
      expect(output.histogram[4].data[0].styleClass).to.equal('entityStyleClass');
      expect(output.histogram[4].data[0].text).to.equal('entity1');
      expect(output.histogram[4].data[0].textAndCount).to.equal('entity1 (5)');

      expect(output.sparklines[0].icon).to.equal('entityIcon');
      expect(output.sparklines[0].name).to.equal('entity1');
      expect(output.sparklines[0].styleClass).to.equal('entityStyleClass');
      expect(output.sparklines[0].points.length).to.equal(5);
      expect(output.sparklines[0].points[0].count).to.equal(10000);
      expect(output.sparklines[0].points[0].date).to.equal('Jan 1, 2018');
      expect(output.sparklines[0].points[1].count).to.equal(2000);
      expect(output.sparklines[0].points[1].date).to.equal('Jan 2, 2018');
      expect(output.sparklines[0].points[2].count).to.equal(300);
      expect(output.sparklines[0].points[2].date).to.equal('Jan 3, 2018');
      expect(output.sparklines[0].points[3].count).to.equal(40);
      expect(output.sparklines[0].points[3].date).to.equal('Jan 4, 2018');
      expect(output.sparklines[0].points[4].count).to.equal(5);
      expect(output.sparklines[0].points[4].date).to.equal('Jan 5, 2018');

      expect(output.sparklines[1].icon).to.equal('entityIcon');
      expect(output.sparklines[1].name).to.equal('entity2');
      expect(output.sparklines[1].styleClass).to.equal('entityStyleClass');
      expect(output.sparklines[1].points.length).to.equal(3);
      expect(output.sparklines[1].points[0].count).to.equal(1000);
      expect(output.sparklines[1].points[0].date).to.equal('Jan 1, 2018');
      expect(output.sparklines[1].points[1].count).to.equal(200);
      expect(output.sparklines[1].points[1].date).to.equal('Jan 2, 2018');
      expect(output.sparklines[1].points[2].count).to.equal(30);
      expect(output.sparklines[1].points[2].date).to.equal('Jan 3, 2018');

      expect(output.sparklines[2].icon).to.equal('entityIcon');
      expect(output.sparklines[2].name).to.equal('entity3');
      expect(output.sparklines[2].styleClass).to.equal('entityStyleClass');
      expect(output.sparklines[2].points.length).to.equal(2);
      expect(output.sparklines[2].points[0].count).to.equal(100);
      expect(output.sparklines[2].points[0].date).to.equal('Jan 1, 2018');
      expect(output.sparklines[2].points[1].count).to.equal(20);
      expect(output.sparklines[2].points[1].date).to.equal('Jan 2, 2018');
    });

    test('timelines does work with empty buckets', function() {
      /* jscs:disable requireCamelCaseOrUpperCaseIdentifiers */
      var output = transformFunctions.transforms.entity.timelines({
        aggregations: {
          testProperty: {
            buckets: [{
              doc_count: 1234,
              key: 1514764800000,
              key_as_string: '2018-01-01T00:00:00',
              testEntity: {
                buckets: [{
                  doc_count: 1234,
                  key: 'entity1'
                }]
              }
            }, {
              doc_count: 0,
              key: 1514851200000,
              key_as_string: '2018-01-02T00:00:00',
              testEntity: {
                buckets: []
              }
            }, {
              doc_count: 5678,
              key: 1514937600000,
              key_as_string: '2018-01-03T00:00:00',
              testEntity: {
                buckets: [{
                  doc_count: 5678,
                  key: 'entity1'
                }]
              }
            }]
          }
        }
      }, {
        entity: {
          key: 'testEntity',
          icon: 'entityIcon',
          styleClass: 'entityStyleClass',
          type: 'string'
        },
        name: 'testProperty'
      });
      /* jscs:enable requireCamelCaseOrUpperCaseIdentifiers */

      expect(output.begin).to.equal('Jan 1, 2018');
      expect(output.end).to.equal('Jan 3, 2018');
      expect(output.histogram.length).to.equal(2);
      expect(output.sparklines.length).to.equal(1);

      expect(output.histogram[0].date).to.equal('Jan 1, 2018');
      expect(output.histogram[0].data.length).to.equal(1);
      expect(output.histogram[0].data[0].count).to.equal(1234);
      expect(output.histogram[0].data[0].icon).to.equal('entityIcon');
      expect(output.histogram[0].data[0].styleClass).to.equal('entityStyleClass');
      expect(output.histogram[0].data[0].text).to.equal('entity1');
      expect(output.histogram[0].data[0].textAndCount).to.equal('entity1 (1,234)');

      expect(output.histogram[1].date).to.equal('Jan 3, 2018');
      expect(output.histogram[1].data.length).to.equal(1);
      expect(output.histogram[1].data[0].count).to.equal(5678);
      expect(output.histogram[1].data[0].icon).to.equal('entityIcon');
      expect(output.histogram[1].data[0].styleClass).to.equal('entityStyleClass');
      expect(output.histogram[1].data[0].text).to.equal('entity1');
      expect(output.histogram[1].data[0].textAndCount).to.equal('entity1 (5,678)');

      expect(output.sparklines[0].icon).to.equal('entityIcon');
      expect(output.sparklines[0].name).to.equal('entity1');
      expect(output.sparklines[0].styleClass).to.equal('entityStyleClass');
      expect(output.sparklines[0].points.length).to.equal(2);
      expect(output.sparklines[0].points[0].count).to.equal(1234);
      expect(output.sparklines[0].points[0].date).to.equal('Jan 1, 2018');
      expect(output.sparklines[0].points[1].count).to.equal(5678);
      expect(output.sparklines[0].points[1].date).to.equal('Jan 3, 2018');
    });

    test('timelines does create unidentified timelines', function() {
      /* jscs:disable requireCamelCaseOrUpperCaseIdentifiers */
      var output = transformFunctions.transforms.entity.timelines({
        aggregations: {
          testProperty: {
            buckets: [{
              doc_count: 50,
              key: 1514764800000,
              key_as_string: '2018-01-01T00:00:00',
              testEntity: {
                buckets: [{
                  doc_count: 30,
                  key: 'entity1'
                }]
              }
            }, {
              doc_count: 10,
              key: 1514851200000,
              key_as_string: '2018-01-02T00:00:00',
              testEntity: {
                buckets: []
              }
            }]
          }
        }
      }, {
        entity: {
          key: 'testEntity',
          icon: 'entityIcon',
          styleClass: 'entityStyleClass',
          type: 'string'
        },
        name: 'testProperty'
      });
      /* jscs:enable requireCamelCaseOrUpperCaseIdentifiers */

      expect(output.begin).to.equal('Jan 1, 2018');
      expect(output.end).to.equal('Jan 2, 2018');
      expect(output.histogram.length).to.equal(2);
      expect(output.sparklines.length).to.equal(0);

      expect(output.histogram[0].date).to.equal('Jan 1, 2018');
      expect(output.histogram[0].data.length).to.equal(2);
      expect(output.histogram[0].data[0].count).to.equal(30);
      expect(output.histogram[0].data[0].icon).to.equal('entityIcon');
      expect(output.histogram[0].data[0].styleClass).to.equal('entityStyleClass');
      expect(output.histogram[0].data[0].text).to.equal('entity1');
      expect(output.histogram[0].data[0].textAndCount).to.equal('entity1 (30)');
      expect(output.histogram[0].data[1].count).to.equal(20);
      expect(output.histogram[0].data[1].icon).to.equal('entityIcon');
      expect(output.histogram[0].data[1].styleClass).to.equal('entityStyleClass');
      expect(output.histogram[0].data[1].text).to.equal('(Unidentified)');
      expect(output.histogram[0].data[1].textAndCount).to.equal('(Unidentified) (20)');

      expect(output.histogram[1].date).to.equal('Jan 2, 2018');
      expect(output.histogram[1].data.length).to.equal(1);
      expect(output.histogram[1].data[0].count).to.equal(10);
      expect(output.histogram[1].data[0].icon).to.equal('entityIcon');
      expect(output.histogram[1].data[0].styleClass).to.equal('entityStyleClass');
      expect(output.histogram[1].data[0].text).to.equal('(Unidentified)');
      expect(output.histogram[1].data[0].textAndCount).to.equal('(Unidentified) (10)');
    });

    test('timelines does sort sparklines by max count then alphabetically', function() {
      /* jscs:disable requireCamelCaseOrUpperCaseIdentifiers */
      var output = transformFunctions.transforms.entity.timelines({
        aggregations: {
          testProperty: {
            buckets: [{
              doc_count: 10,
              key: 1514764800000,
              key_as_string: '2018-01-01T00:00:00',
              testEntity: {
                buckets: [{
                  doc_count: 10,
                  key: 'entity3'
                }]
              }
            }, {
              doc_count: 10,
              key: 1514851200000,
              key_as_string: '2018-01-02T00:00:00',
              testEntity: {
                buckets: [{
                  doc_count: 10,
                  key: 'entity1'
                }]
              }
            }, {
              doc_count: 40,
              key: 1514937600000,
              key_as_string: '2018-01-03T00:00:00',
              testEntity: {
                buckets: [{
                  doc_count: 40,
                  key: 'entity4'
                }]
              }
            }, {
              doc_count: 20,
              key: 1515024000000,
              key_as_string: '2018-01-04T00:00:00',
              testEntity: {
                buckets: [{
                  doc_count: 20,
                  key: 'entity2'
                }]
              }
            }, {
              doc_count: 10,
              key: 1515110400000,
              key_as_string: '2018-01-05T00:00:00',
              testEntity: {
                buckets: [{
                  doc_count: 4,
                  key: 'entity4'
                }, {
                  doc_count: 3,
                  key: 'entity3'
                }, {
                  doc_count: 2,
                  key: 'entity2'
                }, {
                  doc_count: 1,
                  key: 'entity1'
                }]
              }
            }]
          }
        }
      }, {
        entity: {
          key: 'testEntity',
          icon: 'entityIcon',
          styleClass: 'entityStyleClass',
          type: 'string'
        },
        name: 'testProperty'
      });
      /* jscs:enable requireCamelCaseOrUpperCaseIdentifiers */

      expect(output.sparklines.length).to.equal(4);

      expect(output.sparklines[0].icon).to.equal('entityIcon');
      expect(output.sparklines[0].name).to.equal('entity4');
      expect(output.sparklines[0].styleClass).to.equal('entityStyleClass');
      expect(output.sparklines[0].points.length).to.equal(2);
      expect(output.sparklines[0].points[0].count).to.equal(40);
      expect(output.sparklines[0].points[0].date).to.equal('Jan 3, 2018');
      expect(output.sparklines[0].points[1].count).to.equal(4);
      expect(output.sparklines[0].points[1].date).to.equal('Jan 5, 2018');

      expect(output.sparklines[1].icon).to.equal('entityIcon');
      expect(output.sparklines[1].name).to.equal('entity2');
      expect(output.sparklines[1].styleClass).to.equal('entityStyleClass');
      expect(output.sparklines[1].points.length).to.equal(2);
      expect(output.sparklines[1].points[0].count).to.equal(20);
      expect(output.sparklines[1].points[0].date).to.equal('Jan 4, 2018');
      expect(output.sparklines[1].points[1].count).to.equal(2);
      expect(output.sparklines[1].points[1].date).to.equal('Jan 5, 2018');

      expect(output.sparklines[2].icon).to.equal('entityIcon');
      expect(output.sparklines[2].name).to.equal('entity1');
      expect(output.sparklines[2].styleClass).to.equal('entityStyleClass');
      expect(output.sparklines[2].points.length).to.equal(2);
      expect(output.sparklines[2].points[0].count).to.equal(10);
      expect(output.sparklines[2].points[0].date).to.equal('Jan 2, 2018');
      expect(output.sparklines[2].points[1].count).to.equal(1);
      expect(output.sparklines[2].points[1].date).to.equal('Jan 5, 2018');

      expect(output.sparklines[3].icon).to.equal('entityIcon');
      expect(output.sparklines[3].name).to.equal('entity3');
      expect(output.sparklines[3].styleClass).to.equal('entityStyleClass');
      expect(output.sparklines[3].points.length).to.equal(2);
      expect(output.sparklines[3].points[0].count).to.equal(10);
      expect(output.sparklines[3].points[0].date).to.equal('Jan 1, 2018');
      expect(output.sparklines[3].points[1].count).to.equal(3);
      expect(output.sparklines[3].points[1].date).to.equal('Jan 5, 2018');
    });

    test('timelines does move sparkline matching entity page to top of list', function() {
      /* jscs:disable requireCamelCaseOrUpperCaseIdentifiers */
      var output = transformFunctions.transforms.entity.timelines({
        aggregations: {
          testProperty: {
            buckets: [{
              doc_count: 10,
              key: 1514764800000,
              key_as_string: '2018-01-01T00:00:00',
              testEntity: {
                buckets: [{
                  doc_count: 10,
                  key: 'entity3'
                }]
              }
            }, {
              doc_count: 10,
              key: 1514851200000,
              key_as_string: '2018-01-02T00:00:00',
              testEntity: {
                buckets: [{
                  doc_count: 10,
                  key: 'entity1'
                }]
              }
            }, {
              doc_count: 40,
              key: 1514937600000,
              key_as_string: '2018-01-03T00:00:00',
              testEntity: {
                buckets: [{
                  doc_count: 40,
                  key: 'entity4'
                }]
              }
            }, {
              doc_count: 20,
              key: 1515024000000,
              key_as_string: '2018-01-04T00:00:00',
              testEntity: {
                buckets: [{
                  doc_count: 20,
                  key: 'entity2'
                }]
              }
            }, {
              doc_count: 10,
              key: 1515110400000,
              key_as_string: '2018-01-05T00:00:00',
              testEntity: {
                buckets: [{
                  doc_count: 4,
                  key: 'entity4'
                }, {
                  doc_count: 3,
                  key: 'entity3'
                }, {
                  doc_count: 2,
                  key: 'entity2'
                }, {
                  doc_count: 1,
                  key: 'entity1'
                }]
              }
            }]
          }
        }
      }, {
        entity: {
          key: 'testEntity',
          icon: 'entityIcon',
          styleClass: 'entityStyleClass',
          type: 'string'
        },
        id: 'entity1',
        name: 'testProperty',
        page: {
          key: 'testEntity'
        }
      });
      /* jscs:enable requireCamelCaseOrUpperCaseIdentifiers */

      expect(output.sparklines.length).to.equal(4);

      expect(output.sparklines[0].icon).to.equal('entityIcon');
      expect(output.sparklines[0].name).to.equal('entity1');
      expect(output.sparklines[0].styleClass).to.equal('entityStyleClass');
      expect(output.sparklines[0].points.length).to.equal(2);
      expect(output.sparklines[0].points[0].count).to.equal(10);
      expect(output.sparklines[0].points[0].date).to.equal('Jan 2, 2018');
      expect(output.sparklines[0].points[1].count).to.equal(1);
      expect(output.sparklines[0].points[1].date).to.equal('Jan 5, 2018');

      expect(output.sparklines[1].icon).to.equal('entityIcon');
      expect(output.sparklines[1].name).to.equal('entity4');
      expect(output.sparklines[1].styleClass).to.equal('entityStyleClass');
      expect(output.sparklines[1].points.length).to.equal(2);
      expect(output.sparklines[1].points[0].count).to.equal(40);
      expect(output.sparklines[1].points[0].date).to.equal('Jan 3, 2018');
      expect(output.sparklines[1].points[1].count).to.equal(4);
      expect(output.sparklines[1].points[1].date).to.equal('Jan 5, 2018');

      expect(output.sparklines[2].icon).to.equal('entityIcon');
      expect(output.sparklines[2].name).to.equal('entity2');
      expect(output.sparklines[2].styleClass).to.equal('entityStyleClass');
      expect(output.sparklines[2].points.length).to.equal(2);
      expect(output.sparklines[2].points[0].count).to.equal(20);
      expect(output.sparklines[2].points[0].date).to.equal('Jan 4, 2018');
      expect(output.sparklines[2].points[1].count).to.equal(2);
      expect(output.sparklines[2].points[1].date).to.equal('Jan 5, 2018');

      expect(output.sparklines[3].icon).to.equal('entityIcon');
      expect(output.sparklines[3].name).to.equal('entity3');
      expect(output.sparklines[3].styleClass).to.equal('entityStyleClass');
      expect(output.sparklines[3].points.length).to.equal(2);
      expect(output.sparklines[3].points[0].count).to.equal(10);
      expect(output.sparklines[3].points[0].date).to.equal('Jan 1, 2018');
      expect(output.sparklines[3].points[1].count).to.equal(3);
      expect(output.sparklines[3].points[1].date).to.equal('Jan 5, 2018');
    });

    test('series given incomplete data does return expected object with no histogram', function() {
      // TODO
    });

    test('series given aggregations with single bucket does return expected object with no histogram', function() {
      // TODO
    });

    test('series given aggregations with many buckets does return expected object with histogram', function() {
      // TODO
    });

    test('series does join buckets as needed due to the interval', function() {
      // TODO
    });
  });
</script>
</body>
</html>
